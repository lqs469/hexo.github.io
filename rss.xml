<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[lqs469]]></title><description><![CDATA[lqs469 Blog]]></description><link>https://lqs469.github.io</link><generator>RSS for Node</generator><lastBuildDate>Wed, 21 Aug 2019 02:48:06 GMT</lastBuildDate><item><title><![CDATA[Gitlab API 指北]]></title><description><![CDATA[前段时间为手上的项目做了一个自动化构建平台, 需求大致就是实现从 gitlab 中拿到新的代码, 并且也会对分支做一些增删改查的操作, 基本实现方法当然就是一系列 gitlab 开放的 API 能力. 本文会整理出来以方便大家学习使用. Docs Gitlab…]]></description><link>https://lqs469.github.io/Gitlab API 指北/Gitlab API 指北/</link><guid isPermaLink="false">https://lqs469.github.io/Gitlab API 指北/Gitlab API 指北/</guid><pubDate>Tue, 20 Aug 2019 04:51:01 GMT</pubDate><content:encoded>&lt;p&gt;前段时间为手上的项目做了一个自动化构建平台, 需求大致就是实现从 gitlab 中拿到新的代码, 并且也会对分支做一些增删改查的操作, 基本实现方法当然就是一系列 gitlab 开放的 API 能力. 本文会整理出来以方便大家学习使用.&lt;/p&gt;
&lt;h2&gt;Docs&lt;/h2&gt;
&lt;p&gt;Gitlab 的接入文档写的还是很完善的, 基本上你全都看下来也花不了半天时间. Gitlab文档 &lt;a href=&quot;https://gitlab.com/help/api/README.md&quot;&gt;https://gitlab.com/help/api/README.md&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;TL;TR&lt;/h2&gt;
&lt;p&gt;当然, 你可以选择跳过上面的文档, 这也是写这篇文章的目的. 你只需要了解两件事:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;所有 API 都需要权限, 需要在 &lt;code class=&quot;language-text&quot;&gt;URL&lt;/code&gt; 或&lt;code class=&quot;language-text&quot;&gt;header&lt;/code&gt;中加一个&lt;code class=&quot;language-text&quot;&gt;private_token&lt;/code&gt;字段. 你可以在个人资料里找到这个&lt;code class=&quot;language-text&quot;&gt;private_token&lt;/code&gt;值.&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;请求URL格式为&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;GET http://example.com/api/v3/projects?private_token&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;QVy1PB7sTxfy4pqfZM1U&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;或者&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; --header &lt;span class=&quot;token string&quot;&gt;&quot;PRIVATE-TOKEN: QVy1PB7sTxfy4pqfZM1U&quot;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http://example.com/api/v3/projects&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;阿里的 gitlab API 是 v3 版本. 也就是URL得是: &lt;code class=&quot;language-text&quot;&gt;/api/v3/__&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;然后就可以想要使用什么API就在上面的文档里查什么就行了. 比如查询用户的所有项目列表:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;GET /projects&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这个API支持以下参数:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;archived&lt;/code&gt;(optional) - 选填, 是否归档的项目&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;order_by&lt;/code&gt;(optional) - 选填, 排序由 &lt;code class=&quot;language-text&quot;&gt;id&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;name&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;path&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;created_at&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;updated_at&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;last_activity_atfields&lt;/code&gt;. 默认&lt;code class=&quot;language-text&quot;&gt;created_at&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;sort&lt;/code&gt;(optional) - 选填, 正序&lt;code class=&quot;language-text&quot;&gt;asc&lt;/code&gt;或者倒序&lt;code class=&quot;language-text&quot;&gt;desc&lt;/code&gt;. 默认倒序&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;search&lt;/code&gt;(optional) - 根据搜索字段过滤列表&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;返回结果:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;description&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; **&lt;span class=&quot;token null keyword&quot;&gt;null&lt;/span&gt;**&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;default_branch&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;master&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;public&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; **&lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;**&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;visibility_level&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;ssh_url_to_repo&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;git@example.com:diaspora/diaspora-client.git&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;http_url_to_repo&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http://example.com/diaspora/diaspora-client.git&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;web_url&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http://example.com/diaspora/diaspora-client&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;tag_list&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
      &lt;span class=&quot;token string&quot;&gt;&quot;example&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token string&quot;&gt;&quot;disapora client&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;owner&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Diaspora&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;created_at&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2013-09-30T13: 46: 02Z&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Diaspora Client&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;name_with_namespace&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Diaspora / Diaspora Client&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;path&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;diaspora-client&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;path_with_namespace&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;diaspora/diaspora-client&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;issues_enabled&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; **&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;**&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;open_issues_count&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;merge_requests_enabled&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; **&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;**&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;builds_enabled&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; **&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;**&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;wiki_enabled&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; **&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;**&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;snippets_enabled&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; **&lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;**&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;created_at&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2013-09-30T13: 46: 02Z&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;last_activity_at&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2013-09-30T13: 46: 02Z&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;creator_id&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;namespace&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;created_at&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2013-09-30T13: 46: 02Z&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;description&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Diaspora&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;owner_id&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;path&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;diaspora&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;updated_at&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2013-09-30T13: 46: 02Z&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;archived&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; **&lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;**&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;avatar_url&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http://example.com/uploads/project/avatar/4/uploads/avatar.png&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;description&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; **&lt;span class=&quot;token null keyword&quot;&gt;null&lt;/span&gt;**&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;default_branch&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;master&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;public&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; **&lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;**&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;visibility_level&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;ssh_url_to_repo&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;git@example.com:brightbox/puppet.git&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;http_url_to_repo&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http://example.com/brightbox/puppet.git&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;web_url&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http://example.com/brightbox/puppet&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;tag_list&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
      &lt;span class=&quot;token string&quot;&gt;&quot;example&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token string&quot;&gt;&quot;puppet&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;owner&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Brightbox&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;created_at&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2013-09-30T13:46:02Z&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Puppet&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;name_with_namespace&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Brightbox / Puppet&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;path&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;puppet&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;path_with_namespace&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;brightbox/puppet&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;issues_enabled&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; **&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;**&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;open_issues_count&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;merge_requests_enabled&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; **&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;**&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;builds_enabled&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; **&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;**&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;wiki_enabled&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; **&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;**&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;snippets_enabled&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; **&lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;**&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;created_at&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2013-09-30T13:46:02Z&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;last_activity_at&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2013-09-30T13:46:02Z&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;creator_id&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;namespace&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;created_at&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2013-09-30T13:46:02Z&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;description&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Brightbox&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;owner_id&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;path&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;brightbox&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;updated_at&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2013-09-30T13:46:02Z&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;archived&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; **&lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;**&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;avatar_url&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; **&lt;span class=&quot;token null keyword&quot;&gt;null&lt;/span&gt;**
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;APIs&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://gitlab.com/help/api/api_resources.md&quot;&gt;APIs 文档&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;第三方封装&lt;/h2&gt;
&lt;h3&gt;node-gitlab&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/jdalrymple/node-gitlab&quot;&gt;https://github.com/jdalrymple/node-gitlab&lt;/a&gt;
一个个写这些API请求是件很无聊的事, 所以也推荐直接使用封装好的库.&lt;/p&gt;
&lt;p&gt;使用方法基本一目了然:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Gitlab &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;gitlab&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; api &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Gitlab&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  host&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;http://gitlab.alibaba-inc.com&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  token&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;XXXXXXX&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  version&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;v3&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

api&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;GroupProjects&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;groupId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;友情提示:
node-gitlab 的文档少得可怜, 可能作者觉得官方文档已经足够了, 建议直接看&lt;code class=&quot;language-text&quot;&gt;/src/services&lt;/code&gt;下的源码, 找同名的方法即可.&lt;/p&gt;
&lt;/blockquote&gt;</content:encoded></item><item><title><![CDATA[10x工程师]]></title><description><![CDATA[硅谷里提到了一个很有趣的概念， 叫做“10x工程师”。Big Head 形容 Richard 的时候说到： “Richard is a 10xer. I’m barely a 1xer.” — Big Head, HBO’s Silicon Valley Silicon…]]></description><link>https://lqs469.github.io/10x工程师/10x工程师/</link><guid isPermaLink="false">https://lqs469.github.io/10x工程师/10x工程师/</guid><pubDate>Sun, 14 Jul 2019 00:36:41 GMT</pubDate><content:encoded>&lt;p&gt;硅谷里提到了一个很有趣的概念， 叫做“10x工程师”。Big Head 形容 Richard 的时候说到：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;“Richard is a 10xer. I’m barely a 1xer.”&lt;/p&gt;
&lt;p&gt;— Big Head, HBO’s Silicon Valley&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Silicon Valley Dictionary 给出的解释是这样：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A concept sometimes used in Silicon Valley to describe an engineer that is 10x more productive than an average engineer although the 10x metric is figurative. Sometimes referred to as “Ninjas”, these engineers are highly sought after by all tech companies.&lt;/p&gt;
&lt;p&gt;（有时在硅谷使用概念来描述的工程师比普通工程师的工作效率高10倍，尽管10x指标是具象的。这些工程师有时被称为“Ninjas”，受到所有科技公司的高度追捧。）&lt;/p&gt;
&lt;p&gt;— 来自&lt;a href=&quot;http://svdictionary.com/words/10x-engineer&quot;&gt;Silicon Valley Dictionary&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;最近在twitter看到一个10x工程师的特点， 分享一下：
来自&lt;a href=&quot;https://twitter.com/skirani/status/1149302828420067328&quot;&gt;Shekhar Kirani&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;10x工程师讨厌会议。他们认为这是浪费时间，而且讨论的都是很明显的事情。他们参加会议是因为经理的要求而召开的“员工会议”，以讨论一些feature和status。&lt;/li&gt;
&lt;li&gt;10x工程师办公室的时间安排非常不规律。他们往往当周围很少有人在他们身边的时候工作。如果有人群或全员会议，则不可见。他们大多数是深夜编码员。&lt;/li&gt;
&lt;li&gt;10x工程师笔记本电脑屏幕背景颜色通常是黑色（它们总是更改默认值）。他们的键盘键如i，f，x通常比a，s和e（电子邮件发件人）都要破旧。&lt;/li&gt;
&lt;li&gt;10x工程师了解已投入生产的每一行代码。如果QA或支持人员提出问题，他们确切地知道故障（或错误）的位置，并且可以在几小时内修复别人需要天级别的任务量。&lt;/li&gt;
&lt;li&gt;大多数10x工程师都是全栈工程师。对于他们来说，代码是代码，他们不关心它是前端，后端，API，数据库，无服务器等。我很少看到他们做UI工作。&lt;/li&gt;
&lt;li&gt;10x工程师可以在他们的脑海中将“思想”转换为“代码”，并一口气将他们编写完成。给出产品功能的具体要求，他们可以用一杯含咖啡因的饮料在4到6个小时的一到两个座位内写下整个功能而不会分心。&lt;/li&gt;
&lt;li&gt;10x工程师很少查看类或方法的帮助文档。他们在记忆中知道它并且可以从记忆中回忆起来。他们编写代码与编写英文一样简单。没有休息，没有暂停，只是输入。&lt;/li&gt;
&lt;li&gt;10倍的工程师总是在公司的每个人之前学习新的框架，语言。他们不怕任何新事物。如果有新的东西（例如区块链），他们会在任何人开始之前吞噬，配置，实验。&lt;/li&gt;
&lt;li&gt;10x工程师是糟糕的导师，因为他们不能很好的教会别人如何去做或者如何包装处理。他们总是认为“教导或与他人讨论需要太长时间，我宁愿自己做。”他们也是不好的面试官。&lt;/li&gt;
&lt;li&gt;10x工程师不是hack东西。他们编写高质量代码并确切知道代码的演变方式，并在心里拥有整体代码结构的设计模型。他们最多写一个设计文档，其余的都在代码中。&lt;/li&gt;
&lt;li&gt;10x工程师很少找工作或离开公司。他们离开是因为你通过会议，培训和其他这类没有增加价值的活动使他们的生活变得不愉快。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;这中间有的内容的确比较主观且绝对，并不完全同意他的看法，但说的还蛮有趣的。&lt;/p&gt;
&lt;p&gt;大家都想成为10x工程师，因为能体现自身价值且报酬丰厚。初创公司的雇主当然会更喜欢10x工程师，毕竟低成本还大大提效，而大公司可能就不太一样，大团队中如果全是“superstar”类型的程序员，且不说这现不现实，在各个环节的沟通合作，指责互补等方面来讲不一定有强弱搭配来的有效，而且还带来了一定的管理风险。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[学习的意义]]></title><description><![CDATA[我现在回想起我的大学学到的东西, 发现这是一段我人生最浪费时间的阶段, 整个…]]></description><link>https://lqs469.github.io/学习的意义/</link><guid isPermaLink="false">https://lqs469.github.io/学习的意义/</guid><pubDate>Tue, 10 Jul 2018 14:26:26 GMT</pubDate><content:encoded>&lt;p&gt;我现在回想起我的大学学到的东西, 发现这是一段我人生最浪费时间的阶段, 整个4年都处在无聊, 故作忙碌, 迷茫困惑中度过的, 在那个本该最有冲劲和热情的时间里, 我基本不知道方向在哪里, 目标是什么. 只是跟着密集的课程, 学校的安排去学一些我根本不喜欢或者早就学会的东西, 我没有哪门课获得过100分或者95分, 哪怕是我早就会的内容, 但是我依然在某些感兴趣的科目可以自学不复习就到达90分, 当时只是觉得一点点茫然或者无所谓, 现在我才幡然醒悟, 我特么就是在浪费时间.&lt;/p&gt;
&lt;p&gt;等到我真正走上社会, 开始面对真实世界的考验的时候, 我才发现我什么都不会, 之前的我是被隔离的. 我说的走上社会的真实世界, 并不是指什么校招, 什么笔试, 那些会考大学书本, 考你绩点里要求的东西. 我说的是当你跟全世界竞争, 跟比你年纪大或比你有经验的同行或非同行竞争的时候, 那些你需要会的东西, 使用的技能, 这时你才发现自己是真的稚嫩. 学校安排学习的内容是早二三十年早已跟社会脱节的人制定的, 技术的世界日新月异, 你拿什么跟他们争呢?&lt;/p&gt;
&lt;p&gt;四年时间, 比一万小时定律还宽裕的时间, 足以让一个人成为某一领域的佼佼者, 但是实际上毕业的时候呢, 像我读的这样中等偏上的大学中, 应届生的平均能力真的令人叹息. 我看到最多的就是对自己的迷茫, 对人生的迷茫, 用四年的时间依然没有找到自己想走的方向. 最后20出头的年纪级就选择了户口, 稳定, 轻松简单的工作, 我也不敢说这样的路正不正确, 因为我也年轻, 还没到后悔的年纪, 但是如果是我, 我只是觉得走这样路我会有点亏. 也许未来我会后悔.&lt;/p&gt;
&lt;p&gt;在学术道路和职业道路的选择中, 其实只要一个月时间, 大部分人都能找到自己的答案,  但是人们依然前赴后继去考研. 我当时也是这样, 要是问我原因的话, 我应该和大部分人一样, 首先我回答不清楚这个问题, 然后带着迷茫地告诉你研究生是现在社会对人才的基本要求… 我特么还考了两次, 差点还考第三次… 可是我根本不喜欢搞学术, 我就喜欢写代码, 当码农, 想写一辈子代码, 这一点在高中时候参加NOIP的时候我就想清楚的事情, 隔了这么久居然给忘了…&lt;/p&gt;
&lt;p&gt;并不是在说知识无用, 知识任何时候都是最好的资本, 技术永远是推动社会前进的最大动力. 只是知识不是只有在大学四年里才能获得的, 教育制度的好赖公平与否不由我们说的算, 是否过时也无从得证, 毕竟每年有那么多人才从大学走出. 但是学习的自主权是真真实实在每个人自己手上的, 可以是按兴趣, 也可以是职业规划要求, 哪怕从事职业多年之后再去深造学术. 当你发现没有什么能限制你去学习的时候, 你才真的明白了自己为何而学, 才不会被制度的镣铐锁住手脚. 你是理科, 也可以去学艺术, 你读文学, 一样可以写出美妙的代码. 不给自己设限, 终身学习, 不断学习, 才能到达自己的巅峰, 同时充满快乐. &lt;/p&gt;</content:encoded></item><item><title><![CDATA[Node.js Streams 中的背压(backpressure)]]></title><description><![CDATA[原文 数据处理过程中经常出现一个称为背压(backpressure…]]></description><link>https://lqs469.github.io/Backpressure/</link><guid isPermaLink="false">https://lqs469.github.io/Backpressure/</guid><pubDate>Tue, 03 Jul 2018 21:09:32 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://nodejs.org/en/docs/guides/backpressuring-in-streams/&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;数据处理过程中经常出现一个称为&lt;strong&gt;背压(backpressure)&lt;/strong&gt;的常见问题，用来描述数据传输过程中缓冲区后面的数据累积。当传送的接收端操作复杂时，或者由于某种原因而较慢时，来自传入源的数据有积聚的趋势，如堵塞。&lt;/p&gt;
&lt;p&gt;为了解决这个问题，必须有一个授权系统来确保从一个源到另一个源的数据的平滑流动。不同的社区有根据其程序特点的独特解决方案，Unix pipes 和 TCP sockets 就是这方面的很好的例子，并且通常被称为流量控制。在Node.js中，Stream 是已被采用的解决方案。&lt;/p&gt;
&lt;p&gt;本指南的目的是进一步详细说明背压是什么，以及流如何在Node.js的源代码中解决这个问题。本指南的第二部分将介绍建议的最佳实践，以确保您的应用程序的代码在实现流时安全和优化。&lt;/p&gt;
&lt;p&gt;我们假设身为读者的你对 Node.js 中背压，&lt;code class=&quot;language-text&quot;&gt;Buffer&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;EventEmitters&lt;/code&gt; 的一般定义以及 Stream 的一些经验有点熟悉。如果您还没有阅读这些文档，首先查看API文档并不是一个坏主意，因为这将有助于在阅读本指南时扩展您的理解。&lt;/p&gt;
&lt;h2&gt;数据处理的问题&lt;/h2&gt;
&lt;p&gt;在计算机系统中，数据通过管道，套接字和信号(pipes, sockets, and signals)从一个进程传输到另一个进程。在 Node.js 中，我们找到了一个名为 Stream 的类似机制。Stream 很棒！他们为 Node.js 做了很多工作，几乎内部代码库的每个部分都利用该模块。作为一名开发人员，鼓励您去使用它们！&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; readline &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;readline&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// process.stdin and process.stdout are both instances of Streams&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; rl &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; readline&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createInterface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  input&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;stdin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  output&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;stdout
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

rl&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;question&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Why should you use streams? &apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;answer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`Maybe it&apos;s &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;answer&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;, maybe it&apos;s because they are awesome! :)`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  rl&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;通过比较 Node.js Stream 实现的内部系统工具，可以证明为什么通过 &lt;strong&gt;Stream&lt;/strong&gt; 实现 &lt;strong&gt;backpressure&lt;/strong&gt; 机制是一个很好的优化。&lt;/p&gt;
&lt;p&gt;在一种情况下，我们将采用大文件(大约9GB) 并使用熟悉的&lt;code class=&quot;language-text&quot;&gt;zip(1)&lt;/code&gt;工具对其进行压缩。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ zip The.Matrix.1080p.mkv&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;虽然这需要几分钟的时间才能完成，在另一个shell中，我们可以运行一个采用 Node.js 的模块 &lt;code class=&quot;language-text&quot;&gt;zlib&lt;/code&gt; 的脚本，该脚本包含另一个压缩工具 &lt;code class=&quot;language-text&quot;&gt;gzip(1)&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; gzip &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;zlib&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createGzip&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; fs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;fs&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; inp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; fs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createReadStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;The.Matrix.1080p.mkv&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; out &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; fs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createWriteStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;The.Matrix.1080p.mkv.gz&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

inp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;pipe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;gzip&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;pipe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;然后来验证结果，尝试打开每个压缩文件。由 &lt;code class=&quot;language-text&quot;&gt;zip(1)&lt;/code&gt; 工具压缩的文件将通知您文件已损坏，而由 Stream 完成的压缩将无错地解压缩。&lt;/p&gt;
&lt;p&gt;注意：在本例中，我们使用 &lt;code class=&quot;language-text&quot;&gt;.pipe()&lt;/code&gt; 从一端到另一端获取数据源。但是，请注意，没有附加适当的错误处理程序。如果大量数据无法正确接收，则可读源或 &lt;code class=&quot;language-text&quot;&gt;gzip&lt;/code&gt; 流不会被销毁。&lt;code class=&quot;language-text&quot;&gt;.pump&lt;/code&gt; 是一个很实用工具，如果其中一个失败或关闭，它将稳定无误地销毁管道中的所有流，并且在这种情况下是必须的！&lt;/p&gt;
&lt;h2&gt;数据太多, 太快&lt;/h2&gt;
&lt;p&gt;有些情况下，可读流可能太快地将数据提供给&lt;code class=&quot;language-text&quot;&gt;Writable&lt;/code&gt; - 远远超过消费者可以处理的数量！&lt;/p&gt;
&lt;p&gt;当发生这种情况时，消费者将开始排列所有数据块以供以后使用。写入队列将变得越来越长，并且因为这个更多的数据必须保存在内存中，直到整个过程完成。&lt;/p&gt;
&lt;p&gt;写入磁盘比从磁盘读取要慢很多，因此，当我们试图压缩文件并将其写入硬盘时，就会发生背压，因为写入磁盘将无法跟上速度阅读。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Secretly the stream is saying: &quot;whoa, whoa! hang on, this is way too much!&quot;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// Data will begin to build up on the read-side of the data buffer as&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// `write` tries to keep up with the incoming data flow.&lt;/span&gt;
inp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;pipe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;gzip&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;pipe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;outputFile&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这就是背压机制很重要的原因。如果背压系统不存在，这个过程将耗尽系统的内存，严重减缓其他的过程，并垄断大部分系统资源直到完成。&lt;/p&gt;
&lt;p&gt;结局如下:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;放慢所有其他现有流程&lt;/li&gt;
&lt;li&gt;一个非常劳累过度的垃圾收集器&lt;/li&gt;
&lt;li&gt;内存耗尽&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在以下示例中，我们将取出&lt;code class=&quot;language-text&quot;&gt;.write()&lt;/code&gt; 函数的返回值并将其更改为 true，这有效地禁用了Node.js内核中的背压支持。在任何对“修改”二进制文件的引用中，我们都在讨论如何运行没有 &lt;code class=&quot;language-text&quot;&gt;return ret;&lt;/code&gt; 的节点二进制 (node binary) 文件线，而替换为 &lt;code class=&quot;language-text&quot;&gt;return true&lt;/code&gt; ;&lt;/p&gt;
&lt;h2&gt;过量的垃圾收集&lt;/h2&gt;
&lt;p&gt;让我们看看一个快速的基准。使用上面的同一个例子，我们进行了几次试验，以获得两个二进制文件的中位时间。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;   trial (#)  | `node` binary (ms) | modified `node` binary (ms)
=================================================================
      1       |      56924         |           55011
      2       |      52686         |           55869
      3       |      59479         |           54043
      4       |      54473         |           55229
      5       |      52933         |           59723
=================================================================
average time: |      55299         |           55975&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;两者都花费一分钟左右的时间，所以根本没什么区别，但让我们仔细观察一下，以确认我们的猜测是否正确。我们使用 Linux 工具 &lt;code class=&quot;language-text&quot;&gt;dtrace&lt;/code&gt; 来评估V8垃圾收集器的情况。&lt;/p&gt;
&lt;p&gt;GC（垃圾回收器）测量的时间表示垃圾收集器完成的单次扫描的完整周期的时间间隔：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;approx. time (ms) | GC (ms) | modified GC (ms)
=================================================
          0       |    0    |      0
          1       |    0    |      0
         40       |    0    |      2
        170       |    3    |      1
        300       |    3    |      1

         *             *           *
         *             *           *
         *             *           *

      39000       |    6    |     26
      42000       |    6    |     21
      47000       |    5    |     32
      50000       |    8    |     28
      54000       |    6    |     35&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;虽然这两种方法的起始时间相同，并且似乎以相同的速度工作，但显然在几秒钟后使用正确工作的反压系统GC负荷会以4-8毫秒的间隔持续扩散，直到数据传输结束。&lt;/p&gt;
&lt;p&gt;但是，当背压系统不在时，V8垃圾回收系统开始拖延。正常的二进制文件在一分钟内调用GC约75次，而修改后的二进制文件只触发36次。&lt;/p&gt;
&lt;p&gt;这是由于记忆体使用量增加而累积的缓慢而渐进的债务。随着数据的传输，如果没有背压系统，每个块传输都会使用更多的内存。&lt;/p&gt;
&lt;p&gt;分配的内存越多，GC就必须在一次扫描中处理得越多。扫描越大，GC需要决定什么可以释放，并且在更大的内存空间中扫描分离的指针会消耗更多的计算能力。&lt;/p&gt;
&lt;h2&gt;内存耗尽&lt;/h2&gt;
&lt;p&gt;为了确定每个二进制文件的内存消耗，我们为每个进程分别设定了&lt;code class=&quot;language-text&quot;&gt;/usr/bin/time -lp sudo ./node ./backpressure-example/zlib.js&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;这是正常二进制的输出：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Respecting the return value of .write()
=============================================
real        58.88
user        56.79
sys          8.79
  87810048  maximum resident set size
         0  average shared memory size
         0  average unshared data size
         0  average unshared stack size
     19427  page reclaims
      3134  page faults
         0  swaps
         5  block input operations
       194  block output operations
         0  messages sent
         0  messages received
         1  signals received
        12  voluntary context switches
    666037  involuntary context switches&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;虚拟内存占用的最大字节大小约为87.81 mb。 现在改变 &lt;code class=&quot;language-text&quot;&gt;.write()&lt;/code&gt; 函数的返回值，我们得到：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Without respecting the return value of .write():
==================================================
real        54.48
user        53.15
sys          7.43
1524965376  maximum resident set size
         0  average shared memory size
         0  average unshared data size
         0  average unshared stack size
    373617  page reclaims
      3139  page faults
         0  swaps
        18  block input operations
       199  block output operations
         0  messages sent
         0  messages received
         1  signals received
        25  voluntary context switches
    629566  involuntary context switches&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;虚拟内存占用的最大字节大小约为1.52 gb。&lt;/p&gt;
&lt;p&gt;如果没有适当的 Stream backpressure，分配的内存空间就会增加一个数量级 - 这是同一过程之间的巨大差异！&lt;/p&gt;
&lt;p&gt;这个实验展示了 Node.js 的背压机制是如何针对您的计算系统优化和具有成本效益的。现在，让我们分析一下它的工作原理！&lt;/p&gt;
&lt;h2&gt;背压是如何解决这些问题的?&lt;/h2&gt;
&lt;p&gt;有不同的功能将数据从一个进程传输到另一个进程。在Node.js中，有一个名为&lt;code class=&quot;language-text&quot;&gt;.pipe()&lt;/code&gt;的内部内置函数。还有其他的软件包也可以使用！但最终，在这个过程的基本层面上，我们有两个独立的组件：数据源和消费者。&lt;/p&gt;
&lt;p&gt;当从源调用&lt;code class=&quot;language-text&quot;&gt;.pipe()&lt;/code&gt;时，它向消费者发出信号，告知有数据要传输。管道功能有助于为事件触发器设置适当的背压闭合。&lt;/p&gt;
&lt;p&gt;在Node.js中，源是可读流，而消费者是可写流（这两者可以与双工或转换流互换，但对于本指南而言，这是超出范围的）。&lt;/p&gt;
&lt;p&gt;触发背压的时刻可以精确地缩小到Writable的&lt;code class=&quot;language-text&quot;&gt;.write()&lt;/code&gt;函数的返回值。当然，这个返回值由几个条件决定。&lt;/p&gt;
&lt;p&gt;在数据缓冲区已超过&lt;code class=&quot;language-text&quot;&gt;highWaterMark&lt;/code&gt;或写入队列当前正忙的任何情况下，&lt;code class=&quot;language-text&quot;&gt;.write()&lt;/code&gt;将返回&lt;code class=&quot;language-text&quot;&gt;false&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;当返回错误值时，背压系统启动。它将暂停传入的可读流发送任何数据并等待消费者再次准备就绪。清空数据缓冲区后，将发出&lt;code class=&quot;language-text&quot;&gt;.drain()&lt;/code&gt;事件并恢复传入的数据流。&lt;/p&gt;
&lt;p&gt;队列完成后，背压将允许再次发送数据。正在使用的内存空间将自行释放并为下一批数据做好准备。&lt;/p&gt;
&lt;p&gt;这有效地允许在任何给定时间为&lt;code class=&quot;language-text&quot;&gt;.pipe()&lt;/code&gt;函数使用固定数量的内存。没有内存泄漏，没有无限缓冲，垃圾收集器只需要处理内存中的一个区域！&lt;/p&gt;
&lt;p&gt;那么，如果背压如此重要，为什么你（可能）没有听说过它？那么答案很简单：Node.js自动完成所有这些。&lt;/p&gt;
&lt;p&gt;太棒了！但是当我们试图理解如何实现我们自己的自定义流时也不是那么好。&lt;/p&gt;
&lt;p&gt;注意：在大多数机器中，有一个字节大小决定缓冲区何时已满（这将在不同的机器上有所不同）。 Node.js允许您设置自己的自定义highWaterMark，但通常，默认设置为16kb（对于objectMode流，为16384或16）。在某些情况下，您可能需要提高该值，但请谨慎行事！&lt;/p&gt;
&lt;h2&gt;&lt;code class=&quot;language-text&quot;&gt;.pipe()&lt;/code&gt;的生命周期&lt;/h2&gt;
&lt;p&gt;为了更好地理解背压，下面是一个可读流的生命周期的流程图，该流被导入到可写流中：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;                                                     +===================+
                         x--&amp;gt;  Piping functions   +--&amp;gt;   src.pipe(dest)  |
                         x     are set up during     |===================|
                         x     the .pipe method.     |  Event callbacks  |
  +===============+      x                           |-------------------|
  |   Your Data   |      x     They exist outside    | .on(&amp;#39;close&amp;#39;, cb)  |
  +=======+=======+      x     the data flow, but    | .on(&amp;#39;data&amp;#39;, cb)   |
          |              x     importantly attach    | .on(&amp;#39;drain&amp;#39;, cb)  |
          |              x     events, and their     | .on(&amp;#39;unpipe&amp;#39;, cb) |
+---------v---------+    x     respective callbacks. | .on(&amp;#39;error&amp;#39;, cb)  |
|  Readable Stream  +----+                           | .on(&amp;#39;finish&amp;#39;, cb) |
+-^-------^-------^-+    |                           | .on(&amp;#39;end&amp;#39;, cb)    |
  ^       |       ^      |                           +-------------------+
  |       |       |      |
  |       ^       |      |
  ^       ^       ^      |    +-------------------+         +=================+
  ^       |       ^      +----&amp;gt;  Writable Stream  +---------&amp;gt;  .write(chunk)  |
  |       |       |           +-------------------+         +=======+=========+
  |       |       |                                                 |
  |       ^       |                              +------------------v---------+
  ^       |       +-&amp;gt; if (!chunk)                |    Is this chunk too big?  |
  ^       |       |     emit .end();             |    Is the queue busy?      |
  |       |       +-&amp;gt; else                       +-------+----------------+---+
  |       ^       |     emit .write();                   |                |
  |       ^       ^                                   +--v---+        +---v---+
  |       |       ^-----------------------------------&amp;lt;  No  |        |  Yes  |
  ^       |                                           +------+        +---v---+
  ^       |                                                               |
  |       ^               emit .pause();          +=================+     |
  |       ^---------------^-----------------------+  return false;  &amp;lt;-----+---+
  |                                               +=================+         |
  |                                                                           |
  ^            when queue is empty     +============+                         |
  ^------------^-----------------------&amp;lt;  Buffering |                         |
               |                       |============|                         |
               +&amp;gt; emit .drain();       |  ^Buffer^  |                         |
               +&amp;gt; emit .resume();      +------------+                         |
                                       |  ^Buffer^  |                         |
                                       +------------+   add chunk to queue    |
                                       |            &amp;lt;---^---------------------&amp;lt;
                                       +============+&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;注意：如果您正在设置一个管道以将几个流链接在一起来操纵数据，那么您很可能会实现Transform流。&lt;/p&gt;
&lt;p&gt;在这种情况下，来自可读流的输出将输入到Transform中，并将流入Writable。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Readable.pipe(Transformable).pipe(Writable);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;背压将自动应用，但请注意转换流的输入和输出&lt;code class=&quot;language-text&quot;&gt;highWaterMark&lt;/code&gt;可能会被操纵，并会影响反压系统。&lt;/p&gt;
&lt;h2&gt;背压指南&lt;/h2&gt;
&lt;p&gt;由于Node.js v0.10，Stream类提供了使用这些函数（&lt;code class=&quot;language-text&quot;&gt;._read()和._write()&lt;/code&gt;）的下划线版本来修改&lt;code class=&quot;language-text&quot;&gt;.read()&lt;/code&gt;或&lt;code class=&quot;language-text&quot;&gt;.write()&lt;/code&gt;的行为的功能。 。&lt;/p&gt;
&lt;p&gt;有关于实现可读流和实现可写流的指导文件。我们假设你已经阅读了这些内容，下一节将更深入一点。&lt;/p&gt;
&lt;h2&gt;实现自定义流时遵守的规则&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Stream&lt;/code&gt;的黄金法则是始终尊重背压。最佳实践的构成是非矛盾的做法。只要你小心避免与内部背压支持相冲突的行为，就可以确定你正在遵循良好的做法。&lt;/p&gt;
&lt;p&gt;一般来说:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;如果没有询问，请不要使用&lt;code class=&quot;language-text&quot;&gt;.push()&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;永远不要在返回false后调用&lt;code class=&quot;language-text&quot;&gt;.write()&lt;/code&gt;，而是等待’drain’。&lt;/li&gt;
&lt;li&gt;Streams在不同的Node.js版本和您使用的库之间进行更改。要小心注意并测试一下。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;注意：关于第3点，构建浏览器流的非常有用的包是&lt;code class=&quot;language-text&quot;&gt;readable-stream&lt;/code&gt;。 Rodd Vagg撰写了一篇很棒的博客文章，描述了这个库的实用性。简而言之，它为可读流提供了一种自动优雅降级，并支持旧版本的浏览器和Node.js.&lt;/p&gt;
&lt;h2&gt;可读流的特定规则&lt;/h2&gt;
&lt;p&gt;到目前为止，我们已经了解了&lt;code class=&quot;language-text&quot;&gt;.write()&lt;/code&gt;如何影响背压，并将重点放在&lt;code class=&quot;language-text&quot;&gt;Writable&lt;/code&gt;流上。由于Node.js的功能，数据在技术上从可读流向下游流向可写。但是，正如我们可以在数据，物质或能量的任何传输中观察到的那样，源与目标一样重要，可读流对于如何处理背压至关重要。&lt;/p&gt;
&lt;p&gt;这两个进程都依赖于另一个进行有效的通信，如果&lt;code class=&quot;language-text&quot;&gt;Readable&lt;/code&gt;忽略了当&lt;code class=&quot;language-text&quot;&gt;Writable&lt;/code&gt;流要求它停止发送数据时，它可能与&lt;code class=&quot;language-text&quot;&gt;.write()&lt;/code&gt;的返回值不正确时一样有问题。&lt;/p&gt;
&lt;p&gt;因此，在尊重&lt;code class=&quot;language-text&quot;&gt;.write()&lt;/code&gt;返回时，我们还必须尊重&lt;code class=&quot;language-text&quot;&gt;._read()&lt;/code&gt;方法中使用的&lt;code class=&quot;language-text&quot;&gt;.push()&lt;/code&gt;的返回值。如果&lt;code class=&quot;language-text&quot;&gt;.push()&lt;/code&gt;返回一个假值，则该流将停止从源读取。否则，它将继续而不会暂停。&lt;/p&gt;
&lt;p&gt;这有个使用&lt;code class=&quot;language-text&quot;&gt;.push()&lt;/code&gt;的反例&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;// This is problematic as it completely ignores return value from push
// which may be a signal for backpressure from the destination stream!
class MyReadable extends Readable {
  _read(size) {
    let chunk;
    while (null !== (chunk = getNextChunk())) {
      this.push(chunk);
    }
  }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;另外，从定制流的外部来看，忽视背压是非常重要的。在这个良好实践的反例中，应用程序的代码在数据可用时强制数据（由&lt;code class=&quot;language-text&quot;&gt;.data&lt;/code&gt;事件发送信号）：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;// This ignores the backpressure mechanisms Node.js has set in place,
// and unconditionally pushes through data, regardless if the
// destination stream is ready for it or not.
readable.on(&amp;#39;data&amp;#39;, (data) =&amp;gt;
  writable.write(data)
);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;可写流的特定规则&lt;/h2&gt;
&lt;p&gt;回想一下&lt;code class=&quot;language-text&quot;&gt;.write()&lt;/code&gt;可能会根据某些条件返回true或false。幸运的是，在构建我们自己的可写流时，流状态机将处理我们的回调并确定何时处理背压并为我们优化数据流。&lt;/p&gt;
&lt;p&gt;但是，当我们想直接使用Writable时，我们必须尊重&lt;code class=&quot;language-text&quot;&gt;.write()&lt;/code&gt;返回值并密切注意这些条件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果写队列忙，.&lt;code class=&quot;language-text&quot;&gt;write()&lt;/code&gt;将返回false。&lt;/li&gt;
&lt;li&gt;如果数据块太大，&lt;code class=&quot;language-text&quot;&gt;.write()&lt;/code&gt;将返回false（该值由变量highWaterMark指示）。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;// This writable is invalid because of the async nature of JavaScript callbacks.
// Without a return statement for each callback prior to the last,
// there is a great chance multiple callbacks will be called.
class MyWritable extends Writable {
  _write(chunk, encoding, callback) {
    if (chunk.toString().indexOf(&amp;#39;a&amp;#39;) &amp;gt;= 0)
      callback();
    else if (chunk.toString().indexOf(&amp;#39;b&amp;#39;) &amp;gt;= 0)
      callback();
    callback();
  }
}

// The proper way to write this would be:
    if (chunk.contains(&amp;#39;a&amp;#39;))
      return callback();
    else if (chunk.contains(&amp;#39;b&amp;#39;))
      return callback();
    callback();&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在实现&lt;code class=&quot;language-text&quot;&gt;._writev()&lt;/code&gt;时还需要注意一些事项。该函数与&lt;code class=&quot;language-text&quot;&gt;.cork()&lt;/code&gt;结合使用，但写入时常见错误：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;// Using .uncork() twice here makes two calls on the C++ layer, rendering the
// cork/uncork technique useless.
ws.cork();
ws.write(&amp;#39;hello &amp;#39;);
ws.write(&amp;#39;world &amp;#39;);
ws.uncork();

ws.cork();
ws.write(&amp;#39;from &amp;#39;);
ws.write(&amp;#39;Matteo&amp;#39;);
ws.uncork();

// The correct way to write this is to utilize process.nextTick(), which fires
// on the next event loop.
ws.cork();
ws.write(&amp;#39;hello &amp;#39;);
ws.write(&amp;#39;world &amp;#39;);
process.nextTick(doUncork, ws);

ws.cork();
ws.write(&amp;#39;from &amp;#39;);
ws.write(&amp;#39;Matteo&amp;#39;);
process.nextTick(doUncork, ws);

// as a global function
function doUncork(stream) {
  stream.uncork();
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;.cork()&lt;/code&gt;可以被调用多次，我们只需要小心调用&lt;code class=&quot;language-text&quot;&gt;.uncork()&lt;/code&gt;相同的次数，使其再次流动。&lt;/p&gt;
&lt;h2&gt;结论&lt;/h2&gt;
&lt;p&gt;Streams是Node.js中经常使用的模块。它们对于内部结构非常重要，对于开发人员来说，它们可以跨Node.js模块生态系统进行扩展和连接。&lt;/p&gt;
&lt;p&gt;希望您现在能够排除故障，安全地编写您自己的可写和可读流的背景，并与同事和朋友分享您的知识。&lt;/p&gt;
&lt;p&gt;在使用Node.js构建应用程序时，请务必阅读有关其他API函数的Stream的更多信息，以帮助改进和释放您的流功能。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[JavaScript ES2018/ES9 新增标准]]></title><description><![CDATA[6 月 27 号, TC39 正式完成了ES2018/ES9 的语言规范 开始进入 ES2019 阶段.
最终阶段详情: finished-proposals
来看看 ES2018 比之前的 ES2017 新增了哪些规范. Object Rest/Spread…]]></description><link>https://lqs469.github.io/JavaScript-ES2018-ES9-新增标准/</link><guid isPermaLink="false">https://lqs469.github.io/JavaScript-ES2018-ES9-新增标准/</guid><pubDate>Fri, 29 Jun 2018 22:14:06 GMT</pubDate><content:encoded>&lt;p&gt;6 月 27 号, TC39 正式完成了&lt;a href=&quot;https://tc39.github.io/ecma262/&quot;&gt;ES2018/ES9 的语言规范&lt;/a&gt; 开始进入 ES2019 阶段.
最终阶段详情: &lt;a href=&quot;https://github.com/tc39/proposals/blob/master/finished-proposals.md&quot;&gt;finished-proposals&lt;/a&gt;
来看看 ES2018 比之前的 ES2017 新增了哪些规范.&lt;/p&gt;
&lt;h2&gt;Object Rest/Spread Properties&lt;/h2&gt;
&lt;p&gt;对于对象的 Rest/Spread, 而之前标准只有数组是支持的. 说出来你可能不信, 这是 ES9 的特性, 我感觉都已经用了很久了…&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; obj &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; z&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;rest&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; obj
&lt;span class=&quot;token comment&quot;&gt;// x = 1, rest = { y: 2, z: 3 }&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;很实用的一点比如 React props 可以这样写&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;props &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Asynchronous Iteration 异步迭代器&lt;/h2&gt;
&lt;p&gt;神奇的异步迭代器, 如果你之前这样写, 循环会依旧保持同步, 而异步独立于循环外, 为什么会导致这个情况想明白这个机制的同学可以去了解一下 js 事件循环.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; line &lt;span class=&quot;token keyword&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;readLines&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  	&lt;span class=&quot;token comment&quot;&gt;// line by line&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Promise.prototype.finally()&lt;/h2&gt;
&lt;p&gt;又一个以为早就有的特性, 当&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;结束时稳定被触发(无论&lt;code class=&quot;language-text&quot;&gt;resolve&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;reject&lt;/code&gt;), 几乎是扫尾工作专用方法.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token function&quot;&gt;fetch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;finally&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Fn&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;一系列正则优化&lt;/h2&gt;
&lt;h3&gt;&lt;code class=&quot;language-text&quot;&gt;s&lt;/code&gt; 标志和 &lt;code class=&quot;language-text&quot;&gt;dotAll&lt;/code&gt; 模式&lt;/h3&gt;
&lt;p&gt;之前 &lt;code class=&quot;language-text&quot;&gt;.&lt;/code&gt; 用于匹配任何单字符, 但有两个例外:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;无法匹配行结束符&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token regex&quot;&gt;/foo.bar/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;foo\nbar&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// → false&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;行终结符:&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;U+000A LINE FEED (LF) (\n) - 换行&lt;/li&gt;
&lt;li&gt;U+000D CARRIAGE RETURN (CR) (\r) - 回车&lt;/li&gt;
&lt;li&gt;U+2028 LINE SEPARATOR - 行分隔符&lt;/li&gt;
&lt;li&gt;U+2029 PARAGRAPH SEPARATOR - 段分隔符
以及:&lt;/li&gt;
&lt;li&gt;U+000B VERTICAL TAB (\v)&lt;/li&gt;
&lt;li&gt;U+000C FORM FEED (\f)&lt;/li&gt;
&lt;li&gt;U+0085 NEXT LINE&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;多字节字符(非 BMP), 比如 Emoji:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token regex&quot;&gt;/^.$/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;😀&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// → false&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;曾经可以通过 &lt;code class=&quot;language-text&quot;&gt;/u&lt;/code&gt; 解决:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token regex&quot;&gt;/^.$/u&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;😀&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// → true&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;而在 ES9 中，新增加了一个新的标志 &lt;code class=&quot;language-text&quot;&gt;s&lt;/code&gt;, 让 &lt;code class=&quot;language-text&quot;&gt;.&lt;/code&gt; 可以匹配任意单字符.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; re &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;foo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bar&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;s &lt;span class=&quot;token comment&quot;&gt;// Or, `const re = new RegExp(&apos;foo.bar&apos;, &apos;s&apos;);`.&lt;/span&gt;
re&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;foo\nbar&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// → true&lt;/span&gt;
re&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dotAll
&lt;span class=&quot;token comment&quot;&gt;// → true&lt;/span&gt;
re&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;flags
&lt;span class=&quot;token comment&quot;&gt;// → &apos;s&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;命名捕获组(RegExp Named Capture Groups)&lt;/h3&gt;
&lt;p&gt;以前:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; regex &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token regex&quot;&gt;/(\d{4})-(\d{2})-(\d{2})/&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; matchers &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; regex&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;exec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;2015-01-02&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
matchers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 2015-01-02&lt;/span&gt;
matchers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 2015&lt;/span&gt;
matchers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 01&lt;/span&gt;
matchers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 02&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;现在:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; re &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token regex&quot;&gt;/(?&amp;lt;year&gt;\d{4})-(?&amp;lt;month&gt;\d{2})-(?&amp;lt;day&gt;\d{2})/u&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; re&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;exec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;2015-01-02&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// result.groups.year === &apos;2015&apos;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// result.groups.month === &apos;01&apos;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// result.groups.day === &apos;02&apos;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// result[0] === &apos;2015-01-02&apos;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// result[1] === &apos;2015&apos;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// result[2] === &apos;01&apos;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// result[3] === &apos;02&apos;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;解构一起用:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  groups&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;one&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; two&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token regex&quot;&gt;/^(?&amp;lt;one&gt;.*):(?&amp;lt;two&gt;.*)$/u&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;exec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;foo:bar&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`one: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;one&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;, two: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;two&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// prints one: foo, two: bar&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;反向引用:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let duplicate = /^(?&amp;lt;half&amp;gt;.*).\k&amp;lt;half&amp;gt;$/u;
duplicate.test(&amp;#39;a*b&amp;#39;); // false
duplicate.test(&amp;#39;a*a&amp;#39;); // true&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;跟数字捕获组一起使用:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let triplicate = /^(?&amp;lt;part&amp;gt;.*).\k&amp;lt;part&amp;gt;.\1$/u;
triplicate.test(&amp;#39;a*a*a&amp;#39;); // true
triplicate.test(&amp;#39;a*a*b&amp;#39;); // false&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;替换字符&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let re = /(?&amp;lt;year&amp;gt;\d{4})-(?&amp;lt;month&amp;gt;\d{2})-(?&amp;lt;day&amp;gt;\d{2})/u;
let result = &amp;#39;2015-01-02&amp;#39;.replace(re, &amp;#39;$&amp;lt;day&amp;gt;/$&amp;lt;month&amp;gt;/$&amp;lt;year&amp;gt;&amp;#39;);
// result === &amp;#39;02/01/2015&amp;#39;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;反向断言(RegExp Lookbehind Assertions)&lt;/h3&gt;
&lt;p&gt;以往只支持正向断言, 现在支持了反向断言, 语法是 &lt;code class=&quot;language-text&quot;&gt;(?&amp;lt;=...)&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token regex&quot;&gt;/(?&amp;lt;=\$)\d+(\.\d*)?/&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这个例子会匹配 &lt;code class=&quot;language-text&quot;&gt;&amp;#39;$10.53&amp;#39;&lt;/code&gt; 捕获返回 &lt;code class=&quot;language-text&quot;&gt;&amp;#39;10.53&amp;#39;&lt;/code&gt;, 但不会匹配 &lt;code class=&quot;language-text&quot;&gt;€10.53&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;Unicode转义(RegExp Unicode Property Escapes)&lt;/h3&gt;
&lt;p&gt;设置&lt;code class=&quot;language-text&quot;&gt;\p{Script_Extensions}&lt;/code&gt; 或 &lt;code class=&quot;language-text&quot;&gt;\P{Script_Extensions}&lt;/code&gt;, 使得在 JS 的正则中使用 Unicode 字符, 包括一些奇奇怪怪的字符. 举个例子比如希腊字母:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; regexGreekSymbol &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token regex&quot;&gt;/\p{Script_Extensions=Greek}/u&lt;/span&gt;
regexGreekSymbol&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;π&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// → true&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;最后&lt;/h2&gt;
&lt;p&gt;目前大部分特性已经应用于主流浏览器了, 甚至有的早早就有, 也有一些正在实现过程中的. 但如果遇到要解决兼容性的问题还是得老老实实查 MDN, caniuse. 而 Node 端依然落后于标准设计, 这个有历史原因也有稳定性的要求. 新的标准出来的速度快其实大家也不用捉急, 原因在于生产中大部分时候我们其实用不到最新的标准, 或者已有其他的途径或老方法解决掉问题. 写出炫酷的代码不一定是最重要的, 能够解决掉问题才是最重要的. 而新标准更多的意义在于遇到真正刁钻问题的时候能够有解决方法或语言支持, 以及对代码抽象能力的提升, 性能的优化等.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[土豆🥔周报生成器]]></title><description><![CDATA[这是一个 Trello 风格的 Todolist + 根据模板自动生成带时间与签名的周报 的工具.
(基于 React + Redux. 支持拖拽操作, Markdown…]]></description><link>https://lqs469.github.io/土豆🥔周报生成器/</link><guid isPermaLink="false">https://lqs469.github.io/土豆🥔周报生成器/</guid><pubDate>Fri, 15 Jun 2018 17:58:38 GMT</pubDate><content:encoded>&lt;p&gt;这是一个 &lt;em&gt;Trello 风格的 Todolist + 根据模板自动生成带时间与签名的周报&lt;/em&gt; 的工具.
(基于 React + Redux. 支持拖拽操作, Markdown, 缓存本地)&lt;/p&gt;
&lt;p&gt;为解决我日益增长的忘记写周报以及写周报起来太麻烦的问题, 我做了这个工具帮我自己脱离苦海.用了一段时间, 发觉还不错, 推荐给有缘人使用…&lt;/p&gt;
&lt;p&gt;主要能节省下了回忆这周都做了什么, 和每次都要排版, 查日期的重复繁琐操作所浪费的时间.
(只要每次todo完成即可自动规划进入周报模板中).&lt;/p&gt;
&lt;p&gt;Todo =&gt; Done =&gt; 按模板生成周报&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://lqs469.github.io/TodoWeekly/#/&quot;&gt;在线地址&lt;/a&gt;
&lt;a href=&quot;https://github.com/lqs469/TodoWeekly&quot;&gt;Github&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f0acdb3251454126dd58f441a5823f56/caf50/todoweek.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 62.13373403456048%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMCBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAepqwmoP/8QAGRABAAMBAQAAAAAAAAAAAAAAAAECEhET/9oACAEBAAEFAsQxV5UZql1//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFxAAAwEAAAAAAAAAAAAAAAAAAAExEP/aAAgBAQAGPwJkIRb/AP/EABkQAAMBAQEAAAAAAAAAAAAAAAERIQAQ8f/aAAgBAQABPyGpRKDSHA8rCgFx/9oADAMBAAIAAwAAABD7D//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/EFf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAbEAEAAgMBAQAAAAAAAAAAAAABABEhMVFBcf/aAAgBAQABPxC+wqDFY+xNKW7zFm039gbYb0IwNZmtxXCf/9k=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;todoweek&quot;
        title=&quot;&quot;
        src=&quot;/static/f0acdb3251454126dd58f441a5823f56/c739e/todoweek.jpg&quot;
        srcset=&quot;/static/f0acdb3251454126dd58f441a5823f56/8ee9c/todoweek.jpg 148w,
/static/f0acdb3251454126dd58f441a5823f56/ebbe7/todoweek.jpg 295w,
/static/f0acdb3251454126dd58f441a5823f56/c739e/todoweek.jpg 590w,
/static/f0acdb3251454126dd58f441a5823f56/5413e/todoweek.jpg 885w,
/static/f0acdb3251454126dd58f441a5823f56/4efde/todoweek.jpg 1180w,
/static/f0acdb3251454126dd58f441a5823f56/caf50/todoweek.jpg 2662w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;</content:encoded></item><item><title><![CDATA[Reach-Router“真香👍”]]></title><description><![CDATA[Reach-Router 是前 ReactRouter 成员 Ryan Florence 开发的一套基于 react 的路由控件. 那么已经有比较成熟的 ReactRouter 了, 为什么要”再”做一套 Router 呢, 最初的原因有兴趣(hào shi…]]></description><link>https://lqs469.github.io/Reach-Router“真香👍”/</link><guid isPermaLink="false">https://lqs469.github.io/Reach-Router“真香👍”/</guid><pubDate>Tue, 05 Jun 2018 15:03:29 GMT</pubDate><content:encoded>&lt;p&gt;&lt;img src=&quot;/3910365c6be928469d0afb130c0ccee3-679f2858c4fa2dd342df5fc27b44dcc2.gif&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://reach.tech/router&quot;&gt;Reach-Router&lt;/a&gt; 是&lt;strong&gt;前&lt;/strong&gt; ReactRouter 成员 Ryan Florence 开发的一套基于 react 的路由控件. 那么已经有比较成熟的 ReactRouter 了, 为什么要”再”做一套 Router 呢, 最初的原因有兴趣(hào shi)的同学可以去了解一下, 本文会介绍 ReachRouter 并且说明具体比 React-Router 好在哪里.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;Overview&lt;/h2&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a1ae7f25f0842a04f991cc43c8a25bc5/a5ed1/7B44554A-6DDF-4F85-B1C8-263D85F6EB43.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 39.35483870967742%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABIUlEQVQY042PTVLDMAyFc/9zsOIO7NjAjjK0qZs6KU3z1yS1a8eOJTtByQwLBhZ8izeyR096irTSOU92PH96ft3H8dtmw7NTXlTnoijrprvdhJTGmGEw1tpxhQpediNg1B2yzcNjVst3fhF9VzdNVVVN01yvV1IhRN/39FPXdbVCRVFcXuJPbV0E1un2Pk/hLkXbdtRKBuq4rbRtW5bLLAIR559EECaFEwJstzvG2HFFSumcA0QHYNeclNZ7P30TpmkxI5kheMT9niUraZpyzik2rXLWeoTRWEQ//2Ixa5gAHGMHztNDktAU0phgyUd6Pl6q7fGklPrbrFygmwetrBnMoEn1QC+ljZE4Sxc0zn+y3KwhaPBc2LMcM2Fzaef/8QU4jsS4znpSEQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;7B44554A 6DDF 4F85 B1C8 263D85F6EB43&quot;
        title=&quot;&quot;
        src=&quot;/static/a1ae7f25f0842a04f991cc43c8a25bc5/b9e4f/7B44554A-6DDF-4F85-B1C8-263D85F6EB43.png&quot;
        srcset=&quot;/static/a1ae7f25f0842a04f991cc43c8a25bc5/cf440/7B44554A-6DDF-4F85-B1C8-263D85F6EB43.png 148w,
/static/a1ae7f25f0842a04f991cc43c8a25bc5/d2d38/7B44554A-6DDF-4F85-B1C8-263D85F6EB43.png 295w,
/static/a1ae7f25f0842a04f991cc43c8a25bc5/b9e4f/7B44554A-6DDF-4F85-B1C8-263D85F6EB43.png 590w,
/static/a1ae7f25f0842a04f991cc43c8a25bc5/a5ed1/7B44554A-6DDF-4F85-B1C8-263D85F6EB43.png 620w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;从 RF 的 Tweet 上简单的发布可以看出来, ReachR (以下都简称 ReachR)主打的是:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Accessibility, 也就是无障碍, 易用性.&lt;/li&gt;
&lt;li&gt;相对链接的跳转方式.&lt;/li&gt;
&lt;li&gt;嵌套的路由配置.&lt;/li&gt;
&lt;li&gt;合适的路径优先(顺序不会造成影响).&lt;/li&gt;
&lt;li&gt;…&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我们先不管这些 features 到底是什么, 我们先来看一看 ReachR 的设计意图: 根据作者的&lt;a href=&quot;https://reach.tech/router/credits&quot;&gt;原话&lt;/a&gt;, 整个 ReachR 项目是对 ReactR V3 和 V4 两个版本的一些优点的集成以及加入了一些作者一直想要的功能.&lt;/p&gt;
&lt;p&gt;那么跟 React-Router 比较一下呢:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;尺寸. 更少的依赖和更少代码实现够用的功能, ReactR 代码约为 229KB, ReachR 代码为 193KB, 组件依赖也更少.&lt;/li&gt;
&lt;li&gt;没有复杂的路由模式. 没有多余的可选参数或类似的东西，只是静态路径，参数和尾随通配符。&lt;/li&gt;
&lt;li&gt;不支持 React-Native. 讲道理, 你的路由根本用不上支持 RN.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;其实我认为最重要的一点, ReachR 比 ReactR 对开发者来讲: &lt;strong&gt;更好用&lt;/strong&gt;.&lt;/p&gt;
&lt;h2&gt;Under the hood&lt;/h2&gt;
&lt;p&gt;那么我们来具体看看 ReachRouter 的 API 设计:&lt;/p&gt;
&lt;h3&gt;渲染方法&lt;/h3&gt;
&lt;p&gt;跟 ReactRouter 不用在于, 在众多路由中只会根据 path 渲染一个最符合条件的子组件.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Router&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Home path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Dash path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;dashboard&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Router&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如图例, 组件直接加参数 path 的写法十分简洁, 当前 url 为 /dashboard 时, 只会渲染 Dash, 而当前 url = ‘/’ 时才会渲染 Home. 在 ReactRouter 中匹配则渲染的方式的确能解决一些组件复用的匹配情况, 然而我们遇到更多的情况则是希望专一的渲染单个组件.&lt;/p&gt;
&lt;h3&gt;Link 导航&lt;/h3&gt;
&lt;Link /&gt; 可以在任何位置放置, 没有限制, 不需要包裹进&lt;Router /&gt;.
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Link to&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;Home&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Link&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Link to&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;dashboard&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;Dashboard&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Link&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;通配符参数&lt;/h3&gt;
&lt;p&gt;通配符参数会直接注入 props, 用不着再 props.location…&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// at url &quot;/invoice/23&quot;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Router&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Home path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Invoice path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;invoice/:invoiceId&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Router&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Invoice&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;props&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;h1&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;Invoice &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;invoiceId&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;h1&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;其效果和 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;Invoice invoiceId={23} /&amp;gt;&lt;/code&gt; 一样, 简洁直接.&lt;/p&gt;
&lt;h3&gt;“智能”匹配最合适的路径&lt;/h3&gt;
&lt;p&gt;这是 ReachRouter 一个很棒的特性, 如下面例子&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Router&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Home path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Invoice0 path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;:invoiceId&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Invoice1 path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;invoices&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Invoice2 path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/invoices&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Router&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;当 url 为 ‘/invoices’ 这里谁更合适呢?
答: 渲染&amp;#x3C; Invoice1 /&gt;.
而当 url 为 ‘/123’ 会渲染 &lt;Invoice0 invoiceId={123} /&gt;.&lt;/p&gt;
&lt;p&gt;也就是说只有 url 准确匹配到 path 且为非通配符参数时, 会优先且只会渲染此组件, 而如果没有符合的 path, 才会去渲染包含通配符的组件, 这与顺序无关, 也就是说&lt;Invoice0 /&gt;, &lt;Invoice1 /&gt;交换顺序不会影响渲染逻辑.&lt;/p&gt;
&lt;p&gt;但是如果&lt;Invoice1 /&gt;, &lt;Invoice2 /&gt;交换顺序, 结果会怎么样呢?
答: 渲染第一个匹配的 path. 当 url = ‘/Invoices’ 时, 渲染第一个 path=‘invoices’ 或者 ’/invoices’ 的组件(二者是一样的, 所以匹配遇到的第一个).&lt;/p&gt;
&lt;p&gt;这一特性对比 ReactRouter V4 的实现, 不仅逻辑简单清晰, 还能够省下一个&lt;Switch /&gt;(不一定).&lt;/p&gt;
&lt;h3&gt;嵌套路由和嵌套子组件&lt;/h3&gt;
&lt;p&gt;这是 ReachRouter 相比最能体现其优点的地方. 嵌套组件在 Route 中, 它的 path 也会遵循嵌套, 并且其匹配的子组件将作为 props.children 传递.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Dash&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;h1&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;Dashboard&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;h1&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;hr &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Router&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Home path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Dash path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;dashboard&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Invoices path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;invoices&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Team path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;team&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Dash&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Router&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果 url 是 ’/dashboard/invoices’, 则将渲染 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;Dash&amp;gt;&amp;lt;Invoices/&amp;gt;&amp;lt;/Dash&amp;gt;&lt;/code&gt;. 如果它只是“/dashboard”, 子组件将不会被渲染, 只有 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;Dash /&amp;gt;&lt;/code&gt; 出现.&lt;/p&gt;
&lt;p&gt;并且基于这个特性我们终于可以在子路由内用 “/” 了&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Dash path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;dashboard&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;DashboardGraphs path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;InvoiceList path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;invoices&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Dash&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;组件逻辑关系一目了然, 是一个特别好用且经常用到的场景.&lt;/p&gt;
&lt;h3&gt;相对链接&lt;/h3&gt;
&lt;p&gt;子组件内的导航可以直接使用子组件的 path 来作为 to 的参数. 也就是相对链接(Relative Links), 当父组件的 path 改变时或者组件被移动到别处时, 这个特性显得很有用.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Router&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Home path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Dash path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;dashboard&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Invoices path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;invoices&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Team path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;team&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Dash&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Router&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Dash&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;h1&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;Dashboard&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;h1&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;nav&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Link to&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;invoices&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;Invoices&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Link&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Link to&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;team&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;Team&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Link&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;nav&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;hr &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;Dash /&gt;内的&lt;Link /&gt;不需要 to=‘/dashboard/invoices’ 而是直接 to=‘invoices’ 即可.&lt;/p&gt;
&lt;h3&gt;404 NotFound&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Home path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;NotFound &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;真的, 非常简洁.&lt;/p&gt;
&lt;h3&gt;支持多个 Router&lt;/h3&gt;
&lt;p&gt;如果你想要在应用中匹配多处的组件, 可以直接使用多个&lt;Router /&gt;. 这一点在导航菜单里非常常见.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Sidebar&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Router primary&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;HomeNav path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;DashboardNav path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;dashboard&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Router&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Sidebar&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;MainScreen&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Router&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Home path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;About path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;about&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Home&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Dash path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;dashboard&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Invoices path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;invoices&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Team path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;team&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Dash&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Router&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;MainScreen&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果你想要在一个&lt;Router /&gt;内部嵌套另一个&lt;Router /&gt;的话, 需要把外层的 path 加上一个 ‘/*’, 就能做到跟没有&amp;#x3C;Router/ &gt;一样效果的 path 嵌套, 这么实现对于组件复用或者在大型应用多代码模块分别开发有奇效.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Router&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Home path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Dash path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;dashboard/*&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Router&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Dash&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;p&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;A&lt;/span&gt; nested router&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;p&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Router&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;DashboardGraphs path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;InvoiceList path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;invoices&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Router&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;导航控制&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;navigate&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;@reach/router&apos;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Invoices&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;NewInvoiceForm
      onSubmit&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;event&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; newInvoice &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createInvoice&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;target&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;navigate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`/invoices/&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;newInvoice&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;就一个 &lt;code class=&quot;language-text&quot;&gt;navigate&lt;/code&gt; 函数, 够用了. 或者这样用: &lt;code class=&quot;language-text&quot;&gt;props.navigate&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Invoices&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;navigate&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;NewInvoiceForm
      onSubmit&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;event&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; newInvoice &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createInvoice&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;target&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// can navigate to relative paths&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;navigate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;newInvoice&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Navigate&lt;/code&gt; 会返回一个 Promise. 这表示可以使用迭代去控制页面的转场效果以及准确的数据流向, 使得和 react 的生命周期的配合变得非常流畅.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Invoices&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    creatingNewInvoice&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;LoadingBar animate&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;creatingNewInvoice&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;NewInvoiceForm
          onSubmit&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;event&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              creatingNewInvoice&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; newInvoice &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createInvoice&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;target&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;navigate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`/invoice/&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;newInvoice&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              creatingNewInvoice&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;InvoiceList &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;就这些!&lt;/p&gt;
&lt;h2&gt;In the end&lt;/h2&gt;
&lt;p&gt;在应用中, 一个 Router 只需要保证基本功能且稳定就足够了, ReachRouter 很好的做到了这一点. 以上是他对比于 ReactRouter 的一些优化特性. 解决了一系列备受吐槽的 ReactRouter V4 的奇葩设计. 总的来说, 够用且好用是 ReachRouter 的精髓, API 非常清晰且高效. 轮子年年有, 今年特别多, 现在尚不可预测未来 ReachRouter 会不会取代 ReactRouter, 但是其中的很多特性在前端路由模块的设计中很有意义, 作者也是这方面的带路者, 推荐大家去了解一下.&lt;/p&gt;
&lt;p&gt;除此以上 API 之外, ReachRouter 也有 Server Rendering API, navigate API, LocationProvider, createHistory 等前作实现的功能点保留下来, 并且都有部分优化. 感兴趣的同学可以去学习一发.✌️&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Reactv16.3的新生命周期]]></title><description><![CDATA[随着 react 16 版本的不断迭代, 更多新的特性也逐渐稳定下来. 本文主要介绍 react 16.3 版本中官方已经稳定下的新版生命周期. 新生命周期模型 为了配合异步渲染机制, 并且简化渲染更新流程, react…]]></description><link>https://lqs469.github.io/Reactv16-3的新生命周期/</link><guid isPermaLink="false">https://lqs469.github.io/Reactv16-3的新生命周期/</guid><pubDate>Thu, 19 Apr 2018 08:58:57 GMT</pubDate><content:encoded>&lt;p&gt;随着 react 16 版本的不断迭代, 更多新的特性也逐渐稳定下来. 本文主要介绍 react 16.3 版本中官方已经稳定下的新版生命周期.&lt;/p&gt;
&lt;h3&gt;新生命周期模型&lt;/h3&gt;
&lt;p&gt;为了配合异步渲染机制, 并且简化渲染更新流程, react 将去除三种生命周期方法, 加入两种生命周期方法. 在逐渐替换的版本迭代中, 旧版本将方法定位为不安全, 未来将不再继续维护, 预计下一次大版本更新会被废除.&lt;/p&gt;
&lt;p&gt;在这个示意图中能够很清晰的看到改版后的组件渲染更新和数据之间的逻辑和生命周期的步骤:

  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 55.24156791248861%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAB+UlEQVQoz1WSia6jMAxF+f+P6zJd9Fq6QFsogRAgZIFud+z0tZpBsqwbkeNrx9Hr9QJ/nIfBoxQF9vsdalnBWou+70MWQmCz2UBKCescjDEhioL/3yNN06AjBr3jCWM98rJFfMxwrTro3hBQo9caXdcFKGfd6VCIgzUXaZomFI7wz9f2HvuswzLOkRQGHWn+sRAleqpeVdUXXNd1cPTpwpHrAGRxPl/Q0kUGnkqPn2OF9V5gfSixSWU408bDO75oCWQDjO9y1tTBBx6VZYnZbE7QM7wfgpOmaYMTjtO1QUzQJFfYJgKVopkaAv22/AEyLACfzycejwc4G+vQaAepNFrKHBehybHAdpvhmHcolEPd9lCt/j7Mf0CG3e8Pgt7RdBapcGF+nLnVQ8YOK+SS4JXFRXokwqKoTXDJQO7kA494uEmSIMuy0PI43mktPK3QDY70c7hi6GKo6xLiPIXM/5De4uaK0JH37xXy3oeIxnF87xpBHjcL3AQeLgdGAdsm8O0BrtkR5BDi6c54+RMVkqGz9xLju8uRUgrr1Yoc5rgR0HQp6ipGT7BOpVDySEt+QCViyDKG0fR4NsM4KAzjAON4ngq97Un/OuRd8+RQO435foHJZobFYQVDLUhLI5Ep6SWmdD7fLXAkrayiB1SYxRPMtlOKCc05w1/3U0K0KtVJfgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;lifecycle&quot;
        title=&quot;&quot;
        src=&quot;/static/f427f1e779602498d7cd3a411101caa7/b9e4f/lifecycle.png&quot;
        srcset=&quot;/static/f427f1e779602498d7cd3a411101caa7/cf440/lifecycle.png 148w,
/static/f427f1e779602498d7cd3a411101caa7/d2d38/lifecycle.png 295w,
/static/f427f1e779602498d7cd3a411101caa7/b9e4f/lifecycle.png 590w,
/static/f427f1e779602498d7cd3a411101caa7/f9b6a/lifecycle.png 885w,
/static/f427f1e779602498d7cd3a411101caa7/2d849/lifecycle.png 1180w,
/static/f427f1e779602498d7cd3a411101caa7/ddfd0/lifecycle.png 2194w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
在线查看示意图: &lt;a href=&quot;http://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/&quot;&gt;React lifecycle methods diagram&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;计划去除的三个方法&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;componentWillMount&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;componentWillReceiveProps&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;componentWillUpdate&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;不过在 v16 这个大版本这些方法都不会立刻废除, 有足够时间完成迁移工作, 只是都会增加一个别名( UNSAFE 前缀):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;componentWillMount&lt;/code&gt; -&gt; &lt;code class=&quot;language-text&quot;&gt;UNSAFE_componentWillMount&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;componentWillReceiveProps&lt;/code&gt;  -&gt; &lt;code class=&quot;language-text&quot;&gt;UNSAFE_componentWillReceiveProps&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;componentWillUpdate&lt;/code&gt;  -&gt; &lt;code class=&quot;language-text&quot;&gt;UNSAFE_componentWillUpdate&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在 v16.3 包括之后的 v16版本两种写法你都可以使用, 不过在 v16.3 后面的版本使用旧的方法会得到一个警告. 而在 v17 版本将会彻底去掉旧方法, 只保留 UNSAFE 前缀的兼容方法.&lt;/p&gt;
&lt;h3&gt;新增了两个生命周期方法&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;getDerivedStateFromProps&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;getSnapshotBeforeUpdate&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;getDerivedStateFromProps&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Example&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getDerivedStateFromProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;nextProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; prevState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	    counter&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; prevState&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;counter&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
	  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;随着 &lt;code class=&quot;language-text&quot;&gt;componentWillReceiveProps&lt;/code&gt; 被废除, 接替前者地位的就是这个方法, 而且更加强大,  &lt;code class=&quot;language-text&quot;&gt;componentWillReceiveProps&lt;/code&gt;  只能在初次渲染之后的组件 props 更新时执行, 主要负责渲染之前的数据处理工作, 而 &lt;code class=&quot;language-text&quot;&gt;getDerivedStateFromProps&lt;/code&gt; 有着类似的功能, 但是在初次渲染和组件 props 更新都会被执行. 第一个参数是新传入的 props, 第二个参数是当前的 state. 他的返回和 &lt;code class=&quot;language-text&quot;&gt;setState&lt;/code&gt; 方法类似, 当返回 &lt;code class=&quot;language-text&quot;&gt;null&lt;/code&gt; 时不会更新任何状态, 而有返回的对象就内容是被更新的状态.&lt;/p&gt;
&lt;p&gt;值得注意的是, &lt;code class=&quot;language-text&quot;&gt;getDerivedStateFromProps&lt;/code&gt; 是一个静态方法(&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/static&quot;&gt;static - JavaScript | MDN&lt;/a&gt;). 它不能直接在非静态方法中使用 this 关键字来访问, 也不能访问到 this 上的方法. 但其实我们没有必要在这个周期使用到 this 上的方法, 一个是我们本来不应该在这个环节进行逻辑处理, 而且实际上这个周期中的所有逻辑处理都可以放到下一个周期去做.&lt;/p&gt;
&lt;p&gt;如果你同时用了 &lt;code class=&quot;language-text&quot;&gt;getDerivedStateFromProps&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;componentWillReceiveProps&lt;/code&gt;, 那么只有 &lt;code class=&quot;language-text&quot;&gt;getDerivedStateFromProps&lt;/code&gt; 会起作用, 而且还会收到一个警告.&lt;/p&gt;
&lt;p&gt;你也可以使用静态方法的写法:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;Example&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;getDerivedStateFromProps&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;nextProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; prevState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;getSnapshotBeforeUpdate&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Example&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;getSnapshotBeforeUpdate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;prevProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; prevState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这是一个新加入的周期, 基本上替代了方法 &lt;code class=&quot;language-text&quot;&gt;componentWillUpdate&lt;/code&gt;. 它发生在组件被渲染和更新之前的一点点, 是最贴近 VDOM 发生变化之前的一次执行方法. 参数是当前状态的 props, state 值. 他返回的值会被 &lt;code class=&quot;language-text&quot;&gt;componentDidUpdate&lt;/code&gt; 当做第三个参数.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token function&quot;&gt;componentDidUpdate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;prevProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; prevState&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; snapshot&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;snapshot &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;StrictMode&lt;/h3&gt;
&lt;p&gt;在版本迁移中, 我们可以使用官方提供的高亮组件工具来指导我们熟悉新的特性 —— &lt;code class=&quot;language-text&quot;&gt;StrictMode&lt;/code&gt;. 这个不会实际生成 DOM 的工具组件适用于在这个版本过渡阶段的开发环境中, 用于检查其子组件的是否存在问题, 并且高亮有问题的代码. 在 v16.3 中,  &lt;code class=&quot;language-text&quot;&gt;StrictMode&lt;/code&gt; 能够:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;确定使用了不安全的生命周期的组件&lt;/li&gt;
&lt;li&gt;高亮旧版不安全的 ref 用法&lt;/li&gt;
&lt;li&gt;检测意料之外的副作用&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;StrictMode&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  	&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ComponentOne &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ComponentTwo &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;StrictMode&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;总结&lt;/h3&gt;
&lt;p&gt;以上就是 v16.3 生命周期的新特性, 以前的应用逻辑基本都能比较完美的转换成新的周期方法, 而且新周期会对以前代码逻辑规范有一定提升, 逻辑上较之前的逻辑更为清晰, 对于HOC, render props 都能够比较好的支持. 对于更具体场景的迁移方法请看官方提供的一个示例&lt;a href=&quot;https://reactjs.org/blog/2018/03/27/update-on-async-rendering.html#examples&quot;&gt;Update on Async Rendering - React Blog&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[留个纪念吧]]></title><description><![CDATA[Cnode.org
 Babel.js Author tweet.]]></description><link>https://lqs469.github.io/_从小事做起/</link><guid isPermaLink="false">https://lqs469.github.io/_从小事做起/</guid><pubDate>Tue, 20 Mar 2018 21:36:41 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://cnodejs.org/topic/5aae1cc8f5dfc27d7ad98909&quot;&gt;Cnode.org&lt;/a&gt;

  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 55.64738292011019%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe3qUoP/xAAXEAADAQAAAAAAAAAAAAAAAAAAARAh/9oACAEBAAEFAjYr/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGRAAAgMBAAAAAAAAAAAAAAAAAAEQETFR/9oACAEBAAE/IVuQrohSEf/aAAwDAQACAAMAAAAQ8A//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAbEAEAAgIDAAAAAAAAAAAAAAABABEhMWFx8f/aAAgBAQABPxBDSlwfUE527gI2TiIANT//2Q==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;egg&quot;
        title=&quot;&quot;
        src=&quot;/static/972fda499884fcf59550ebd4b6bdb31a/c739e/egg.jpg&quot;
        srcset=&quot;/static/972fda499884fcf59550ebd4b6bdb31a/8ee9c/egg.jpg 148w,
/static/972fda499884fcf59550ebd4b6bdb31a/ebbe7/egg.jpg 295w,
/static/972fda499884fcf59550ebd4b6bdb31a/c739e/egg.jpg 590w,
/static/972fda499884fcf59550ebd4b6bdb31a/5413e/egg.jpg 885w,
/static/972fda499884fcf59550ebd4b6bdb31a/4efde/egg.jpg 1180w,
/static/972fda499884fcf59550ebd4b6bdb31a/4fd1a/egg.jpg 2178w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  &lt;/p&gt;
&lt;p&gt;Babel.js Author tweet.

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5320c6ed47bcc19e57079e85501dd32e/4db5f/HenryZhu.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 35.85858585858586%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABXklEQVQoz4WRWXLTQBCGdeI8cglOQCVcgiNQBTyAFVmLJUdLbAsiL0lkS5T20ZeeSXjiIV31V/d0T/+9Wb7n47oeZVlyOBwoioJxHNEyz/N/UAKJkNeK78XID4H3OBm/jlvXn264uf7Mw/7AOk7If/9BKcV78iUbuPra8OFby0e7Z5zUK2FxfGR/eqKqasrzRQITTdNS17XoRvyVsbuupxJ9uVz4K/HnHk6N4ig4d4q2H0whSw83yBSB72PfOmTZPev1HWEYYdu3/Py1wPU8ttstztLFcZZEcYp/7IieRzY1JGfFqe5eCdtR2AVZlhmiJE0NWSrvxcLGk0J3cUyaZkTRmiRJRUd4S4fqXDJPA2Pf0vcder1WN0EzTJKQEqxCQxZKQp7n0tEST44WBCv8IGCz2bJ6++N6ulDCQ7E39ioMze6tdpqlw5lYutAj73Y7k6hJ/42vu9T7fE/0UV4AnuYJfK2W+A8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;HenryZhu&quot;
        title=&quot;&quot;
        src=&quot;/static/5320c6ed47bcc19e57079e85501dd32e/b9e4f/HenryZhu.png&quot;
        srcset=&quot;/static/5320c6ed47bcc19e57079e85501dd32e/cf440/HenryZhu.png 148w,
/static/5320c6ed47bcc19e57079e85501dd32e/d2d38/HenryZhu.png 295w,
/static/5320c6ed47bcc19e57079e85501dd32e/b9e4f/HenryZhu.png 590w,
/static/5320c6ed47bcc19e57079e85501dd32e/f9b6a/HenryZhu.png 885w,
/static/5320c6ed47bcc19e57079e85501dd32e/2d849/HenryZhu.png 1180w,
/static/5320c6ed47bcc19e57079e85501dd32e/4db5f/HenryZhu.png 1188w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;</content:encoded></item><item><title><![CDATA[跳一跳全自动化”辅助工具”iOS版]]></title><description><![CDATA[自从微信开放小游戏平台，跳一跳这个小清新（CHAOXI…]]></description><link>https://lqs469.github.io/跳一跳全自动化”辅助工具”iOS版/</link><guid isPermaLink="false">https://lqs469.github.io/跳一跳全自动化”辅助工具”iOS版/</guid><pubDate>Thu, 11 Jan 2018 22:41:57 GMT</pubDate><content:encoded>&lt;p&gt;自从微信开放小游戏平台，跳一跳这个小清新（CHAOXI）的小游戏突然火了起来，对于资深手残党的我来说，虽然只是简简单单的一按一放，但是有句古话说的好：“听过很多道理，依然过不好这一生”。无数次挫败的感觉让我想起来被魂系列折磨的一个个深夜… 随着各种各样的“辅助工具”也是层出不穷，我也决定抽业余时间也来实现了一个吧。使用JS实现，已开源，需要的同学自取：&lt;a href=&quot;https://github.com/lqs469/jump&quot;&gt;微信跳一跳全自动化“辅助”工具ios版&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;话不多说，如图所示：
&lt;img src=&quot;/IMB_eQlAvL-ffceeeef85c4fdeb17527be5ab9bd6c3.gif&quot;&gt;&lt;/p&gt;
&lt;p&gt;因为手头只有iOS设备，所以只实现了iOS版。目前已经实现完全自动化（如图），安全上分，放心使用。ps: 这是外挂，好孩子不要学哦…..&lt;/p&gt;
&lt;h2&gt;解决思路&lt;/h2&gt;
&lt;p&gt;首先是解决连接问题，如何让我的程序能够触及设备。方法是使用WebDriverAgent调试工具，它能够模拟设备状态并提供可操作的接口。接下来：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;使用WDA提供的API完成截屏并输出。这一步得到跳跃前的状态以待分析。&lt;/li&gt;
&lt;li&gt;分析截屏，得到起跳位置和平台目标位置。&lt;/li&gt;
&lt;li&gt;通过某种公式计算得到按压时间&lt;/li&gt;
&lt;li&gt;使用WDA接口完成按压动作来实现跳跃。&lt;/li&gt;
&lt;li&gt;…重复…&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;思路很简单。讲一点实现。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;分析起跳位置：因为我们控制的&lt;del&gt;”小棒“&lt;/del&gt;（误）基本由紫色构成，而图中别的元素并没有有紫色，所以可以通过过滤得到图中所有紫色色值区间内的点坐标来取一个平均值，得到它的基本位置，结果表示比较理想，基本每次都是同一个位置能够定位到起跳点。&lt;/li&gt;
&lt;li&gt;平台落点位置：最佳的目标点最好落在平台的正中央，我使用的方法比较取巧，首先得到背景颜色的色值区间，这样就可以判断当前坐标点是否是背景，然后开始在起跳点左上或右上的一个区域内从上往下从左往右地遍历，得到第一个非背景的坐标点。本想以此为目标点的横坐标，但是是实验过程中发现因为有圆形平台和图像中物体边缘会出现色值不稳定的情况，这样会大大影响到取点的精度。所以我在得到第一个非背景色的点坐标之后，再从该点的横坐标最右端向左遍历，找到第一个非背景色的点，然后两点取中点，这样得到的点就不会被圆形平台所影响了。然后开始取纵坐标，首先取得前一步得到的中点位置稍微下面一点的坐标点的色值（这么做的目前是为了避开边缘不稳定色值的区域），这个色值就是平台顶部的一部分颜色。然后拿这个色值在中点的纵坐标从上往下遍历，找到最远的一个同色值得点坐标，原因是因为大部分平台顶部的图像是对称的，所以不论刚才取到的色值是否是顶部的主要颜色，其另一段都会有一个颜色与之对应，这样两点取中点就得到了顶部的中点（该方法在音响平台的时候会失效，因为音响平台顶部图案是不规则的，但是因为跳一跳有反作弊手段，连续跳到中心点过多就会被系统判定作弊，所以遇到音响平台跳不到中心正好避免了反作弊措施…）&lt;/li&gt;
&lt;li&gt;计算按压时间：首先算得两个点距离d，我们可以猜到，这个距离一定和按压时间存在某种关系，那么是什么关系呢，这个让我研究了好一阵。网上有很多文章都写的是线性关系，也就是 &lt;code class=&quot;language-text&quot;&gt;y = kx + b&lt;/code&gt; ，但是我实践了很多次之后无论如何都无法计算出一个合理的k值。多次试验表明情况似乎不是这样。按压时间和距离的关系更接近于一个指数关系，于是我开始用 &lt;code class=&quot;language-text&quot;&gt;y = kx^2 + b&lt;/code&gt; 的公式来套实验数据，计算得到k，b值之后再实践，发现这样更为合理，继续实验的结果表明指数关系近更似于真实情况。&lt;/li&gt;
&lt;li&gt;不同设备参数各异：关于参数的问题是肯定的，不同的设备因为分辨率不同，跳跃参数也不尽相同，由于我手头设备有限，目前只实验得到了iphone7和iPhoneX的参数（后续大概率会继续更新不同设备的参数，所以强烈欢迎同学们算出自己设备参数之后共同维护项目）&lt;/li&gt;
&lt;li&gt;接下来就是重复的过程，不过中间会停留一段时间，一为跳跃完全落下，二为得到魔方井盖等停留加分平台的分数。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;使用说明&lt;/h2&gt;
&lt;h3&gt;需要环境&lt;/h3&gt;
&lt;p&gt;(括号里是我使用的版本, 别的版本未经实验不保证成功, 机型: Iphone7)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Nodejs (v9.3.0)&lt;/li&gt;
&lt;li&gt;NPM (v5.5.1)&lt;/li&gt;
&lt;li&gt;xcode (v9.2)&lt;/li&gt;
&lt;li&gt;WebDriverAgent&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;准备步骤&lt;/h3&gt;
&lt;p&gt;前两个就不说了，安装Node和NPM推荐使用&lt;a href=&quot;https://github.com/creationix/nvm&quot;&gt;NVM&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/facebook/WebDriverAgent&quot;&gt;WebDriverAgent&lt;/a&gt;是Facebook出的一套iOS的WebDriver工具, 简单来说可以实时把连接的iOS设备状态模拟到一个Web服务器上, 提供一系列调试接口. 更多信息可以在项目主页里看到, 安装过程为:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;克隆到本地&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; clone https://github.com/facebook/WebDriverAgent.git&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;进入文件夹运行脚本&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;./Scripts/bootstrap.sh&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;脚本运行需要&lt;a href=&quot;https://github.com/Carthage/Carthage&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Carthage&lt;/code&gt;&lt;/a&gt;和&lt;code class=&quot;language-text&quot;&gt;npm&lt;/code&gt;, 这两个都是用来安装WDA的依赖包的, 看样子是依赖了node和iOS两种生态, 分别负责原生和Web两个模块, 安装&lt;code class=&quot;language-text&quot;&gt;carthage&lt;/code&gt;直接 &lt;code class=&quot;language-text&quot;&gt;brew install carthage&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;用Xcode打开文件夹里的 &lt;code class=&quot;language-text&quot;&gt;WebDriverAgent.xcodeproj&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果是真机调试, 连接iOS设备后需要iOS开发者签名, 这一部分不做说明, 跟正常iOS开发一样, 需要注意的是, 要对项目内&lt;code class=&quot;language-text&quot;&gt;WebDriverAgentLib&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;WebDriverRunner&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;integrationApp&lt;/code&gt;都需填入开发者签名. 提供一个很好的中文参考文档&lt;a href=&quot;https://testerhome.com/topics/7220&quot;&gt;iOS 真机如何安装 WebDriverAgent&lt;/a&gt;. 还有就是国行的iOS设备需要端口转发才能访问, 需要将手机的端口转发到Mac上. 使用工具&lt;code class=&quot;language-text&quot;&gt;imobiledevice&lt;/code&gt;即可:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ brew &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; libimobiledevice
$ iproxy 8100 8100&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;运行WDA的test: [Product] -&gt; [test], 或者&lt;code class=&quot;language-text&quot;&gt;CMD + U&lt;/code&gt;. 之后iOS设备会安装一个WebDriverAgent App, 自动打开黑屏然后自动退出, 期间不用管它, 如果迟迟不退出, 有可能是失败了, 断开设备重连再运行test(还是失败可以删除App再试一试). 在App退出之后就可以正确运行js脚本了.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;然后在项目根目录安装npm依赖(单独目录clone本项目, 和WDA结构上是独立分开的…), 运行:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; i&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;运行脚本&lt;/h3&gt;
&lt;p&gt;WDA启动之后, 可以尝试打开&lt;code class=&quot;language-text&quot;&gt;http://127.0.0.1:8100/status&lt;/code&gt;查看设备状态, 正常情况会有JSON返回, 打开&lt;code class=&quot;language-text&quot;&gt;http://127.0.0.1:8100/inspector&lt;/code&gt; 能看到这样：&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/371358516a4155f6b3f29d19ddf5c9a2/87846/inspec.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 75.06092607636067%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACSUlEQVQ4y32SW28SURDH98t6ifHNtH3xCxiN6ZNvxofqQ6MvDTGRShUhxohVoVxaWQJ21+5y2wu7sPc9f+ccWAIpMMmfAc7Mb+acGWk2m8F1XRiGAb3fh+O4SJIEURQjiklRJM4dx8FkMhHyfR/x4iymWM/zYNu2iJF4MmMMYRii2+3CJDA3lqbif259KqSqqjjn4gW4pRTDzTRNtNttKIoCyXA8jO0pomSezD9TNve8CO+c+yw5s5SCeMGsaGaS7jDII4bOKIU8TNAZM9SvXdR7FsKYYTAYENQUiRyaLjpfhWVn3EudvodSXcfVkKGpxWj1E1yoAckTQMZSaJou3itL3gTMJP0dR6gqgYA1tAj1m5AUoaXH8MP5Nfmj83dcNc5aBS6v3CPgbzVEjbqqkupaguYAAuyFiQhy3SldfQjLsmgAlphoNkz+2mvAzjBApTfDT8VDTU9Qamg4KVbxi3570bxDvlq6rot14d+zIW3sUCbgDyXE+XWAk3IDe/sHeHD/Do7e5hAQL03iBbAv1iMIgrV3uwVsE/AoV8bB42d4+S6PJ4cv8PT5IT58vYBPQxnSlN3pdG3vNg1lCfxUaeHR3j4e3ruLV6+P8Y2u/+XKQEXxMQ1i/KOFtix7ZRhsd4c11cGb/Hcc5woo1FSUOg5K8gRl2caMhhIE/q2V2Qms30xR7JBkhzRB8Y+Jz6SSbIkON3W2E1hVJ8g3Rji7HKNAOrs0yBsENZbAbZCNwPOuife1AT42Rzgl8Cl5XqDQGsP1463J24D/AfH8c12t2fAXAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;inspec&quot;
        title=&quot;&quot;
        src=&quot;/static/371358516a4155f6b3f29d19ddf5c9a2/b9e4f/inspec.png&quot;
        srcset=&quot;/static/371358516a4155f6b3f29d19ddf5c9a2/cf440/inspec.png 148w,
/static/371358516a4155f6b3f29d19ddf5c9a2/d2d38/inspec.png 295w,
/static/371358516a4155f6b3f29d19ddf5c9a2/b9e4f/inspec.png 590w,
/static/371358516a4155f6b3f29d19ddf5c9a2/f9b6a/inspec.png 885w,
/static/371358516a4155f6b3f29d19ddf5c9a2/2d849/inspec.png 1180w,
/static/371358516a4155f6b3f29d19ddf5c9a2/87846/inspec.png 2462w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;其他API看&lt;a href=&quot;https://github.com/facebook/WebDriverAgent/wiki/Queries&quot;&gt;这里&lt;/a&gt;, 其实这里的Wiki也不全, 我看过WDA源码之后找到这个&lt;a href=&quot;https://github.com/facebook/WebDriverAgent/blob/master/WebDriverAgentLib/Commands/FBElementCommands.m#L60&quot;&gt;文件&lt;/a&gt;, 里面应该是完整的API代码, 比较语义化, 应该能看得懂(主要会用到&lt;code class=&quot;language-text&quot;&gt;screenshot&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;touchAndHold&lt;/code&gt;的API).&lt;/p&gt;
&lt;p&gt;一切正常之后, 打开微信跳一跳, 开始游戏后在本项目根目录运行&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm start&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;p&gt;为了更利于分析图像，我先对图像进行了一个劣化处理，以方便更好的划分边缘，(Ps: 欢迎和我谈论改进, 乐趣在开发过程, 所以我自己也就最多几千分就没挂着了, 不知道后面几万分会怎么样…先写这么多,  欢迎提issue或直接找我.)&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/bb6f44fa707fcbbb77fc1269d41aebec/48a11/demo.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 500px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 46%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMEBf/EABYBAQEBAAAAAAAAAAAAAAAAAAMBAv/aAAwDAQACEAMQAAAB7cqxO6Qmf//EABgQAQEAAwAAAAAAAAAAAAAAAAExABAR/9oACAEBAAEFAm9wjon/xAAVEQEBAAAAAAAAAAAAAAAAAAAQQf/aAAgBAwEBPwGH/8QAFhEAAwAAAAAAAAAAAAAAAAAAARAx/9oACAECAQE/ARV//8QAFxABAAMAAAAAAAAAAAAAAAAAEAAhgf/aAAgBAQAGPwKW6f/EABoQAAIDAQEAAAAAAAAAAAAAAAABITFBUYH/2gAIAQEAAT8hYqOJ6Vl/R4Kj/9oADAMBAAIAAwAAABDsH//EABYRAQEBAAAAAAAAAAAAAAAAAAABQf/aAAgBAwEBPxDUR//EABYRAAMAAAAAAAAAAAAAAAAAAAEQIf/aAAgBAgEBPxA6X//EAB0QAAICAQUAAAAAAAAAAAAAAAERACEQMWFxgfD/2gAIAQEAAT8QUioiy4kiFUDZiGyJbTR4Tw7xv//Z&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;demo&quot;
        title=&quot;&quot;
        src=&quot;/static/bb6f44fa707fcbbb77fc1269d41aebec/48a11/demo.jpg&quot;
        srcset=&quot;/static/bb6f44fa707fcbbb77fc1269d41aebec/8ee9c/demo.jpg 148w,
/static/bb6f44fa707fcbbb77fc1269d41aebec/ebbe7/demo.jpg 295w,
/static/bb6f44fa707fcbbb77fc1269d41aebec/48a11/demo.jpg 500w&quot;
        sizes=&quot;(max-width: 500px) 100vw, 500px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h3&gt;关于不同设备的参数&lt;/h3&gt;
&lt;p&gt;参数在配置文件 &lt;code class=&quot;language-text&quot;&gt;/config.json&lt;/code&gt; 中配置&lt;/p&gt;
&lt;p&gt;我使用的iphone7, 也是配置文件中默认参数, 欢迎其他设备的同学提供对应的设备参数(PR, issue均可).&lt;/p&gt;
&lt;ul&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; checked disabled&gt; iPhoneX&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; checked disabled&gt; iPhone7&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; checked disabled&gt; iPhoneSE&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; iPhone7P&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; iPhone6P&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; iPhone8&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; iPhone8P&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[订餐的烦恼]]></title><description><![CDATA[在开始今天的”故事“前，先跟大家特别是据说在西溪园区有四五个食堂的幸福人群来科普一下： 美餐App。一个服务于阿里部分没有食堂的BU的神奇外卖App，主要任务是每天能够定时定点的投喂外卖给加班的程序猿，而美餐的订餐最后截止时间在每天的下午…]]></description><link>https://lqs469.github.io/订餐的烦恼/</link><guid isPermaLink="false">https://lqs469.github.io/订餐的烦恼/</guid><pubDate>Wed, 22 Nov 2017 16:34:10 GMT</pubDate><content:encoded>&lt;p&gt;在开始今天的”故事“前，先跟大家特别是据说在西溪园区有四五个食堂的幸福人群来科普一下：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;美餐App。一个服务于阿里部分没有食堂的BU的神奇外卖App，主要任务是每天能够定时定点的投喂外卖给加班的程序猿，而美餐的订餐最后截止时间在每天的下午5点准时停止。所以如果你错过了投食的申请时间，那么抱歉，对于没有时间出去吃一顿的加班汪来说，你就要饿肚子了…&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b01df5aefb62e8041b5c7fa772192815/d19c0/1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 500px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 73.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAABlklEQVQoz5VTy07DMBDkzzlxQvA7CIkDEuIlxI0DAvEoEk2buPFj/Uxcm4lTWkCAYKQkG2dmZ73ebIUQvLc+2L6Lfdf341UQgsNHay0RGWNwd86VxRW2wCESSklBjdJcKRJCgAeNQ1LvsTKvZzWbMrZACucNMq7Exdkb7St+w+SzJicEH01SSn1BzinlZR4eaVxciRFprRljRBomRMMlpURGsOu6ZqwJocPrcrlci/G6EoMN0lC5ELIAwShGzDkHDy1I7/joHOHWNDXuoqBo+Vg2orZtkeiLeOOstWO1IOVIOuxZK6ckWjVsFRXBOcYI6jfiGNNc3N2+Hr2050/N6YSdTdj5Mzvh9jGnDFuIYQsBZLlgU3aK+b45OH7Yvp7vX7zuXk53r6q9i+nOhA4hrmYVzEfqd2VHNEzPqjkOWojhuJUkwZV3Q8MWi0VVVejo6Py1YeMwoT1lpML7bAXsEzycIqblR2dQ8z/xyXk9Omv8VTzU0BkybQi9NdISRqIzVmGG/+KMMelD52Ifyx9Tgs7/sp21+A2zXmJNdodYuQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;1&quot;
        title=&quot;&quot;
        src=&quot;/static/b01df5aefb62e8041b5c7fa772192815/d19c0/1.png&quot;
        srcset=&quot;/static/b01df5aefb62e8041b5c7fa772192815/cf440/1.png 148w,
/static/b01df5aefb62e8041b5c7fa772192815/d2d38/1.png 295w,
/static/b01df5aefb62e8041b5c7fa772192815/d19c0/1.png 500w&quot;
        sizes=&quot;(max-width: 500px) 100vw, 500px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h3&gt;前言&lt;/h3&gt;
&lt;p&gt;什么 ？又过了订餐时间 ? …&lt;/p&gt;
&lt;p&gt;”啪啪啪…“，在一阵急促的键盘敲击声中，时间不知不觉已经到了4点60分，忙碌的程序猿小哥已经坐在显示器前超过3个小时了，办公室又热又闷，可以明显觉察到空气是不流通的，电脑的风扇散热提醒他应该调整一下姿势，于是他决定起来走一走，站起身，突然他觉得身体有点异样，饿了…&lt;/p&gt;
&lt;p&gt;一看表，已经是4点61分。完蛋，又完美地错过了5点的订餐时间… 看来今天的晚餐注定又要凑合挨饿了。哎，要是有一个提醒我及时订饭的服务就好了，闹钟？不不，那么low的东西怎么能彰显我的geek精神呢。对，为了能按时喂饱自己就做一个钉钉机器人吧，不不，只做一个机器人怎么够，既然要做就做个全套的，再研究一下美餐的订餐数据，找到最好吃的最受欢迎的套餐，恩，听起来不错，就这样，动手~&lt;/p&gt;
&lt;h3&gt;抓抓数据&lt;/h3&gt;
&lt;p&gt;美餐的数据是个很蛋疼的问题，因为美餐并不是一个2C的应用，它是企业直接对接美餐应用然后员工就有权限去浏览餐厅的信息，所以在网上直接爬数据的传统方法就行不通了。后来我通过App抓包的方法，发现使用自己的独立账号可以抓到所有高德（应该是自己BU都使用同一个权限）员工有权限订餐的餐厅数据，整理了一下接口之后总结出了从餐厅选择到订餐流程的各个接口的意义，（中间还意外的发现了原来美餐还提供了一个&lt;a href=&quot;https://meican.com/preorder/static/group&quot;&gt;web端&lt;/a&gt;入口…）。很好，这样就可以直接拿官方数据开始做数据的收集工作了。&lt;/p&gt;
&lt;p&gt;订餐的第一步，也就是选择可选订餐地点，这个跟员工的BU有关，我也只能看到高德员工可选的地点，得到的数据格式是这样（去掉了一些无关的数据）：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// API: https://meican.com/preorder/data/group?x={ userId }&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	groups&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; title&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;首开&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ... &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
 		&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; title&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;方恒国际&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ... &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		...
	&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;选择地点之后接着要选择订餐时间点，每个时间点的餐厅会有不同，并且带着当前时间是否可订的状态（这个状态也是我们做订餐机器人判断是否可订餐的重要依据，字段&lt;code class=&quot;language-text&quot;&gt;status&lt;/code&gt;），接口数据如下（去掉了一些无关数据）：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// API: https://meican.com/preorder/api/v2.1/calendarItems/list？beginDate=2017-11-1&amp;amp;endDate=2017-11-8&amp;amp;withOrderDetail=false)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 默认会得到一周的可订餐信息，所以会有开始时间和结束时间&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	dateList&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			calendarItemList&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
				&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
					openingTime&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
						closeTime&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;16:30&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
						...
					&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
					title&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;高德地图（首开外卖）晚餐1&quot;&lt;/span&gt;
					status&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;NOT_YET&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;					
					...
				&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
				...
			&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		...
	&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	...
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;从接口数据还可以知道订餐截止的时间，那么就可以根据这个做出最晚订餐时间的安排计划，比如我希望能在截止时间前30分钟提醒我。&lt;/p&gt;
&lt;p&gt;继续选择我们想要的时间地点组合，例如上面的 “18：30  高德地图（首开外卖）晚餐1”，就会得到所有可选店铺的列表：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// API: https://meican.com/preorder/api/v2.1/restaurants/list?&amp;amp;tabUniqueId=ff4df9a0-9851-4205-adae-b154cc05d811&amp;amp;targetTime=2017-11-01+16:30&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	restaurantList&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			availableDishCount&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
			dishLimit&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
			latitude&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;39.991464&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
			longitude&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;116.396763&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
			name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;宅食送(UBP店)&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
			...
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		...
	&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;返回数据里不光有店铺信息和地理位置，居然还有可以总订餐量（dishLimit）和当前可订量（availableDishCount），这就十分贴心了，这个数据就可以用来分析餐厅受欢迎的情况。&lt;/p&gt;
&lt;h3&gt;发发推送&lt;/h3&gt;
&lt;p&gt;我们已经得到了数据，那么就需要完成计划的第一步，做一个钉钉机器人来告诉我“该订餐了”。步骤如图所示：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;打开钉钉的聊天窗口，找到机器人&lt;/li&gt;
&lt;li&gt;直接添加机器人，然后选择自定义机器人&lt;/li&gt;
&lt;li&gt;然后下一步，最后会给你一个webhook，那个就是用来发送推送的hook&lt;/li&gt;
&lt;li&gt;然后只需要在代码里合适的时机post这个webhook 就可以触发机器人在当前聊天群里的动作了&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9d00a3eaf5e5c95a6a7f53f9371cb66d/d19c0/2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 500px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 103.60000000000001%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC+0lEQVQ4y41UyZLbOAzt//+a1BxyzkwuqUollaSyddJ2223JlixSFBftst880EvstFOVwxMBEHwEQEB3Xddh7HvM0hyPmULwAdb9hgubrjy0DSiVQZluUFYOPgT05BCuO/lMQ4+P8wQfF2s462CsP6MSEmPjwYp6ph1y47HNNbJlilxVcM5fE3ZU+jqgcRbWWpL+gq0qLJcLlKXmQUZDHy97lJ338N6hJ8cVYT8McEpH4nG3xzBO6McRwzSh4b4qy4NOnOzjbodpv0cINZqmuSDsu3iDr2vsJX3WQyUrPD08YPnjBxb390jn86N+j6fFCkW2xcDIBkYoWVwT8iM3lkmCt6/+hSkMCkVnpjQJeGjHNHeUdyLzwr1cThKxh3WKpm1vE77/7zXKbQGjDYIxaHh7T4KJ+4KRpRmlK0g4CokpYZfLWJbrGlKp6VQzglAU8NmGyFClKcxmg4yrVryIe05AW4T48kx3SXgSZI04Fl7gmZbVGsmXL2jz7FCvY0Znv+O5E8fdJfslWrGzbum373jxz8uYesOoAzO55f8swluQEtTrNR5nM+zZJoGp/zWhrIMUnZB1oC6NW0sTk6iRmjH9lo8h+yf/P6Ysj+LYW9oZzq5jw4Y4NYaTsmIHyFpRF7uPE3KAnHsWodwaR6n2SOwWyleHVycaWaV+R10IRZdVGrr6vbFFEIM4dG2HUpeojtEUSp2hOX5ii2XhK8sYjtIJjPImoWw4dr70XODBjI+RsGlXiyXS1Qrp01PEhukXeQ7PS1tGbG9FKII8gGEk5eMcjrNcLuZRVrMH9uFnqPlDlIvZT+j5jBOygOMAWJaquzUpBwzwPeBHQIcRWdXCNDusdYBp96g6nKHrCaa+0dhnJTbzgNlK4d2nryh0hcUyQV6UUZYfreIqstjabkThJ/6luthiXXf5gz0S9sOInyR88+Eehe34Z26xYXTJljUt6yivVUBaOCg3ILcj6rZ7HuFV2IP8QPd07A9g1A1Rt0OUT3po+Jjt9diK/D+DSUv3LdoolAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;2&quot;
        title=&quot;&quot;
        src=&quot;/static/9d00a3eaf5e5c95a6a7f53f9371cb66d/d19c0/2.png&quot;
        srcset=&quot;/static/9d00a3eaf5e5c95a6a7f53f9371cb66d/cf440/2.png 148w,
/static/9d00a3eaf5e5c95a6a7f53f9371cb66d/d2d38/2.png 295w,
/static/9d00a3eaf5e5c95a6a7f53f9371cb66d/d19c0/2.png 500w&quot;
        sizes=&quot;(max-width: 500px) 100vw, 500px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;推送格式有个很好的功能就是支持markdown，这样就可以很方便的组织内容。更加详细的推送内容格式和方法参考这里的官方文档&lt;a href=&quot;https://open-doc.dingtalk.com/docs/doc.htm?spm=a219a.7629140.0.0.karFPe&amp;#x26;treeId=257&amp;#x26;articleId=105735&amp;#x26;docType=1&quot;&gt;钉钉开放平台 - 文档中心&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;我选用NodeJS来做推送服务，首先是抓取数据，做过滤，格式转换，然后当 ”status“值为“AVAILABLE”且当前时间比结束时间早3个小时的时候通知我，代码会隔一分钟访问一次接口，这样就不会在同一分钟内通知我两遍，这样推送的代码就完成了。另外我还在推送内容里加上一张来自&lt;code class=&quot;language-text&quot;&gt;lorempixel.com&lt;/code&gt;的随机美图来促进我的食欲。&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a5712efaa549b7c9f6fb74b6c3d4f984/d19c0/3.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 500px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 57.400000000000006%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABqklEQVQoz2P4+/f/ts0rzQx47C1ErE2EXI2km6PMZ+S6+TgqqSqxy4gzbN264f///19//Pnx+z8aYgBKnD25syhWqybDNC1YQ1eaO9JKYV9P6uLqkEAr8UR/2aOHdwDVfPuJQ/Opk7sTIrVyUi1yksy0JbnNFIVmZruurvCN91COC5Y7fnQnPs0nT+zWUBfg4GKRkeZ1M5ES42KMNJbcUusXG6Lu7Shy+OA2nJr//P9/797t2TPay8uK8woKp0/tmTete9GU7j1r5ixfNHHJgr47d28D1Xz/9Q+LZiD++fvvmzdv3719++XL5/8Y4PdfoM7/mDqhmn/8+nP//r2HDx/eu3fv0aOHQParly8/fvjw/v37jx8/fPvxG6tOkOaff/5/+vL94oUL165du3LlytOnT1++fPHx46fv379/+/btBxD8+otT8/ff/3/9+f/8+fNnT0Hg2bNnL168ANv58dOnT3///v315993PJp//v4H9t2/b7/+vf/27/PPfx+///ny4/efP3/+/fsLlMWpGcr6+RfovO8//377+e87iP0PiIDafmILZDgCADx2IWGKN3pxAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;3&quot;
        title=&quot;&quot;
        src=&quot;/static/a5712efaa549b7c9f6fb74b6c3d4f984/d19c0/3.png&quot;
        srcset=&quot;/static/a5712efaa549b7c9f6fb74b6c3d4f984/cf440/3.png 148w,
/static/a5712efaa549b7c9f6fb74b6c3d4f984/d2d38/3.png 295w,
/static/a5712efaa549b7c9f6fb74b6c3d4f984/d19c0/3.png 500w&quot;
        sizes=&quot;(max-width: 500px) 100vw, 500px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;最后把工程放入Docker里，每天在后台跑着，通过机器人定时推送给我消息，就再也不用担心错过订餐啦~&lt;/p&gt;
&lt;h3&gt;终极问题——吃什么？&lt;/h3&gt;
&lt;p&gt;吾日三省吾身，早中晚餐该吃啥。对于有选择恐惧症的我来说，每天在思考吃什么这个终极哲学问题上浪费了大量的时间，而且在美餐App上并没有图示和评价，所以这大概是一次基于个人经验和口口相传的盲选… 为了解决这个问题，我们抓到的数据不正好派上用场嘛，于是我把所有时间点的所有店铺的数据都抓下来看看。&lt;/p&gt;
&lt;h3&gt;看看数据&lt;/h3&gt;
&lt;p&gt;然而真实情况是数据量并不大，（这也是内部订餐的局限，没办法像饿了么美团外卖一样去爬到大量数据，不过那些外卖平台也没办法得到实际卖出的情况），我尝试过抓取几个月前半年以前的数据，但是发现美餐好像定期的删除之前的数据，所有的数据大概只会保存一个月左右的。&lt;/p&gt;
&lt;p&gt;全部出现过的店铺数据：&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f5942573ebd119b9f37731a135afec2e/93430/DDE43401-A029-4CFE-A246-9ECFD3FA9EB1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 40.30612244897959%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABt0lEQVQoz0VQW4+TQBjt//8TPmyzusb4YGJMuk2Nl1rXRpaClMtSYGBguA3QdmkD0Rxnpja+nTnffOfyTW4XOV5/TPH+e4XpnOHuc4M3yw438wv/asFwO08wvU9xM6N48SFWeHqf4OWcYjoTsxnBu1WDt185Jn7S4tO3DRZfNCzXDkyXQXIk7/FD9+AEJTQzhEc4bIHD7Kiw6VI8WgRbP4duRXjQXBhOislwfoZl6DAeNfAyx6HjOO4b4M+IOPTVm8YR+mOH50OL3+MZ5/6AqshQMIqWl2CUgARP4FWBSdd1MA0TOz9ASlNwzrHfHzAMIxzbQVGIVEGItm1RVzX6vleYJhQxicFYjjAM1N8szTCRw61lYbVcYaNvxHKgFsZxhOs4qOsaURihExyv+T/BTphTwYfCsFA7T64HlknBpoEhhLSfGkhEIN9XQcexUVWVSigF26bF6XQSDTpQIRgKoyLPEex28Bz3ItiIitYvS1T2YW+38DxPpRqGQQmqBCKJPM01ocQ0SRSfC0GZUFZmGRM3FM4bXcf6YQ3XvrhcE8YxUTdVlaUg/19Z/kviGGVZquqerMwY/gIlGURSP5dAogAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;DDE43401 A029 4CFE A246 9ECFD3FA9EB1&quot;
        title=&quot;&quot;
        src=&quot;/static/f5942573ebd119b9f37731a135afec2e/b9e4f/DDE43401-A029-4CFE-A246-9ECFD3FA9EB1.png&quot;
        srcset=&quot;/static/f5942573ebd119b9f37731a135afec2e/cf440/DDE43401-A029-4CFE-A246-9ECFD3FA9EB1.png 148w,
/static/f5942573ebd119b9f37731a135afec2e/d2d38/DDE43401-A029-4CFE-A246-9ECFD3FA9EB1.png 295w,
/static/f5942573ebd119b9f37731a135afec2e/b9e4f/DDE43401-A029-4CFE-A246-9ECFD3FA9EB1.png 590w,
/static/f5942573ebd119b9f37731a135afec2e/93430/DDE43401-A029-4CFE-A246-9ECFD3FA9EB1.png 784w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;高德望京周围店铺地理位置图：&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/bf6b98cb148e668e1b3daff521b49a1f/e4620/749E6AD5-7507-4136-B9C0-4997234B6C03.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 69.6629213483146%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAAB8ElEQVQ4y11TW5KjMAzkGBkgvGz8wAaS7NZWzf0Ppu0W9iS7HyqwbLdarXaTU5Jfr5cYa2SZBonGypazJOQZ27Zp1HVKUdcxRo1rn//Xt3HOiTFGnLPivZMDG09czPuuABng+b8CBCVYCKGAX2A5A/DNIMo8z+JRIOJgRI4XKotPRjEGBeD+ujrN1yIKmDMq4xCZMplZoBSq7TI/TZMsyyLWWhnHQYEZOW8/BZrrgNGN2taTRfj/0SolqIwTous6sDNynm9dVUMCGjsLtayabWRUmfGL3MMHBTRg98TazLxzAb6Hs0kTgkf1hGqrXqiMXpg8gX+rPpAEALv3EsplDtD7FbqPRdMCeBxZE9SlasXv4zwVkIzJygMsFvbsJkavejrntdWUCiB16PteAfOH79jqwUBuJyt8v2GPAGDv7TVIlWUrJAogB/L11cowDD++qloeOEgwavZIWf5AlvMA+9dTHbGCxNuLUVk30zSqqakhWX4KvBU9lS3yNsD4B8GT3G43tREB6/TneZKmbVu533sk3aXXYtTc9VUwF0MUj+HtOemr2LGeoR9JUNvqkHEcOeUgXdsVU7Oa/2fa1V98VpzwzqeIfABgf7/rWS2KPQXkBVKnhjQrmVYNWV1tlS9dKcGOsChu0dmA8xYsq0QE/Asrh5q7eZnEOwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;749E6AD5 7507 4136 B9C0 4997234B6C03&quot;
        title=&quot;&quot;
        src=&quot;/static/bf6b98cb148e668e1b3daff521b49a1f/b9e4f/749E6AD5-7507-4136-B9C0-4997234B6C03.png&quot;
        srcset=&quot;/static/bf6b98cb148e668e1b3daff521b49a1f/cf440/749E6AD5-7507-4136-B9C0-4997234B6C03.png 148w,
/static/bf6b98cb148e668e1b3daff521b49a1f/d2d38/749E6AD5-7507-4136-B9C0-4997234B6C03.png 295w,
/static/bf6b98cb148e668e1b3daff521b49a1f/b9e4f/749E6AD5-7507-4136-B9C0-4997234B6C03.png 590w,
/static/bf6b98cb148e668e1b3daff521b49a1f/f9b6a/749E6AD5-7507-4136-B9C0-4997234B6C03.png 885w,
/static/bf6b98cb148e668e1b3daff521b49a1f/2d849/749E6AD5-7507-4136-B9C0-4997234B6C03.png 1180w,
/static/bf6b98cb148e668e1b3daff521b49a1f/e4620/749E6AD5-7507-4136-B9C0-4997234B6C03.png 1602w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;可以看到店铺大致都是分布在公司的周围，毕竟太远的也不会承接这么大规模的送餐。
有一个比较好玩的是有一个很奇葩的店铺开在黄海上，恩… 这一定是个脏数据…&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c36b55ee2c2cb979a6f561ca18e1a2b0/1589a/AFAC8BC9-008E-4097-8D44-08942DFDE6C8.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 42.476489028213166%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABN0lEQVQoz1WRyW6EMBBE+YcBm3Ug0Qx4Y/NEkSJFyiW55P//p9JtxgQOpUaN/VzdlRhjwNJaQ1uDT7/ibRyhuU89YzSstSTzrDacH4YebdtCSgkhxF6THcZyFl+jxbtWGJ4w/m81yWxAR1qWGe31ijRNAyjCuq7bgBFqCaDIiZvIIUG5p6g+PjzcSs6cgXIKZVHuoAir6zpwduA2EsHI5bou8H7BMs0wnpz/KpgfevRbo51aZFkGIcUJyPXgUAdYBCulMM8jjTbhfr9th2lflasgXwhwiTv7BzZNHc4mmmB+XfHwHtFtfIRH5lH4QhCBirGAvOUQqTi544D6vkcSkwsLd3Z3GcFN0+wjBkgnUZockr7FAXhK+bhDdsU75CRjWFdKtCgKlGVJcInXS4aKLmeHYPI8D/UP/sbha69lIVoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;AFAC8BC9 008E 4097 8D44 08942DFDE6C8&quot;
        title=&quot;&quot;
        src=&quot;/static/c36b55ee2c2cb979a6f561ca18e1a2b0/b9e4f/AFAC8BC9-008E-4097-8D44-08942DFDE6C8.png&quot;
        srcset=&quot;/static/c36b55ee2c2cb979a6f561ca18e1a2b0/cf440/AFAC8BC9-008E-4097-8D44-08942DFDE6C8.png 148w,
/static/c36b55ee2c2cb979a6f561ca18e1a2b0/d2d38/AFAC8BC9-008E-4097-8D44-08942DFDE6C8.png 295w,
/static/c36b55ee2c2cb979a6f561ca18e1a2b0/b9e4f/AFAC8BC9-008E-4097-8D44-08942DFDE6C8.png 590w,
/static/c36b55ee2c2cb979a6f561ca18e1a2b0/f9b6a/AFAC8BC9-008E-4097-8D44-08942DFDE6C8.png 885w,
/static/c36b55ee2c2cb979a6f561ca18e1a2b0/2d849/AFAC8BC9-008E-4097-8D44-08942DFDE6C8.png 1180w,
/static/c36b55ee2c2cb979a6f561ca18e1a2b0/1589a/AFAC8BC9-008E-4097-8D44-08942DFDE6C8.png 1276w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;得到数据之后，我们先来计算::每日总订餐率::，取了60天的数据，去除了一些干扰数据之后，用当天所有实际餐厅订餐数除以餐厅可订总数，得到每日总订餐数（r为出现餐厅数量，order为该餐厅订餐数，dish为该餐厅可订总量）：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/gif1-80661bde2bab76ac6a84b2c7aa7cfa88.gif&quot;&gt;&lt;/p&gt;
&lt;p&gt;这样可以反映出当天的总体订餐情况，可以看到起数据还是有明显起伏的。然后我检查了他们对应的时间，其中10-29日达到了100%订餐，也就是所有店铺的餐全部订光了，检查了一下数据，发现那一天只有一家店铺在提供晚饭，所以被订光也是可以理解的了。&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4f1a9e79e542802a870b6a7799a1a757/b241b/53EC41A0-2753-4FDA-8B7B-C383DA2400AF.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 43.01801801801802%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAAA6klEQVQoz4WRyRLDIAxD+/+/mHvObXZWV49CSpdpmXFwsBCSfRmGwcZxNFbO+X+A+4G9WF0fxZQs1Wg5RH6aLHpf8rPeE+77boRVQG6ApqRTlEIwf7tZWNdXxT2h12vOuafKusfjsLAsJaIe5JycByFMMZYH2tlJeOjivm2WRIyVoBxbQSRRFwhyJ2WeyyIG567X8h8lxs9zwbEeCkWaqiIAufart4WiXgkOTlxrFYTYPZrlPxP8mPa3KQdJxTYKikX2twhv5wyvx5Z/HEDIZ1WTmfQiy5DP6gn/nBOb+kqNfVJ/qbG3esOz7joaxTI0Jw3eAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;53EC41A0 2753 4FDA 8B7B C383DA2400AF&quot;
        title=&quot;&quot;
        src=&quot;/static/4f1a9e79e542802a870b6a7799a1a757/b9e4f/53EC41A0-2753-4FDA-8B7B-C383DA2400AF.png&quot;
        srcset=&quot;/static/4f1a9e79e542802a870b6a7799a1a757/cf440/53EC41A0-2753-4FDA-8B7B-C383DA2400AF.png 148w,
/static/4f1a9e79e542802a870b6a7799a1a757/d2d38/53EC41A0-2753-4FDA-8B7B-C383DA2400AF.png 295w,
/static/4f1a9e79e542802a870b6a7799a1a757/b9e4f/53EC41A0-2753-4FDA-8B7B-C383DA2400AF.png 590w,
/static/4f1a9e79e542802a870b6a7799a1a757/f9b6a/53EC41A0-2753-4FDA-8B7B-C383DA2400AF.png 885w,
/static/4f1a9e79e542802a870b6a7799a1a757/b241b/53EC41A0-2753-4FDA-8B7B-C383DA2400AF.png 888w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;之后计算餐厅的::平均订餐率::（虽然餐厅数据量级比较小，但订餐率也能在某种程度上反映餐厅的订餐实际情况，也不失为一种判断标准），具体来说就是将餐厅出现天数中的订餐量之和除以可订餐总量之和，餐厅订餐率如下：（days为出现天数，order为订餐数，dish为可订总量）：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/gif-ce7cb862e78b15b72e6adf7881c3c8bf.gif&quot;&gt;&lt;/p&gt;
&lt;p&gt;这也就侧面反映了餐厅的受欢迎程度。计算后发现近60天的订餐率最高的是金百万，有87.7%的订餐率，成为最受大家欢迎的店铺，其次是丽华快餐，订餐率达到87.1%，第三名是小芝麻。而最不受欢迎的店铺果然是兰州牛肉拉面，订餐率只有12.3%，这也挺符合大家平时的口评…&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0ae615ea1b60da0a5470261f0334ffa6/059c1/51E15540-5B67-4332-9169-BB79D4F49ED5.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 45.61003420752566%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAACKElEQVQoz1WS20/TYBjG909546XXxCtN9EYTb7whRqORC9SoGSEmJuIRMUGMRDQiARnGGMBlE9lQkNPYZAzWjUJHd2iBHdqu7c+vncT4JU/ztc/bX9++3xOQJIlMJkO9XsdbTrOJa9u4rst/S9w6ruPL8zzZzr/9kQJH9ZZpQlEBOYuZWPTe95+ZQlW7RtNp+lBP/l7AWt8RYNGA8xce8C61Ws03lLkfbMzOi2LLL15fTZJaWKFfG2bfOGTLyLJjKb6nN20WEjnsao2CCtFZx8f7HR7uV4mG0sw8esF032tSwvNsKZEkNhfjcWUQ27WJmN+5mjtPoZFkzYD2zrfcH71B7Pc+YyF/YC2gXjngzYM5ViYivLzcQ1dkl/Bmlnh8jXvxAW7rfRRkhaH1Yc5uHeNSso1eqcyt7o+ceXqS4MMkXc92WJKyfzvUqvT3zDA68Z5g202uj6S4OPCK4IefdM8/54r0hN5Tn7g22sE55TgXVk9wN63ScWeE0z1tdHanaA9uMLm82gJadZOZWILxpUlmx6OEVyQ+i3l+W0wTTceZkuJEBn8xvfyVUH6I0Po7IlsyU+FFQrExJsNpvkTEfMvlFnBP3UOW8+zmZExxIFpJJbuZYTuXRZa22ZVkVK3AjvDVfAm77oq/qnBwoIlaHUXJU6/p/mEFDMOgVCrRaBgYpiGiIoC6jlosUtE0iqUiDaOB67iUK2VMyziKpR8py7JEbLzI4MfmD7CbgXyCu6g2AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;51E15540 5B67 4332 9169 BB79D4F49ED5&quot;
        title=&quot;&quot;
        src=&quot;/static/0ae615ea1b60da0a5470261f0334ffa6/b9e4f/51E15540-5B67-4332-9169-BB79D4F49ED5.png&quot;
        srcset=&quot;/static/0ae615ea1b60da0a5470261f0334ffa6/cf440/51E15540-5B67-4332-9169-BB79D4F49ED5.png 148w,
/static/0ae615ea1b60da0a5470261f0334ffa6/d2d38/51E15540-5B67-4332-9169-BB79D4F49ED5.png 295w,
/static/0ae615ea1b60da0a5470261f0334ffa6/b9e4f/51E15540-5B67-4332-9169-BB79D4F49ED5.png 590w,
/static/0ae615ea1b60da0a5470261f0334ffa6/059c1/51E15540-5B67-4332-9169-BB79D4F49ED5.png 877w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;通过这样就找到公司附近这段时间最优质的外卖，对于我这种选择恐惧症来说，大大缩短了选择的时间，还可以定期的看一看最近的店铺情况，会第一时间发现有新的店铺加入，这样就在订餐的时候，掌握更多更好的信息。比较遗憾的是，美餐并不提供每个餐厅里菜品的订餐数据，不然我们就可以根据这个选择最受欢迎的菜品。&lt;/p&gt;
&lt;h3&gt;写在最后&lt;/h3&gt;
&lt;p&gt;作者因为实际需求的关系所以只做了美餐的数据爬取和分析，希望本文能够抛砖引玉，有兴趣的同学也可以对饿了么美团外卖这些外卖平台做一些数据的挖掘分析，拯救每天思考吃什么的终极哲学问题。&lt;/p&gt;
&lt;p&gt;最后附上&lt;a href=&quot;https://github.com/lqs469/meicanRobot&quot;&gt;代码&lt;/a&gt;，欢迎大家和我交流。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[React 16.0新特性探究]]></title><description><![CDATA[在前段时间沸沸扬扬的的证书风波终以 facebook 的妥协告终之后，Facebook团队马不停蹄的推出了 Recat 的v16.0版本，先不说证书这个事件怎么看，关注 React 的同学们都知道，v16.0绝对是一次大变化，底层源码重构，发布新的 Fiber…]]></description><link>https://lqs469.github.io/Reactv16-0新特性探究/</link><guid isPermaLink="false">https://lqs469.github.io/Reactv16-0新特性探究/</guid><pubDate>Wed, 25 Oct 2017 17:33:16 GMT</pubDate><content:encoded>&lt;p&gt;在前段时间沸沸扬扬的的证书风波终以 facebook 的妥协告终之后，Facebook团队马不停蹄的推出了 Recat 的v16.0版本，先不说证书这个事件怎么看，关注 React 的同学们都知道，v16.0绝对是一次大变化，底层源码重构，发布新的 Fiber 核心算法，加入一系列呼唤许久的新特性，渲染性能优化，文件大小减少等等。那么下面就详细说说。&lt;/p&gt;
&lt;h2&gt;新的核心算法 Fiber&lt;/h2&gt;
&lt;p&gt;早在2015年的时候，fb官方就放出消息和文章，要着手开发新的底层算法框架去支持 React 的更新换代。终于在经历2年多的开发之后，这次新版本最重要的更新，就是这个名为 &lt;a href=&quot;https://www.youtube.com/watch?v=aV1271hd9ew&quot;&gt;Fiber&lt;/a&gt; 的核心底层算法，全新算法将改变 React 组件原有的渲染方式，不仅如此，Fiber 几乎是重写了整个 React 框架，以支持一系列的新特性和性能提高。在新的基础算法的支持下，React 变得更为强大也更有潜力。那么在 React 中是怎么做到的呢？那就要先说一说这个 Fiber。&lt;/p&gt;
&lt;p&gt;fb团队从开始设计 Fiber 时，就把它当做是 React 框架在未来发展的基础结构。Fiber 对框架的渲染和任务调度都有新的设计和实现，以实现在正确时的时间里做正确的事的目标，并对框架的积极响应能力做了很大的提升。一个有很多组件和复杂结构的SPA渲染起来有可能会变得很慢，Fiber 能够优先处理重要元素的渲染（加入了优先级制度），并且显著提高了渲染的速度，通过这种任务调度的能力使应用程序变得更好。&lt;/p&gt;
&lt;p&gt;而 Fiber 最为激动人心的地方就是实现了&lt;strong&gt;异步渲染&lt;/strong&gt;。一种通过对浏览器周期性地执行调度的方法来协调渲染工作的策略，在这一新特性的支持下，React 的渲染能够避免阻塞主线程，应用也可以更快的响应交互（然而在v16中，默认并没有开启异步渲染 …）。&lt;/p&gt;
&lt;p&gt;要理解 Fiber 的工作过程，首先来看一下 React 实现渲染的过程。在 React 中主要有两个部分去执行他们对应的过程：Reconciler 和 Renderer，可以理解为前者任务是渲染之前的 diff 算法等一系列过程，而后者的任务就是 React 对于不用平台（DOM，Canvas，Native…）的渲染执行过程。这两部分的分离意味着不同的渲染引擎能共享 React核心提供的协调算法，而使用它们各自的渲染器，这样可以更好做到算法优化的最大化。&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/bff5ebc77ea50ac8f6079716541835ce/8e7c5/1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 581px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 50.602409638554214%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABUElEQVQoz4WRh07DMBCG8/7vh1BVtVCymtEsO872z905RmlBQtGni2+PIIxDeJI0wv0eC3mWyPtoT9MYWeZIyedo8wTLtoDZ7IpHP+CjbHEl3pIKFb03rGJfiaTVOGUN3tMKSaOxWhd7JNg4hJJZkt044atSuBGnvIWaJmC3syypwPWhcCk7+fe27fAFTrGKwQXaH7bdeVwXxNRd3CiMyyw21jG+IU/gu+vnmQK0VOWAsFaYKMDuAQuhyafQg0yRKwNDyf9MyEoODutO9lgPo+yLYXtD78qMUjCsNaKmFz8ufBz5KeFMC41oJF891wbnWwoz8GGsTFCyLu9wKZQcjDs8dveUkGVJ47ixLRQl+IwLmL7Huh+kpU55bO5Y0QGZXyMfL2R3fBG763l/A63ELG6nlRloGi1ye/mCrMjwH3np5CWKcbqFOIcRijIXXn2/AcTEA+w+AzA9AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;1&quot;
        title=&quot;&quot;
        src=&quot;/static/bff5ebc77ea50ac8f6079716541835ce/8e7c5/1.png&quot;
        srcset=&quot;/static/bff5ebc77ea50ac8f6079716541835ce/cf440/1.png 148w,
/static/bff5ebc77ea50ac8f6079716541835ce/d2d38/1.png 295w,
/static/bff5ebc77ea50ac8f6079716541835ce/8e7c5/1.png 581w&quot;
        sizes=&quot;(max-width: 581px) 100vw, 581px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    
（Reconciler 和 Renderer。图为React Conf 2017上，Lin Clark做的A Cartoon Intro to Fiber分享的ppt视频。）&lt;/p&gt;
&lt;p&gt;每当组件触发更新或者渲染、卸载时，Reconciler 会对组件的状态与新状态进行 diff 算法，比如执行&lt;code class=&quot;language-text&quot;&gt;setState()&lt;/code&gt; 时，Reconciler在一系列相关逻辑执行完毕之后，将会在组建中触发 &lt;code class=&quot;language-text&quot;&gt;render()&lt;/code&gt;去渲染或者更新 React 节点的元素。在老版本中，Reconciler 的整体调度方式叫做 Stack Reconciler ，他会独立维护一个所有组件组成的“实例”树，它包含所有用户和框架所定义的组件，而用户无法访问到这个实例树并且不会对外暴露。而在v16中，这个 stack 换成了这次的主角 Fiber，叫做 Fiber Reconciler。新的 Fiber Reconciler 算法意在解决原来有一些积压已久的问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;可以中断且分离任务为多个“帧”&lt;/li&gt;
&lt;li&gt;可以在执行中制定优先权，重新制定和重新执行任务&lt;/li&gt;
&lt;li&gt;可以在父节点与子节点之间来回切换以支持react的渲染&lt;/li&gt;
&lt;li&gt;可以让 &lt;code class=&quot;language-text&quot;&gt;render()&lt;/code&gt; 返回多元素&lt;/li&gt;
&lt;li&gt;最好支持&lt;code class=&quot;language-text&quot;&gt;error boundaries&lt;/code&gt;（下文会介绍到）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在原来的调度算法实现中，会递归调用组件实例树，每一个更新都是立即执行，由于浏览器JS单线程的原因，整个更新渲染过程会同步进行，这样其实也是比较合理的方案，因为渲染本来就不需要等待IO，只是单纯去执行浏览器计算即可，但是当组件的复杂程度越来越大之后，浏览器的计算不足以应付繁重的任务，于是就开始排队，而且这个排队过程中会占住浏览器主线程，使用户的操作完全被阻塞，没有响应，造成很差的用户体验。这个问题在复杂组件的场景会很常见，那么首先要明白问题的关键，在与用户的交互中，界面是没有必要每一个更新的都立即执行的，这样的做法中无用的开销会很高；另外，不同类型的组件之间有相对的重要程度，有的需要马上与用户交互，有的则不会被重视到，那么就要引入优先级的概念来安排渲染顺序。&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2d6f76460c4b1a47889899f09977f130/34e8a/2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 32.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABIklEQVQoz32RX0+DMBTF+f5PPvgp9EEfTHwwU+ODMYtxOKPJXMzUAeLYRoFBW9py1ltQUaM0v5z7p/eEC57UCsae2ug/Uf/kqqe60fCO7mMkG4mMK6RV3aPN1z/4qDH+O3eGfsQwmCxQa9M1lDPPxBe5+J7TMCGUQSG1qxVStYYplzibJuC2WRG1Rm6baTfU0ppSTMO1MXbFBndRjjgXnz1a2+NKYfCY4HD8Bj/IME02WBQSQrfmXGmnq1JC2trS6t4oxDjMsHP+hOOHd5xOl7icrdy39OiH0JOUAsPXFKOA4cCaX9v46nmN4Qtpit2LGW7mDCeTBPt+hNsos+bCzTbOw7jj0d7KAldsHHRxzkqEWYWAWazGBXcx1dC9BCnN6h5bxdkYiQX9bGoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;2&quot;
        title=&quot;&quot;
        src=&quot;/static/2d6f76460c4b1a47889899f09977f130/b9e4f/2.png&quot;
        srcset=&quot;/static/2d6f76460c4b1a47889899f09977f130/cf440/2.png 148w,
/static/2d6f76460c4b1a47889899f09977f130/d2d38/2.png 295w,
/static/2d6f76460c4b1a47889899f09977f130/b9e4f/2.png 590w,
/static/2d6f76460c4b1a47889899f09977f130/34e8a/2.png 600w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    
（图为“一调到底”的调用栈执行方式，主线程一直被占用，来自Lin Clark做的A Cartoon Intro to Fiber分享的ppt视频）&lt;/p&gt;
&lt;p&gt;首先，我们都知道 React 组件实质是一个函数，只要是一样的输入，就会得到同样的输出组件。而浏览器跟踪程序执行的方式是调用栈，不断的入栈与出栈来实现组件的渲染过程。但是问题就是，如果我们只依赖调用栈去执行程序，我们就只能老老实实等待它变空，无法提升什么效率了。那么我们要做的工作就是去自定义调用栈，或者操作调用栈。而这就是 Fiber 的设计目的，实现 React 组件的堆栈操作，按照你想要的方式和时机去执行，一个虚拟的堆栈结构。&lt;/p&gt;
&lt;p&gt;从 Fiber 的设计思想来说，Fiber 是一个基于组件的执行单元，多个 Fiber 可能对应于同一个组件，你可以对它暂停，继续，修改优先级等操作。在对 Fiber 的调度过程中，为了实现及时的 “打断” 和 “继续”，我们把调度过程分为两个阶段，第一阶段叫做 Render /Reconcilication  Phase 过程，用于建立Fiber树，任务树，并且得到需要改变的节点表，但是此时并不会开始执行改变，第二阶段叫做 Commit  Phase 过程，用于执行DOM上的上述改变。在第一阶段中，执行过程是可以被随时打断，所以我们可以要求主线程在正确的时机放下手中的任务去执行更优先的任务，但是第二阶段的渲染过程不可以被打断，一旦启动就会执行到结束。&lt;/p&gt;
&lt;p&gt;新的结构中，更新执行的过程被被切分成了很多“帧”，每一帧的时间很短，在每一帧执行一小段任务，在每一小段任务执行完毕之后 Fiber 就会检查调度任务的模块，看是否有别的优先级更高的任务需要执行，这样唯一的主线程就不会被长时间占用，其他任务就有机会被执行。维护每一帧的执行与切换，就是 React Fiber 算法。&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2944689de58540873e661adbc35689d2/34e8a/3.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 44.166666666666664%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABNUlEQVQoz52SW0/CQBCF+f+/RVAE5CImJhrjm8jdGPVFoAUUb0Avuz3OmW6hMT4Y25zO2d3pt9OdFkxiYBMLwCL5p+BEVsE687YNsY1j1cZF9VE61hj9mHP6DCN8BKHCC4RB7MB7R3M0R7XnoSI6Gfio9VN/fr9ES9aaQx8NmT/uzTSvrjk+rh5f8bxaK2cHXG0CBRzcTHB0O1WVOlOda4/naAisIiCq2EnX6MvdGa6fXrQ6k+QqXHxtdcdiZyKV+g46U09oNsecQ4HV3QaMrFxwcjsg6TwbvlhyQILL3akTwfL5fQEMPFRdZC59TbRrCh+xq5Kg03Eq+pbEtqgx9HD5sJSzXODsbo4L8dyAORwz8optrsuM2l2z7zAVZGOz72qQywmNwTqKYPMVZvrrf2d/8RnjG2qMoNpTvGbSAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;3&quot;
        title=&quot;&quot;
        src=&quot;/static/2944689de58540873e661adbc35689d2/b9e4f/3.png&quot;
        srcset=&quot;/static/2944689de58540873e661adbc35689d2/cf440/3.png 148w,
/static/2944689de58540873e661adbc35689d2/d2d38/3.png 295w,
/static/2944689de58540873e661adbc35689d2/b9e4f/3.png 590w,
/static/2944689de58540873e661adbc35689d2/34e8a/3.png 600w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    
（任务分成多帧之后，中断任使得主线程可以得到处理另外的任务的机会，图来自Lin Clark做的A Cartoon Intro to Fiber分享的ppt视频）&lt;/p&gt;
&lt;p&gt;在每一帧的执行过程中，React 会去询问主线程是否有余下时间继续接下来的任务，如果有时间那么React就会开始执行任务，但是这样也就会出现一个问题，就是时间不够用的情况，任务没有完成，时间就到了，而此时有优先级更高的任务进来，把之前的任务打断，这时候优先级更高的任务会被主线程优先执行，而低优先级任务则会作废，在下一次有机会时再次被执行，这个就是第一阶段 Render /reconcilication  Phase 过程中被打断的情况。而整个一帧一帧不断切换、继续的执行过程，就叫做 work loop，这让 React 可以在它与主线程的来回切换之间做一些计算来提升交互。&lt;/p&gt;
&lt;p&gt;关于 Fiber 具体实现过程，我会专门写一篇关于 React Fiber 算法的源码分析，敬请期待…（大概可能也许吧）&lt;/p&gt;
&lt;h2&gt;灵活的 render 返回&lt;/h2&gt;
&lt;p&gt;在以往版本的 &lt;code class=&quot;language-text&quot;&gt;render()&lt;/code&gt; 函数返回中，只能以完整的单个DOM返回，例如&lt;code class=&quot;language-text&quot;&gt;&amp;lt;div&amp;gt;...&amp;lt;/div&amp;gt;&lt;/code&gt;如果只是想返回个简单的字符或者数组就得套上一层，这样套下来的结果就是整体结构跟俄罗斯套娃似的，一推无用的DOM结构，只是为了返回语法而存在，十分累赘且无效，更不用说性能消耗和可能潜在造成的css问题。
那么在新版本中，render不仅可以返回数组，还可以返回字符串或数字等。例如：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;render() {
  // No need to wrap list items in an extra element!
  return [
    // Don&amp;#39;t forget the keys :)
    &amp;lt;li key=&amp;quot;A&amp;quot;&amp;gt;First item&amp;lt;/li&amp;gt;,
    &amp;lt;li key=&amp;quot;B&amp;quot;&amp;gt;Second item&amp;lt;/li&amp;gt;,
    &amp;lt;li key=&amp;quot;C&amp;quot;&amp;gt;Third item&amp;lt;/li&amp;gt;
  ];
}

render() {
  return &amp;#39;Look ma, no spans!&amp;#39;;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;具体来说，在render函数执行时，可以有以下返回：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;常规React节点：正常渲染JSX，原生DOM组件或者自定义高阶组件&lt;/li&gt;
&lt;li&gt;字符串或者数字：将会被当作文本节点加入DOM中&lt;/li&gt;
&lt;li&gt;Portal组件：这是一个react新加入的特性，会在下文详细介绍&lt;/li&gt;
&lt;li&gt;null：可以渲染null了&lt;/li&gt;
&lt;li&gt;布尔值：如果为布尔值则返回null，于是render可以这样写：&lt;code class=&quot;language-text&quot;&gt;return flag &amp;amp;&amp;amp; &amp;lt;div /&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;数组：多个DOM以数组形式返回，如上例代码段。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在曾经的版本中如果没有返回一个符合规范的JSX，就会报错：“&lt;em&gt;A valid React element (or null) must be returned. You may have returned undefined, an array or some other invalid object&lt;/em&gt;”（或者别的啥）。在原有的算法结构里并不支持多元素的返回结果，所以在老版本的&lt;code class=&quot;language-text&quot;&gt;react-dom.js&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;ReactCompositeComponent.mountComponent&lt;/code&gt;函数中对不合规定的返回结果做了报错处理。&lt;/p&gt;
&lt;p&gt;在经历了多个版本的“声讨”，终于不用在一层套一层的DOM了…  其实在几年前关于多子元素返回的&lt;a href=&quot;https://github.com/facebook/react/issues/2127&quot;&gt;争论&lt;/a&gt;就有很多，这样做也的确能让结构和语法更优美一些，fb的工程师也参与了很多的社区讨论，但是因为结构复杂的原因，在没有改变原有结构的情况下一直没有合适的解决方案。在“多方”的“讨论”之下，fb也终于决定开始着手支持这一特性&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d4502ecaed8f9857d85cf19df4d6ca68/6d51e/4.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 92.87128712871288%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAAC10lEQVQ4y3VUy27TUBDtl/MJbGEBEmILrEACdqygVKJBysN51XacOI3fseP36zAzsZOGtlcZzfWN7/GcmTNz1TYN2rZFVRTIswy+H8BxXPGu65G58DyPzhw4tLfJ27Yj5/x/HMeo6wZNh3MFWrzhVdOhqmpYLu9wd6dCmUxlv9mYYtvtPdbGWrxB3jS32O0sAqzRrysG6wGjwwEmXczzHGmaimVphqqq5BL7ft/fYV833TP9LiL0gwCL2RzxIcZ+HwqdNEk78AwJ7dmyLEfbnAPp1yPKDb0U04UoigSQjfd5XqAoSjGOsCxLZMSCl5v7GLijE8YJsD/g5CvKMXeqqmO1MqCTrdcmdE2HrhuST86lT0x2t9cYfXjzPODOsjAajTFRFKxUE9bOwf39jj7kSSUf8BO3/TnD/P2Pc1H+B/Q8H4vFkqqsSWRcbY6KPVeWJRWGEUpKA6/V52sMXrx7HpApD4djTKdzKNMZxuMJ5vMlNKLLZ7PZQuSi0gfCJEO0GEP/9okK/AxlFvR6vRF9GZ3mLMsWEUfRQYoid7qIRqWBl/ZHNG3zNKBl25hMFKE9HI6gUmSGsSHaKykM51PXVlJ9Xtr8Fl++vj4X5STQLuEcCVPjnDHVKdFmihw5R8jGOWRtSgBbFTeD74+r3C/f9zvJaCIZpnysskO63ONA3ZTEiURYpCWm5hBvf706U+7BQt9GGHhI0lyi2VMU3BU1ib2hd1j0FQ2Bk1U1GCJRDcS//56r3GtrcPMHfwdDRPR11wvg+XuEUUztGCLNCpQEUFCHXFpFlU5xKKunW49rx2NJRhXpjenxoEiSRCzNaiRZgzRvqfXYeGwd710U5WgQSQTdHPS6eRfQwOC8Hj31dxiLD4II/j6n54R6vDhH+FAyPJZk5lGvcmV57xEYDwVOzcMxVvMo63J5moePpk1NUyU/oCzI8pT2GVIBLOSSgHX+aBXdbS50/A8jLq3g5HAfpgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;4&quot;
        title=&quot;&quot;
        src=&quot;/static/d4502ecaed8f9857d85cf19df4d6ca68/b9e4f/4.png&quot;
        srcset=&quot;/static/d4502ecaed8f9857d85cf19df4d6ca68/cf440/4.png 148w,
/static/d4502ecaed8f9857d85cf19df4d6ca68/d2d38/4.png 295w,
/static/d4502ecaed8f9857d85cf19df4d6ca68/b9e4f/4.png 590w,
/static/d4502ecaed8f9857d85cf19df4d6ca68/f9b6a/4.png 885w,
/static/d4502ecaed8f9857d85cf19df4d6ca68/6d51e/4.png 1010w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    
（图为 github 上对新版本要做的feature的讨论结果)&lt;/p&gt;
&lt;h2&gt;更好的错误处理&lt;/h2&gt;
&lt;p&gt;在以往的 React App 开发中，一遇到 React 的错误发生，将会是一片腥红的报错屏，页面停止工作，只能刷新恢复。现在不再会这样了。新版本使用了更为弹性的错误处理策略，如果在组件中存在渲染错误，那么整个组件树将不会从根节点被渲染出来，这样避免了错误数据的出现。&lt;/p&gt;
&lt;p&gt;除此之外，还引入了一种新的概念“Error Boundaries”，这是一种 React 组件用于捕捉子组件树中的 JavaScript 的错误，并且记录下来，还可以回调错误处理的逻辑，这样就不会任由React被报错停止工作了。Error Boundaries 在渲染时开始捕捉错误，以 &lt;code class=&quot;language-text&quot;&gt;componentDidCatch()&lt;/code&gt; 的方法调用 ，他将会以生命周期的情形加入组件中，完成 catch JS的报错，换句话说就是 React 版的 try catch。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token function&quot;&gt;componentDidCatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 处理错误&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; hasError&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 记录错误&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;logErrorToMyService&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; info&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;目前，只有Class组件可以使用&lt;code class=&quot;language-text&quot;&gt;componentDidCatch()&lt;/code&gt;，另外他只会 catch 它的树结构子节点的错误，这并不会包括它自己的。并且错误会传递到上层，这一点与 JavaScript 的 catch{} 类似。&lt;/p&gt;
&lt;p&gt;新的错误捕捉机制可以解决一系列问题，那些没有被捕捉到的错误将会使得子组件被停止渲染，这个在实际环境中会很有用，我们都不希望一个有错误的页面直接呈现到用户面前，这样可能会暴露很多问题，引起麻烦。那么使用 error boundaries ，即使出现错误，错误的组件停止渲染，其他功能依然可以正常交互。这样使得应用的健全性提升了一个档次，当然，建立完善的错误控制体系也是一个成熟应用应该具备的。&lt;/p&gt;
&lt;p&gt;其实在React v15中，fb团队写了一个不太完善的组件可以实现部分 &lt;code class=&quot;language-text&quot;&gt;componentDidCatch()&lt;/code&gt; 的工作，叫做&lt;code class=&quot;language-text&quot;&gt;unstable_handleError&lt;/code&gt;，（所以叫做 unstable），在新版本中，这个保留的方法将被放弃，转而使用更为高大上的 &lt;code class=&quot;language-text&quot;&gt;componentDidCatch()&lt;/code&gt; 。&lt;/p&gt;
&lt;h2&gt;Portals 组件&lt;/h2&gt;
&lt;p&gt;Portals 的作用就跟他的名字一样形象，（好像也没找到别的译名），这是一种新的 ReactDom 组件方法，&lt;strong&gt;能够渲染位于当前结构位置之外的组件&lt;/strong&gt;，这个需求也许这样听着不太明白，但是举个🌰就很清晰了，比如我们常用的提示框，会突出显示在屏幕中间那种，一般出现的时候会居中并且优先于别的操作页面，有的还会把背景加上阴影啥的，像这样的组件在常规的组件逻辑里，会直接写在当前的页面中，类似于：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; loading &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Loading &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;再由当前的组件决定是否显示，先不说组件复用的问题，在这里 CSS 样式就有可能出现不稳定的情况，因为每个用到这种提示框的外部组件都可能不一样，再一个个调 position 啥的实在是太麻烦了，而且从结构上来看，这种交叉的结构实在是谈不上优美。那么，Portals 组件就出现了，其实他的作用就如其名，在组件中放一个“传送门”，让复用组件渲染的结果出现在你想要的地方。代码例子如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; ReactDOM&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createPortal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    domNode&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;通过&lt;code class=&quot;language-text&quot;&gt;ReactDOM.createPortal()&lt;/code&gt;，你就可以把children插入到你希望出现的DOM节点处。&lt;/p&gt;
&lt;h3&gt;Portals的事件冒泡&lt;/h3&gt;
&lt;p&gt;Portals 组件与正常的 React Elements 并没有什么差异，包括事件的处理，所以无论逻辑上还是写法上 Portals 都是与当前组件是“一体”的。在事件冒泡传递中，Portal 内的事件依然会传递到外层，优美的实现了功能和逻辑。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div onClick&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;handleClick&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Modal&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Modal 是Portals组件&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Child &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Modal&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// 点机 &amp;lt;Child /&gt; 会触发 this.handleClick()&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;尽管 Modal 和当前的组件并不在一个 DOMtree 上，但是依然会触发 &lt;code class=&quot;language-text&quot;&gt;handleClick&lt;/code&gt; 点击事件。&lt;/p&gt;
&lt;h2&gt;更好的服务端渲染&lt;/h2&gt;
&lt;p&gt;在新版本中，团队完全重写了服务端渲染，他变得更快并且支持字节流（Stream）传输。有关 Node 的 Stream 的请看&lt;a href=&quot;https://nodejs.org/api/stream.html#stream_readable_streams&quot;&gt;这里&lt;/a&gt;。Stream 是一种很好的建立于应用和服务之间传输的方式，使用它我们可以不用一次性读或写一个大文件，转而以字节流的形式传输文件，这样对于文件的传输时间和空间效率都有重大的作用。（另外，fb团队将原先大量的&lt;code class=&quot;language-text&quot;&gt;process.env.NODE_ENV&lt;/code&gt;检查减少到了一个，这是因为&lt;code class=&quot;language-text&quot;&gt;process.env&lt;/code&gt;并不是一个常规的 JavaScript 对象，读它很昂贵）。因此，开发环境中的性能将与生产环境相差无几，但错误处理和Portals组件（没有可绑的DOM节点…）暂时还没有加入 SSR。总体来说速度提升了一个台阶，比 v15 的时候快了近3倍（官方数据）。&lt;/p&gt;
&lt;p&gt;我们先来看看在React v15中的SSR是怎么做的。首先在服务端的框架里（Express，Koa）使用原来的方法&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;ReactDOMServer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;renderToString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;element&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 传入React element，返回为HTML String。可以用于请求的快速返回用于加载页面或者有利于PWA的SEO。&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 服务端或者浏览器都可以使用&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;将React组件转为String，然后写入response中。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// using Express&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; renderToString &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;react-dom/server&quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; App &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./App&quot;&lt;/span&gt;
app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; res&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  res&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&amp;lt;!DOCTYPE html&gt;&amp;lt;html&gt;&amp;lt;body&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  res&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&amp;lt;div id=&apos;content&apos;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  res&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;renderToString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;App &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  res&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&amp;lt;/div&gt;&amp;lt;/body&gt;&amp;lt;/html&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  res&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;然后在浏览器端，再使用&lt;code class=&quot;language-text&quot;&gt;render&lt;/code&gt;将HTML String渲染出来就完成了SSR。在v16中的服务端渲染过程中，以往的&lt;code class=&quot;language-text&quot;&gt;render&lt;/code&gt;方法换成了&lt;code class=&quot;language-text&quot;&gt;hydrate&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;ReactDOM&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hydrate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;element&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; container&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;callback&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;hydrate&lt;/code&gt;用于”注入“服务端渲染的HTML内容。因为这个版本是严格向后兼容的，所以原有的&lt;code class=&quot;language-text&quot;&gt;render&lt;/code&gt;方式也可以使用，这个保留会在v17去除。同时，在新版本中，对 HTML 的转换也变得更高效，老版本的 HTML 会对每个元素注入&lt;code class=&quot;language-text&quot;&gt;data-reactid&lt;/code&gt;，对文本注入&lt;code class=&quot;language-text&quot;&gt;react-text&lt;/code&gt;，他们只是单纯无聊的递增id而已。而新版&lt;strong&gt;能够&lt;/strong&gt;去除这些冗余的东西。大大减少了文件的体积。&lt;/p&gt;
&lt;h3&gt;支持 Stream&lt;/h3&gt;
&lt;p&gt;这是一个十分有用的新特性，SSR 支持 Node Stream 传输。Stream 可以减少内容的第一字节（TTFB）时间，同时在内容还没完全生成的时候就开始传输，浏览器会更快更早的开始渲染页面，用户体验也会更好。Stream 的另一个好处就是在阻塞时，能够更好的处理数据包堵塞的时候可能会发生的丢包，当阻塞时，渲染机制会得到信号并且触发 Node Stream 的方法将其转换到到 paused 模式，直到阻塞被清除，渲染机制又会接到信号再转换为flowing 模式继续传输。这意味着服务端可以使用更少的内存，保持更积极的响应 I/O。Stream 的渲染方法如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;ReactDOMNodeStream&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;renderToNodeStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;element&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 返回 Readable stream 格式的 HTML String&lt;/span&gt;
ReactDOMNodeStream&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;renderToStaticNodeStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;element&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 与 ReactDOMNodeStream.renderToNodeStream 类似，但是不会注入多余的DOM标签，比如`data-reactid`&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这两种方法都只能在服务端使用，默认情况下会返回utf-8格式的字节流。&lt;/p&gt;
&lt;p&gt;当使用 &lt;code class=&quot;language-text&quot;&gt;renderTo(Static)NodeStream&lt;/code&gt; 去返回一个可读字节流时，Stream 会处于 Paused 模式，渲染也会暂停，只有当可读字节流对象触发 &lt;code class=&quot;language-text&quot;&gt;read&lt;/code&gt; 或者 &lt;code class=&quot;language-text&quot;&gt;pipe&lt;/code&gt; 方法时才会开始”flowing“字节流和渲染，比如：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// using Express&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; stream &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;renderToNodeStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;MyPage&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// paused 模式，并且停止渲染&lt;/span&gt;
  stream&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;pipe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;res&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; end&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// flowing 模式，开始渲染。&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 特别的是，参数`{ end: false }`表示是否在输入结束时停止，应当为false，否则渲染结束而响应未结束时会发生丢包&lt;/span&gt;
  stream&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;end&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    res&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 完成，stream 结束&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;然而新版本的 Stream SSR 有一个问题需要注意，不要使用 JSX 嵌入 JavaScript 的写法，例如：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;res&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;renderToStaticMarkup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;renderToString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;App &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这样在老版本 SSR 中没有什么错误，但是在 Stream 中会报错，因为&lt;code class=&quot;language-text&quot;&gt;renderToString()&lt;/code&gt;的返回是可读流格式，并不能当做元素嵌入到JSX之中。&lt;/p&gt;
&lt;h2&gt;支持自定义的DOM标签&lt;/h2&gt;
&lt;p&gt;以往React会忽略不认识的DOM标签，在很多时候就得写所谓的React标签白名单去支持逻辑或者第三方库，实在是辣鸡，没有什么比一个名如其实的标签更让人亲切了，不过起名字不是程序员最头痛的事吗？使用例子：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div mycustomattribute&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;something&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;另外，如果遇到使用了DOM原有标准的标签的情况，React优先原有的标准标签，也就是说，如果你要是自定义了这类标签，那会无效的。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;// 没问题
&amp;lt;div tabIndex=&amp;quot;-1&amp;quot; /&amp;gt;

// Warning: Invalid DOM property `tabindex`. Did you mean `tabIndex`?
&amp;lt;div tabindex=&amp;quot;-1&amp;quot; /&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;除此之外，&lt;code class=&quot;language-text&quot;&gt;data-&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;aria-&lt;/code&gt; 依然可以继续使用，这一点没有做改变。但是，React 也一直明确表示，数据不应该放在标签里来存放，毕竟有 state 或者 store 去管理数据，而在 v16中，会把传递的数据转为 String 再传过去，所以这样也可能会导致潜在的问题。&lt;/p&gt;
&lt;h2&gt;setState() 变聪明了&lt;/h2&gt;
&lt;p&gt;原来执行 &lt;code class=&quot;language-text&quot;&gt;setState()&lt;/code&gt; 无论如何都会重新渲染页面，而现在如果参数为 null，将不再触发渲染，这样就可以直接使用 setState 来决定是否重新渲染页面，这个小小的改变会对开发十分有用。&lt;/p&gt;
&lt;h2&gt;更轻薄&lt;/h2&gt;
&lt;p&gt;一个程序的优秀性在于其重构的次数 ，重写了底层算法之后，大小缩小了这么多：（官方数据）&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;react is 5.3 kb (2.2 kb gzipped), 原来 20.7 kb (6.9 kb gzipped).&lt;/li&gt;
&lt;li&gt;react-dom is 103.7 kb (32.6 kb gzipped), 原来 141 kb (42.9 kb gzipped).&lt;/li&gt;
&lt;li&gt;react + react-dom is 109 kb (34.8 kb gzipped), 原来 161.7 kb (49.8 kb gzipped).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;整体比之前的版本小了32%（压缩后小了30%）。体积的改变也部分归功于打包方式的改变，新版本使用了&lt;code class=&quot;language-text&quot;&gt;Rollup&lt;/code&gt;去打包成更为扁平的 bundles，结果也更让人欣喜。&lt;a href=&quot;https://rollupjs.org/&quot;&gt;Rollup.js&lt;/a&gt;也是一种模块打包工具，类似于webpack，那么为啥要换成 Rollup 来打包呢，我们都知道 webpack2.0 加入了&lt;code class=&quot;language-text&quot;&gt;tree-shaking&lt;/code&gt;功能，其实这个功能的提出最早出现在 Rollup 中，Rollup 自称下一代的 JavaScript 模块化工具，使用 ES6 模块编写，支持很多新特性，可以编译成 UMD 或者 CommonJS 等格式。具体的特性可以参考官网的介绍，总结下来，应用开发的打包推荐使用Webpack，更全面也更强大，而到框架级别推荐使用Rollup，效率会更好。&lt;/p&gt;
&lt;h2&gt;MIT licensed&lt;/h2&gt;
&lt;p&gt;你问我支不支持，我当然是支持啦。
只是心疼那些迁移工程做了一半的同学们 …&lt;/p&gt;</content:encoded></item><item><title><![CDATA[记一个history.push的参数问题]]></title><description><![CDATA[对于使用react的开发者来说，react-router自然不陌生，而从熟悉的人们都知道，在react-router2.0到3.0的版本升级中，API…]]></description><link>https://lqs469.github.io/_记一个history-push的参数问题/</link><guid isPermaLink="false">https://lqs469.github.io/_记一个history-push的参数问题/</guid><pubDate>Sun, 01 Oct 2017 00:21:56 GMT</pubDate><content:encoded>&lt;p&gt;对于使用react的开发者来说，react-router自然不陌生，而从熟悉的人们都知道，在react-router2.0到3.0的版本升级中，API有了很大的改变，可以说几乎变成了另一种用法，这里对版本变化啥的不啰嗦什么，网上的文章也有很多，虽然很杂乱，但也不乏有比较好的出现。追其根本，最好的上手方式还是要熟读官方文档，But，这里就是对官方文档写一点吐槽。。。&lt;/p&gt;
&lt;p&gt;在单页面应用中，对于router的操控是必不可少的一部分，而其中对浏览器history的操作都是由history.js完成的。在&lt;a href=&quot;https://github.com/ReactTraining/history#navigation&quot;&gt;官方文档&lt;/a&gt;中的这里：使用react-router的history.push 或者replace控制URL跳转的时候，正常来说传递state如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;history&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;path&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
history&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;path&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;官方给的🌰也很简单：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Push a new entry onto the history stack.&lt;/span&gt;
history&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/home&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Push a new entry onto the history stack with a query string&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// and some state. Location state does not appear in the URL.&lt;/span&gt;
history&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/home?the=query&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; some&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;state&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// If you prefer, use a single location-like object to specify both&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// the URL and state. This is equivalent to the example above.&lt;/span&gt;
history&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  pathname&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;/home&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  search&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;?the=query&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  state&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; some&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;state&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;说明使用push的参数为字符串加[state]对象的时候使用，或者传一个类location形的对象即可，但是问题来了：
当我使用第一种方法，即 &lt;code class=&quot;language-text&quot;&gt;history.push(&amp;#39;/&amp;#39;, { some: &amp;#39;state&amp;#39; })&lt;/code&gt;  时炸了。&lt;/p&gt;
&lt;p&gt;{% asset_img 1.png error %}&lt;/p&gt;
&lt;p&gt;文字越少，事情越大，一行字说的也很清楚，Hash history中不能push state，被。。忽略了？所以开始实验，换成replace试试看：&lt;/p&gt;
&lt;p&gt;{% asset_img 2.png error %}&lt;/p&gt;
&lt;p&gt;然而并没有没什么卵用，于是开始google寻求帮助，出乎我意料的是，居然没有人提出过或者议论过这个问题，这么直白报错居然没有答案，难道是太简单了不屑于记录？再仔细看看报错，啥叫被忽略？文档明明说的是这么用呀，于是换一种理解，是不是不能传递因为会被忽略？
于是改用传单个对象参数的方式试一试，果然。改为：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;history.push({
  pathname,
  search,
  state: { some: &amp;#39;state&amp;#39; }
})&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;就管用了。。很诡异，难道官方文档也有问题？好吧我开始注意到版本的问题。文档的版本是最新的v4.7.2，我在工程中使用的是react-router-dom的v4.1.1版本下的history，发现版本是v4.5.1。莫非是版本更新后改写了函数？查询最新的react-router-dom v4.2.2中使用的history版本是v4.7.2，即最新的版本。然后查看了官方文档的commit log，发现相关的内容是一年以前就写上的，而且是将原本的单参数改为了双参数，看来是在这一版本加入了传递state的功能。&lt;/p&gt;
&lt;p&gt;{% asset_img 3.png version compare %}&lt;/p&gt;
&lt;p&gt;时间是 2016-9-10&lt;/p&gt;
&lt;p&gt;{% asset_img 4.png add push/replace %}&lt;/p&gt;
&lt;p&gt;好的，再看react-router那边的版本时间，v4.1.1的发布时间是2017-4-13&lt;/p&gt;
&lt;p&gt;{% asset_img 5.png relase time %}&lt;/p&gt;
&lt;p&gt;那么就可以确定不是版本过早而修改功能的原因，那么到底是啥呢，俗话说：源码看不少， 装逼装到老。于是还是去源码找找问题吧。果然，在 history 源码的 createHashHistory 中的push函数是这样子：&lt;/p&gt;
&lt;p&gt;{% asset_img 6.png source code %}&lt;/p&gt;
&lt;p&gt;第二个参数若不为空则报错，并且在之后的执行过程中也只会对第一个参数进行操作，转化为location之后就返回继续做跳转操作了。这么看官方文档是有问题的。&lt;/p&gt;</content:encoded></item></channel></rss>