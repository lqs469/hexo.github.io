{"componentChunkName":"component---src-templates-blog-post-js","path":"/Gitlab API 指北/Gitlab API 指北/","webpackCompilationHash":"9b6d2964269f28d87030","result":{"data":{"site":{"siteMetadata":{"title":"lqs469","author":"lqs469"}},"markdownRemark":{"id":"de115927-f6bc-57f6-abcd-6bf7dc550a56","excerpt":"前段时间为手上的项目做了一个自动化构建平台, 需求大致就是实现从 gitlab 中拿到新的代码, 并且也会对分支做一些增删改查的操作, 基本实现方法当然就是一系列 gitlab 开放的 API 能力. 本文会整理出来以方便大家学习使用. Docs Gitlab…","html":"<p>前段时间为手上的项目做了一个自动化构建平台, 需求大致就是实现从 gitlab 中拿到新的代码, 并且也会对分支做一些增删改查的操作, 基本实现方法当然就是一系列 gitlab 开放的 API 能力. 本文会整理出来以方便大家学习使用.</p>\n<h2>Docs</h2>\n<p>Gitlab 的接入文档写的还是很完善的, 基本上你全都看下来也花不了半天时间. Gitlab文档 <a href=\"https://gitlab.com/help/api/README.md\">https://gitlab.com/help/api/README.md</a></p>\n<h2>TL;TR</h2>\n<p>当然, 你可以选择跳过上面的文档, 这也是写这篇文章的目的. 你只需要了解两件事:</p>\n<ol>\n<li>所有 API 都需要权限, 需要在 <code class=\"language-text\">URL</code> 或<code class=\"language-text\">header</code>中加一个<code class=\"language-text\">private_token</code>字段. 你可以在个人资料里找到这个<code class=\"language-text\">private_token</code>值.</li>\n<li>\n<p>请求URL格式为</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">GET http://example.com/api/v3/projects?private_token<span class=\"token operator\">=</span>QVy1PB7sTxfy4pqfZM1U</code></pre></div>\n<p>或者</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> --header <span class=\"token string\">\"PRIVATE-TOKEN: QVy1PB7sTxfy4pqfZM1U\"</span> <span class=\"token string\">\"http://example.com/api/v3/projects\"</span></code></pre></div>\n<p>阿里的 gitlab API 是 v3 版本. 也就是URL得是: <code class=\"language-text\">/api/v3/__</code></p>\n</li>\n</ol>\n<p>然后就可以想要使用什么API就在上面的文档里查什么就行了. 比如查询用户的所有项目列表:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">GET /projects</code></pre></div>\n<p>这个API支持以下参数:</p>\n<ul>\n<li><code class=\"language-text\">archived</code>(optional) - 选填, 是否归档的项目</li>\n<li><code class=\"language-text\">order_by</code>(optional) - 选填, 排序由 <code class=\"language-text\">id</code>,<code class=\"language-text\">name</code>,<code class=\"language-text\">path</code>,<code class=\"language-text\">created_at</code>,<code class=\"language-text\">updated_at</code>,<code class=\"language-text\">last_activity_atfields</code>. 默认<code class=\"language-text\">created_at</code></li>\n<li><code class=\"language-text\">sort</code>(optional) - 选填, 正序<code class=\"language-text\">asc</code>或者倒序<code class=\"language-text\">desc</code>. 默认倒序</li>\n<li><code class=\"language-text\">search</code>(optional) - 根据搜索字段过滤列表</li>\n</ul>\n<p>返回结果:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> **<span class=\"token null keyword\">null</span>**<span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"default_branch\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"master\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"public\"</span><span class=\"token operator\">:</span> **<span class=\"token boolean\">false</span>**<span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"visibility_level\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"ssh_url_to_repo\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"git@example.com:diaspora/diaspora-client.git\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"http_url_to_repo\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://example.com/diaspora/diaspora-client.git\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"web_url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://example.com/diaspora/diaspora-client\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"tag_list\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"example\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"disapora client\"</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"owner\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Diaspora\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"created_at\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2013-09-30T13: 46: 02Z\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Diaspora Client\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"name_with_namespace\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Diaspora / Diaspora Client\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"path\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"diaspora-client\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"path_with_namespace\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"diaspora/diaspora-client\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"issues_enabled\"</span><span class=\"token operator\">:</span> **<span class=\"token boolean\">true</span>**<span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"open_issues_count\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"merge_requests_enabled\"</span><span class=\"token operator\">:</span> **<span class=\"token boolean\">true</span>**<span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"builds_enabled\"</span><span class=\"token operator\">:</span> **<span class=\"token boolean\">true</span>**<span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"wiki_enabled\"</span><span class=\"token operator\">:</span> **<span class=\"token boolean\">true</span>**<span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"snippets_enabled\"</span><span class=\"token operator\">:</span> **<span class=\"token boolean\">false</span>**<span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"created_at\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2013-09-30T13: 46: 02Z\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"last_activity_at\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2013-09-30T13: 46: 02Z\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"creator_id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"namespace\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"created_at\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2013-09-30T13: 46: 02Z\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Diaspora\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"owner_id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"path\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"diaspora\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"updated_at\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2013-09-30T13: 46: 02Z\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"archived\"</span><span class=\"token operator\">:</span> **<span class=\"token boolean\">false</span>**<span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"avatar_url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://example.com/uploads/project/avatar/4/uploads/avatar.png\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> **<span class=\"token null keyword\">null</span>**<span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"default_branch\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"master\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"public\"</span><span class=\"token operator\">:</span> **<span class=\"token boolean\">false</span>**<span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"visibility_level\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"ssh_url_to_repo\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"git@example.com:brightbox/puppet.git\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"http_url_to_repo\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://example.com/brightbox/puppet.git\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"web_url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://example.com/brightbox/puppet\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"tag_list\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"example\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"puppet\"</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"owner\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Brightbox\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"created_at\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2013-09-30T13:46:02Z\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Puppet\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"name_with_namespace\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Brightbox / Puppet\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"path\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"puppet\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"path_with_namespace\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"brightbox/puppet\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"issues_enabled\"</span><span class=\"token operator\">:</span> **<span class=\"token boolean\">true</span>**<span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"open_issues_count\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"merge_requests_enabled\"</span><span class=\"token operator\">:</span> **<span class=\"token boolean\">true</span>**<span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"builds_enabled\"</span><span class=\"token operator\">:</span> **<span class=\"token boolean\">true</span>**<span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"wiki_enabled\"</span><span class=\"token operator\">:</span> **<span class=\"token boolean\">true</span>**<span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"snippets_enabled\"</span><span class=\"token operator\">:</span> **<span class=\"token boolean\">false</span>**<span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"created_at\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2013-09-30T13:46:02Z\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"last_activity_at\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2013-09-30T13:46:02Z\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"creator_id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"namespace\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"created_at\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2013-09-30T13:46:02Z\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Brightbox\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"owner_id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"path\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"brightbox\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"updated_at\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2013-09-30T13:46:02Z\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"archived\"</span><span class=\"token operator\">:</span> **<span class=\"token boolean\">false</span>**<span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"avatar_url\"</span><span class=\"token operator\">:</span> **<span class=\"token null keyword\">null</span>**\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<h2>APIs</h2>\n<p><a href=\"https://gitlab.com/help/api/api_resources.md\">APIs 文档</a></p>\n<h2>第三方封装</h2>\n<h3>node-gitlab</h3>\n<p><a href=\"https://github.com/jdalrymple/node-gitlab\">https://github.com/jdalrymple/node-gitlab</a>\n一个个写这些API请求是件很无聊的事, 所以也推荐直接使用封装好的库.</p>\n<p>使用方法基本一目了然:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Gitlab <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'gitlab'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> api <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Gitlab</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  host<span class=\"token punctuation\">:</span> <span class=\"token string\">'http://gitlab.alibaba-inc.com'</span><span class=\"token punctuation\">,</span>\n  token<span class=\"token punctuation\">:</span> <span class=\"token string\">'XXXXXXX'</span><span class=\"token punctuation\">,</span>\n  version<span class=\"token punctuation\">:</span> <span class=\"token string\">'v3'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napi<span class=\"token punctuation\">.</span>GroupProjects<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>groupId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<blockquote>\n<p>友情提示:\nnode-gitlab 的文档少得可怜, 可能作者觉得官方文档已经足够了, 建议直接看<code class=\"language-text\">/src/services</code>下的源码, 找同名的方法即可.</p>\n</blockquote>","frontmatter":{"title":"Gitlab API 指北","date":"August 20, 2019","categories":"咸鱼之路"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/Gitlab API 指北/Gitlab API 指北/","previous":{"fields":{"slug":"/10x工程师/10x工程师/"},"frontmatter":{"title":"10x工程师"}},"next":null}}}