{"componentChunkName":"component---src-templates-blog-post-js","path":"/Reach-Router“真香”/","result":{"data":{"site":{"siteMetadata":{"title":"lqs469","author":"Qinshuo(Allen) Li"}},"markdownRemark":{"id":"ef141a60-f829-5ffa-9b7a-3255f3489abf","excerpt":"Reach-Router 是前 ReactRouter 成员 Ryan Florence 开发的一套基于 react 的路由控件. 那么已经有比较成熟的 ReactRouter 了, 为什么要”再”做一套 Router 呢, 最初的原因有兴趣(\u0001hào shi)的同学可以去了解一下, 本文会介绍 ReachRouter 并且说明具体比 React-Router 好在哪里. Overview…","html":"<p><img src=\"/679f2858c4fa2dd342df5fc27b44dcc2/3910365c6be928469d0afb130c0ccee3.gif\"></p>\n<blockquote>\n<p><a href=\"https://reach.tech/router\">Reach-Router</a> 是<strong>前</strong> ReactRouter 成员 Ryan Florence 开发的一套基于 react 的路由控件. 那么已经有比较成熟的 ReactRouter 了, 为什么要”再”做一套 Router 呢, 最初的原因有兴趣(\u0001hào shi)的同学可以去了解一下, 本文会介绍 ReachRouter 并且说明具体比 React-Router 好在哪里.</p>\n</blockquote>\n<h2>Overview</h2>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a1ae7f25f0842a04f991cc43c8a25bc5/2a195/7B44554A-6DDF-4F85-B1C8-263D85F6EB43.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 39.35483870967742%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABIUlEQVQY042PTVLDMAyFc/9zsOIO7NjAjjK0qZs6KU3z1yS1a8eOJTtByQwLBhZ8izeyR096irTSOU92PH96ft3H8dtmw7NTXlTnoijrprvdhJTGmGEw1tpxhQpediNg1B2yzcNjVst3fhF9VzdNVVVN01yvV1IhRN/39FPXdbVCRVFcXuJPbV0E1un2Pk/hLkXbdtRKBuq4rbRtW5bLLAIR559EECaFEwJstzvG2HFFSumcA0QHYNeclNZ7P30TpmkxI5kheMT9niUraZpyzik2rXLWeoTRWEQ//2Ixa5gAHGMHztNDktAU0phgyUd6Pl6q7fGklPrbrFygmwetrBnMoEn1QC+ljZE4Sxc0zn+y3KwhaPBc2LMcM2Fzaef/8QU4jsS4znpSEQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"7B44554A 6DDF 4F85 B1C8 263D85F6EB43\"\n        title=\"\"\n        src=\"/static/a1ae7f25f0842a04f991cc43c8a25bc5/fcda8/7B44554A-6DDF-4F85-B1C8-263D85F6EB43.png\"\n        srcset=\"/static/a1ae7f25f0842a04f991cc43c8a25bc5/12f09/7B44554A-6DDF-4F85-B1C8-263D85F6EB43.png 148w,\n/static/a1ae7f25f0842a04f991cc43c8a25bc5/e4a3f/7B44554A-6DDF-4F85-B1C8-263D85F6EB43.png 295w,\n/static/a1ae7f25f0842a04f991cc43c8a25bc5/fcda8/7B44554A-6DDF-4F85-B1C8-263D85F6EB43.png 590w,\n/static/a1ae7f25f0842a04f991cc43c8a25bc5/2a195/7B44554A-6DDF-4F85-B1C8-263D85F6EB43.png 620w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>从 RF 的 Tweet 上简单的发布可以看出来, ReachR (以下都简称 ReachR)主打的是:</p>\n<ul>\n<li>Accessibility, 也就是无障碍, 易用性.</li>\n<li>相对链接的跳转方式.</li>\n<li>嵌套的路由配置.</li>\n<li>合适的路径优先(顺序不会造成影响).</li>\n<li>…</li>\n</ul>\n<p>我们先不管这些 features 到底是什么, 我们先来看一看 ReachR 的设计意图: 根据作者的<a href=\"https://reach.tech/router/credits\">原话</a>, 整个 ReachR 项目是对 ReactR V3 和 V4 两个版本的一些优点的集成以及加入了一些作者一直想要的功能.</p>\n<p>那么跟 React-Router 比较一下呢:</p>\n<ul>\n<li>尺寸. 更少的依赖和更少代码实现够用的功能, ReactR 代码约为 229KB, ReachR 代码为 193KB, 组件依赖也更少.</li>\n<li>没有复杂的路由模式. 没有多余的可选参数或类似的东西，只是静态路径，参数和尾随通配符。</li>\n<li>不支持 React-Native. 讲道理, 你的路由根本用不上支持 RN.</li>\n</ul>\n<p>其实我认为最重要的一点, ReachR 比 ReactR 对开发者来讲: <strong>更好用</strong>.</p>\n<h2>Under the hood</h2>\n<p>那么我们来具体看看 ReachRouter 的 API 设计:</p>\n<h3>渲染方法</h3>\n<p>跟 ReactRouter 不用在于, 在众多路由中只会根据 path 渲染一个最符合条件的子组件.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>Router<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>Home path<span class=\"token operator\">=</span><span class=\"token string\">\"/\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>Dash path<span class=\"token operator\">=</span><span class=\"token string\">\"dashboard\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Router<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>如图例, 组件直接加参数 path 的写法十分简洁, 当前 url 为 /dashboard 时, 只会渲染 Dash, 而当前 url = ‘/’ 时才会渲染 Home. 在 ReactRouter 中匹配则渲染的方式的确能解决一些组件复用的匹配情况, 然而我们遇到更多的情况则是希望专一的渲染单个组件.</p>\n<h3>Link 导航</h3>\n<Link /> 可以在任何位置放置, 没有限制, 不需要包裹进<Router />.\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span>Link to<span class=\"token operator\">=</span><span class=\"token string\">\"/\"</span><span class=\"token operator\">></span>Home<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Link<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>Link to<span class=\"token operator\">=</span><span class=\"token string\">\"dashboard\"</span><span class=\"token operator\">></span>Dashboard<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Link<span class=\"token operator\">></span></code></pre></div>\n<h3>通配符参数</h3>\n<p>通配符参数会直接注入 props, 用不着再 props.location…</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// at url \"/invoice/23\"</span>\n<span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>Router<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>Home path<span class=\"token operator\">=</span><span class=\"token string\">\"/\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>Invoice path<span class=\"token operator\">=</span><span class=\"token string\">\"invoice/:invoiceId\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Router<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Invoice</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">props</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span>Invoice <span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>invoiceId<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>其效果和 <code class=\"language-text\">&lt;Invoice invoiceId={23} /&gt;</code> 一样, 简洁直接.</p>\n<h3>“智能”匹配最合适的路径</h3>\n<p>这是 ReachRouter 一个很棒的特性, 如下面例子</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>Router<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>Home path<span class=\"token operator\">=</span><span class=\"token string\">\"/\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>Invoice0 path<span class=\"token operator\">=</span><span class=\"token string\">\":invoiceId\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>Invoice1 path<span class=\"token operator\">=</span><span class=\"token string\">\"invoices\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>Invoice2 path<span class=\"token operator\">=</span><span class=\"token string\">\"/invoices\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Router<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>当 url 为 ‘/invoices’ 这里谁更合适呢?\n答: 渲染&#x3C; Invoice1 />.\n而当 url 为 ‘/123’ 会渲染 <Invoice0 invoiceId={123} />.</p>\n<p>也就是说只有 url 准确匹配到 path 且为非通配符参数时, 会优先且只会渲染此组件, 而如果没有符合的 path, 才会去渲染包含通配符的组件, 这与顺序无关, 也就是说<Invoice0 />, <Invoice1 />交换顺序不会影响渲染逻辑.</p>\n<p>但是如果<Invoice1 />, <Invoice2 />交换顺序, 结果会怎么样呢?\n答: 渲染第一个匹配的 path. 当 url = ‘/Invoices’ 时, 渲染第一个 path=‘invoices’ 或者 ’/invoices’ 的组件(二者是一样的, 所以匹配遇到的第一个).</p>\n<p>这一特性对比 ReactRouter V4 的实现, 不仅逻辑简单清晰, 还能够省下一个<Switch />(不一定).</p>\n<h3>嵌套路由和嵌套子组件</h3>\n<p>这是 ReachRouter 相比最能体现其优点的地方. 嵌套组件在 Route 中, 它的 path 也会遵循嵌套, 并且其匹配的子组件将作为 props.children 传递.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Dash</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span>Dashboard<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>hr <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>Router<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>Home path<span class=\"token operator\">=</span><span class=\"token string\">\"/\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>Dash path<span class=\"token operator\">=</span><span class=\"token string\">\"dashboard\"</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Invoices path<span class=\"token operator\">=</span><span class=\"token string\">\"invoices\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Team path<span class=\"token operator\">=</span><span class=\"token string\">\"team\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Dash<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Router<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>如果 url 是 ’/dashboard/invoices’, 则将渲染 <code class=\"language-text\">&lt;Dash&gt;&lt;Invoices/&gt;&lt;/Dash&gt;</code>. 如果它只是“/dashboard”, 子组件将不会被渲染, 只有 <code class=\"language-text\">&lt;Dash /&gt;</code> 出现.</p>\n<p>并且基于这个特性我们终于可以在子路由内用 “/” 了</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span>Dash path<span class=\"token operator\">=</span><span class=\"token string\">\"dashboard\"</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>DashboardGraphs path<span class=\"token operator\">=</span><span class=\"token string\">\"/\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>InvoiceList path<span class=\"token operator\">=</span><span class=\"token string\">\"invoices\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Dash<span class=\"token operator\">></span></code></pre></div>\n<p>组件逻辑关系一目了然, 是一个特别好用且经常用到的场景.</p>\n<h3>相对链接</h3>\n<p>子组件内的导航可以直接使用子组件的 path 来作为 to 的参数. 也就是相对链接(Relative Links), 当父组件的 path 改变时或者组件被移动到别处时, 这个特性显得很有用.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>Router<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>Home path<span class=\"token operator\">=</span><span class=\"token string\">\"/\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>Dash path<span class=\"token operator\">=</span><span class=\"token string\">\"dashboard\"</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Invoices path<span class=\"token operator\">=</span><span class=\"token string\">\"invoices\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Team path<span class=\"token operator\">=</span><span class=\"token string\">\"team\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Dash<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Router<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Dash</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span>Dashboard<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>nav<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Link to<span class=\"token operator\">=</span><span class=\"token string\">\"invoices\"</span><span class=\"token operator\">></span>Invoices<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Link<span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>Link to<span class=\"token operator\">=</span><span class=\"token string\">\"team\"</span><span class=\"token operator\">></span>Team<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Link<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>nav<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>hr <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p><Dash />内的<Link />不需要 to=‘/dashboard/invoices’ 而是直接 to=‘invoices’ 即可.</p>\n<h3>404 NotFound</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span>Home path<span class=\"token operator\">=</span><span class=\"token string\">\"/\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>NotFound <span class=\"token keyword\">default</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span></code></pre></div>\n<p>真的, 非常简洁.</p>\n<h3>支持多个 Router</h3>\n<p>如果你想要在应用中匹配多处的组件, 可以直接使用多个<Router />. 这一点在导航菜单里非常常见.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token operator\">&lt;</span>Sidebar<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Router primary<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>HomeNav path<span class=\"token operator\">=</span><span class=\"token string\">\"/\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>DashboardNav path<span class=\"token operator\">=</span><span class=\"token string\">\"dashboard\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Router<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Sidebar<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>MainScreen<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Router<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>Home path<span class=\"token operator\">=</span><span class=\"token string\">\"/\"</span><span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>About path<span class=\"token operator\">=</span><span class=\"token string\">\"about\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Home<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>Dash path<span class=\"token operator\">=</span><span class=\"token string\">\"dashboard\"</span><span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>Invoices path<span class=\"token operator\">=</span><span class=\"token string\">\"invoices\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>Team path<span class=\"token operator\">=</span><span class=\"token string\">\"team\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Dash<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Router<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>MainScreen<span class=\"token operator\">></span></code></pre></div>\n<p>如果你想要在一个<Router />内部嵌套另一个<Router />的话, 需要把外层的 path 加上一个 ‘/*’, 就能做到跟没有&#x3C;Router/ >一样效果的 path 嵌套, 这么实现对于组件复用或者在大型应用多代码模块分别开发有奇效.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>Router<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>Home path<span class=\"token operator\">=</span><span class=\"token string\">\"/\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>Dash path<span class=\"token operator\">=</span><span class=\"token string\">\"dashboard/*\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Router<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Dash</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>p<span class=\"token operator\">></span><span class=\"token constant\">A</span> nested router<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>Router<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>DashboardGraphs path<span class=\"token operator\">=</span><span class=\"token string\">\"/\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>InvoiceList path<span class=\"token operator\">=</span><span class=\"token string\">\"invoices\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Router<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<h3>导航控制</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>navigate<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@reach/router'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Invoices</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>NewInvoiceForm\n      onSubmit<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">async</span> <span class=\"token parameter\">event</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> newInvoice <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">createInvoice</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">)</span>\n        <span class=\"token function\">navigate</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/invoices/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>newInvoice<span class=\"token punctuation\">.</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>就一个 <code class=\"language-text\">navigate</code> 函数, 够用了. 或者这样用: <code class=\"language-text\">props.navigate</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Invoices</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>navigate<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>NewInvoiceForm\n      onSubmit<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">async</span> <span class=\"token parameter\">event</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> newInvoice <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">createInvoice</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// can navigate to relative paths</span>\n        <span class=\"token function\">navigate</span><span class=\"token punctuation\">(</span>newInvoice<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">Navigate</code> 会返回一个 Promise. 这表示可以使用迭代去控制页面的转场效果以及准确的数据流向, 使得和 react 的生命周期的配合变得非常流畅.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Invoices</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    creatingNewInvoice<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>LoadingBar animate<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>creatingNewInvoice<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>NewInvoiceForm\n          onSubmit<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">async</span> <span class=\"token parameter\">event</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n              creatingNewInvoice<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">const</span> newInvoice <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">createInvoice</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">await</span> <span class=\"token function\">navigate</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/invoice/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>newInvoice<span class=\"token punctuation\">.</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n              creatingNewInvoice<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>InvoiceList <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>就这些!</p>\n<h2>In the end</h2>\n<p>在应用中, 一个 Router 只需要保证基本功能且稳定就足够了, ReachRouter 很好的做到了这一点. 以上是他对比于 ReactRouter 的一些优化特性. 解决了一系列备受吐槽的 ReactRouter V4 的奇葩设计. 总的来说, 够用且好用是 ReachRouter 的精髓, API 非常清晰且高效. 轮子年年有, 今年特别多, 现在尚不可预测未来 ReachRouter 会不会取代 ReactRouter, 但是其中的很多特性在前端路由模块的设计中很有意义, 作者也是这方面的带路者, 推荐大家去了解一下.</p>\n<p>除此以上 API 之外, ReachRouter 也有 Server Rendering API, navigate API, LocationProvider, createHistory 等前作实现的功能点保留下来, 并且都有部分优化. 感兴趣的同学可以去学习一发.✌️</p>","frontmatter":{"title":"Reach-Router指北","date":"June 05, 2018","categories":"弱鸡之路"}}},"pageContext":{"slug":"/Reach-Router“真香”/","previous":{"fields":{"slug":"/Reactv16-3的新生命周期/"},"frontmatter":{"title":"Reactv16.3的新生命周期"}},"next":{"fields":{"slug":"/JavaScript-ES2018-ES9-新增标准/"},"frontmatter":{"title":"JavaScript ES2018/ES9 新增标准"}}}}}