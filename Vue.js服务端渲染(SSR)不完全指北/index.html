<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 -apple-system,'BlinkMacSystemFont','Helvetica Neue','PingFang SC','Microsoft YaHei','Source Han Sans SC',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:-apple-system,'BlinkMacSystemFont','Helvetica Neue','PingFang SC','Microsoft YaHei','Source Han Sans SC',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Microsoft YaHei,Source Han Sans SC,serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Helvetica Neue','PingFang SC','Microsoft YaHei','Source Han Sans SC',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Helvetica Neue','PingFang SC','Microsoft YaHei','Source Han Sans SC',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Helvetica Neue','PingFang SC','Microsoft YaHei','Source Han Sans SC',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Helvetica Neue','PingFang SC','Microsoft YaHei','Source Han Sans SC',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Helvetica Neue','PingFang SC','Microsoft YaHei','Source Han Sans SC',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"â€” ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><style data-href="/styles.e56693dc83003c76a0a9.css">body{--pink:#ffa7c4;--bg:#fff;background-color:var(--bg)}h1,h2,h3,h4,li,p,small,span{color:#393e46;color:var(--textNormal)}a{color:#00adb5}body.light{--bg:#fff;--header:var(--pink);--textNormal:#222;--textTitle:#222;--textLink:#d23669;--hr:rgba(0,0,0,0.2);--inlineCode-bg:rgba(255,229,100,0.3);--inlineCode-text:#1a1a1a}body.dark{-webkit-font-smoothing:antialiased;--bg:#282c35;--header:#fff;--textNormal:hsla(0,0%,100%,0.88);--textTitle:#fff;--textLink:var(--pink);--hr:hsla(0,0%,100%,0.2);--inlineCode-bg:#586074;--inlineCode-text:#e6e6e6}code[class*=language-],pre[class*=language-]{color:#fff;background:none;font-family:Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;font-feature-settings:normal;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;margin-bottom:0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{overflow:auto;padding:1em}pre[class*=language-]::selection{background:#27292a}pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:hsla(0,0%,100%,.15)}:not(pre)>code[class*=language-]{border-radius:.3em;background:var(--inlineCode-bg);color:var(--inlineCode-text);padding:.15em .2em .05em;white-space:normal}.token.attr-name{color:#addb67;font-style:italic}.token.comment{color:#637777}.token.string,.token.url{color:#addb67}.token.variable{color:#d6deeb}.token.number{color:#f78c6c}.token.builtin,.token.char,.token.constant,.token.function{color:#82aaff}.token.punctuation{color:#c792ea}.token.doctype,.token.selector{color:#c792ea;font-style:"italic"}.token.class-name{color:#ffcb8b}.token.keyword,.token.operator,.token.tag{color:#ffa7c4}.token.boolean{color:#ff5874}.token.property{color:#80cbc4}.token.namespace{color:#b2ccd6}pre[data-line]{padding:1em 0 1em 3em;position:relative}.gatsby-highlight-code-line{background-color:#022a4b;display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:.75em;border-left:.25em solid #ffa7c4}.gatsby-highlight{margin-bottom:1.75rem;border-radius:10px;background:#011627;-webkit-overflow-scrolling:touch;overflow:auto}.gatsby-highlight pre[class*=language-]{float:left;min-width:100%}</style><meta name="generator" content="Gatsby 2.19.23"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="icon" href="/icons/icon-48x48.png?v=5850669d96691e2173a58b41bf1eb3de"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#65c6c4"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=5850669d96691e2173a58b41bf1eb3de"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=5850669d96691e2173a58b41bf1eb3de"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=5850669d96691e2173a58b41bf1eb3de"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=5850669d96691e2173a58b41bf1eb3de"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=5850669d96691e2173a58b41bf1eb3de"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=5850669d96691e2173a58b41bf1eb3de"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=5850669d96691e2173a58b41bf1eb3de"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=5850669d96691e2173a58b41bf1eb3de"/><title data-react-helmet="true">Vue.jsæœåŠ¡ç«¯æ¸²æŸ“(SSR)ä¸å®Œå…¨æŒ‡åŒ— | lqs469</title><meta data-react-helmet="true" name="description" content="Whatâ€™s this? SSR(Server-Side Rendering) â€” æœåŠ¡ç«¯æ¸²æŸ“ æœåŠ¡ç«¯æ¸²æŸ“æ˜¯ç›¸å¯¹äºå®¢æˆ·ç«¯æ¸²æŸ“è€Œè¨€çš„(Client Side Render), å®ƒçš„æ¸²æŸ“è¡Œä¸ºå‘ç”Ÿåœ¨æœåŠ¡å™¨ç«¯, æ¸²æŸ“å®Œæˆä¹‹åå†å°†å®Œæ•´é¡µé¢ä»¥HTMLå­—ç¬¦ä¸²çš„å½¢å¼äº¤ç»™æµè§ˆå™¨, æœ€åç»è¿‡â€æ³¨æ°´â€è¿‡ç¨‹å°†ä¸€äº›äº‹ä»¶ç»‘å®šå’ŒVueçŠ¶æ€ç­‰æ³¨å…¥åˆ°è¾“å‡ºçš„é™æ€çš„é¡µé¢ä¸­, ç”±åŒæ­¥ä¸‹å‘ç»™æµè§ˆå™¨çš„çš„Vue bundleâ€¦"/><meta data-react-helmet="true" property="og:title" content="Vue.jsæœåŠ¡ç«¯æ¸²æŸ“(SSR)ä¸å®Œå…¨æŒ‡åŒ—"/><meta data-react-helmet="true" property="og:description" content="Whatâ€™s this? SSR(Server-Side Rendering) â€” æœåŠ¡ç«¯æ¸²æŸ“ æœåŠ¡ç«¯æ¸²æŸ“æ˜¯ç›¸å¯¹äºå®¢æˆ·ç«¯æ¸²æŸ“è€Œè¨€çš„(Client Side Render), å®ƒçš„æ¸²æŸ“è¡Œä¸ºå‘ç”Ÿåœ¨æœåŠ¡å™¨ç«¯, æ¸²æŸ“å®Œæˆä¹‹åå†å°†å®Œæ•´é¡µé¢ä»¥HTMLå­—ç¬¦ä¸²çš„å½¢å¼äº¤ç»™æµè§ˆå™¨, æœ€åç»è¿‡â€æ³¨æ°´â€è¿‡ç¨‹å°†ä¸€äº›äº‹ä»¶ç»‘å®šå’ŒVueçŠ¶æ€ç­‰æ³¨å…¥åˆ°è¾“å‡ºçš„é™æ€çš„é¡µé¢ä¸­, ç”±åŒæ­¥ä¸‹å‘ç»™æµè§ˆå™¨çš„çš„Vue bundleâ€¦"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Qinshuo(Allen) Li"/><meta data-react-helmet="true" name="twitter:title" content="Vue.jsæœåŠ¡ç«¯æ¸²æŸ“(SSR)ä¸å®Œå…¨æŒ‡åŒ—"/><meta data-react-helmet="true" name="twitter:description" content="Whatâ€™s this? SSR(Server-Side Rendering) â€” æœåŠ¡ç«¯æ¸²æŸ“ æœåŠ¡ç«¯æ¸²æŸ“æ˜¯ç›¸å¯¹äºå®¢æˆ·ç«¯æ¸²æŸ“è€Œè¨€çš„(Client Side Render), å®ƒçš„æ¸²æŸ“è¡Œä¸ºå‘ç”Ÿåœ¨æœåŠ¡å™¨ç«¯, æ¸²æŸ“å®Œæˆä¹‹åå†å°†å®Œæ•´é¡µé¢ä»¥HTMLå­—ç¬¦ä¸²çš„å½¢å¼äº¤ç»™æµè§ˆå™¨, æœ€åç»è¿‡â€æ³¨æ°´â€è¿‡ç¨‹å°†ä¸€äº›äº‹ä»¶ç»‘å®šå’ŒVueçŠ¶æ€ç­‰æ³¨å…¥åˆ°è¾“å‡ºçš„é™æ€çš„é¡µé¢ä¸­, ç”±åŒæ­¥ä¸‹å‘ç»™æµè§ˆå™¨çš„çš„Vue bundleâ€¦"/><link as="script" rel="preload" href="/webpack-runtime-e014b771165152003fc7.js"/><link as="script" rel="preload" href="/app-7fb453d4fc8f6ed33d87.js"/><link as="script" rel="preload" href="/styles-7defa62713d15c7890c9.js"/><link as="script" rel="preload" href="/commons-abb2cf2657c6a62230f0.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-68ad52aa3118cbdd2315.js"/><link as="fetch" rel="preload" href="/page-data/Vue.jsæœåŠ¡ç«¯æ¸²æŸ“(SSR)ä¸å®Œå…¨æŒ‡åŒ—/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body class="dark"><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="margin-left:auto;margin-right:auto;max-width:43.75rem;padding:2.625rem 1.3125rem"><header><h3 style="margin-top:0"><a style="box-shadow:none;text-decoration:none" href="/">lqs469</a></h3></header><main><h1>Vue.jsæœåŠ¡ç«¯æ¸²æŸ“(SSR)ä¸å®Œå…¨æŒ‡åŒ—</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem;margin-top:-1.75rem">September 30, 2019<!-- --> <!-- -->å¼±é¸¡ä¹‹è·¯</p><div><h3>Whatâ€™s this?</h3>
<p><strong>SSR(Server-Side Rendering) â€” æœåŠ¡ç«¯æ¸²æŸ“</strong></p>
<p>æœåŠ¡ç«¯æ¸²æŸ“æ˜¯ç›¸å¯¹äºå®¢æˆ·ç«¯æ¸²æŸ“è€Œè¨€çš„(Client Side Render), å®ƒçš„æ¸²æŸ“è¡Œä¸ºå‘ç”Ÿåœ¨æœåŠ¡å™¨ç«¯, æ¸²æŸ“å®Œæˆä¹‹åå†å°†å®Œæ•´é¡µé¢ä»¥HTMLå­—ç¬¦ä¸²çš„å½¢å¼äº¤ç»™æµè§ˆå™¨, æœ€åç»è¿‡â€æ³¨æ°´â€<code class="language-text">hydrate</code>è¿‡ç¨‹å°†ä¸€äº›äº‹ä»¶ç»‘å®šå’ŒVueçŠ¶æ€ç­‰æ³¨å…¥åˆ°è¾“å‡ºçš„é™æ€çš„é¡µé¢ä¸­, ç”±åŒæ­¥ä¸‹å‘ç»™æµè§ˆå™¨çš„çš„Vue bundleæ¥ç®¡çŠ¶æ€, ç»§ç»­å¤„ç†æ¥ä¸‹æ¥çš„äº¤äº’é€»è¾‘. è¿™ä¹Ÿæ˜¯ä¸€ç§åŒæ„åº”ç”¨çš„å®ç°(ä»£ç å¯ä»¥è¿è¡Œåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸­).</p>
<h3>When SSR?</h3>
<p>é‚£ä¹ˆ <strong>ä»€ä¹ˆæƒ…å†µä¸‹è¯¥ä½¿ç”¨SSRæ–¹æ¡ˆå‘¢</strong> , å…¶å®ä¸€å¥è¯æ€»ç»“ä¸‹æ¥å°±æ˜¯å±•ç¤ºå‹åº”ç”¨:</p>
<ol>
<li>å¯¹SEOæœ‰éœ€æ±‚. CSRæ— æ³•ç›´æ¥æ»¡è¶³SEO, ä»–éœ€è¦åˆ‡æ¢æˆSSRæˆ–è€…å€ŸåŠ©Prerenderingæ–¹æ¡ˆ. Prerendering: ä¸€ç§åœ¨æœåŠ¡ç«¯ä½¿ç”¨æ— å¤´æµè§ˆå™¨æ¸²æŸ“å‡ºé¡µé¢, å†è¾“å‡ºé™æ€é¡µé¢çš„è§£å†³æ–¹æ¡ˆ, ä¹Ÿèƒ½å®ç°SEOéœ€æ±‚, å¥½å¤„æ˜¯æ¯”è¾ƒç®€å•(é€šè¿‡webpackæ’ä»¶å°±å¯ä»¥å®ç°)å¯ä»¥ä¿æŒå‰ç«¯æ¨¡å—ä¸éœ€è¦SSRæ”¹é€ , ä½†æ˜¯æ€§èƒ½æ¯”SSRå·®ä¸å°‘.</li>
<li>å¯¹é¦–å±æ¸²æŸ“é€Ÿåº¦å’Œæ€§èƒ½æœ‰éœ€æ±‚. å¦‚æœéœ€è¦æ›´æ—©çš„å°†é¡µé¢å±•ç°ç»™ç”¨æˆ·è€Œä¸æ˜¯ç™½å±çš„è¯, æœ€å¥½çš„æ–¹æ¡ˆè¿˜æ˜¯æŠŠæ¸²æŸ“å·¥ä½œäº¤ç»™æœåŠ¡ç«¯, CSR(SPA)åº”ç”¨çš„æ›´é€‚åˆåœºæ™¯åº”è¯¥æ˜¯ä¸­åå°webåº”ç”¨, ä¸€èˆ¬æœ‰è¾ƒå¤šçš„äº¤äº’é€»è¾‘å’Œé¡µé¢æ•°æ®å¤„ç†, åŒæ—¶CSRä¼šä½¿ç”¨æ›´å¤šçš„å†…å­˜, å¯¹æµè§ˆå™¨é€ æˆè¾ƒå¤§çš„å‹åŠ›.</li>
<li>è¿‡å¤šä¾èµ–å®¢æˆ·ç«¯ç¯å¢ƒçš„åœºæ™¯. ç›´æ¥å°†æ¸²æŸ“å·¥ä½œå…¨éƒ¨äº¤ç»™å®¢æˆ·ç«¯å’ŒJavaScriptæ¥å¤„ç†å…¶å®å¯¹äºwebåº”ç”¨æ¥è¯´æ˜¯å¾ˆè„†å¼±çš„, æµè§ˆå™¨çš„æƒ…å†µåƒå·®ä¸‡åˆ«, ç½‘ç»œç¯å¢ƒä¹Ÿæ˜¯æ— æ³•é¢„æµ‹, å³ä½¿åšäº†å†å¤šçš„å…¼å®¹å·¥ä½œ, ä¹Ÿæ— æ³•ä¿è¯ä»»ä½•æƒ…å†µä¸‹éƒ½èƒ½å®Œç¾å±•ç¤º. æœ‰æ—¶å€™å³ä½¿æ¡†æ¶æœ¬èº«ä¹Ÿä¸è¶³ä»¥(ä¸æ„¿æ„)æ”¯æŒæ‰€æœ‰æƒ…å†µ.</li>
<li>å®‰å…¨æ€§è€ƒé‡. å¯¹äºæœ‰æƒé™æ§åˆ¶å’Œå†…å®¹é™åˆ¶çš„åº”ç”¨, ä½¿ç”¨SPAçš„æ—¶å€™å°±è¦è€ƒè™‘å¾ˆå¤šå®‰å…¨æ€§é™åˆ¶çš„é—®é¢˜, å¯¹äºåº”ç”¨ç»“æ„çš„è®¾è®¡å¢åŠ äº†ä¸å°‘å¤æ‚åº¦.</li>
</ol>
<h3>Why SSR ?</h3>
<p>åœ¨æ—©æœŸçš„webå¼€å‘æŠ€æœ¯æ ˆä¸­, å®é™…ä¸Šéƒ½æ˜¯æœåŠ¡ç«¯æ¸²æŸ“, åƒæ˜¯Java, PHP, ROR, ASP.NET. å½“å‰ç«¯MVCå‡ºç°ä¹‹å, æµè§ˆå™¨ç«¯æ¸²æŸ“æ¨¡å‹å¼€å§‹å‡ºç°å¹¶ä¸”æµè¡Œ â€” â€œå¼€å±€ä¸€å—HTMLæ¨¡æ¿, å…ƒç´ å…¨é JSåŠ è½½â€. è¿™ç§æ–¹å¼å¸¦æ¥äº†æ¯”è¾ƒå¿«é€Ÿçš„é¡µé¢åˆ‡æ¢ä½“éªŒå’Œæå¥½çš„å¼€å‘æ•ˆç‡, ä»¥åŠä¸°å¯Œçš„æŠ€æœ¯ç”Ÿæ€.
ä½†æ˜¯CSRä¹Ÿä¸æ˜¯æ²¡æœ‰ç¼ºç‚¹, <strong>ç¼ºç‚¹å¾ˆæ˜æ˜¾</strong>è€Œä¸”ä¸æ”¹å˜å…¶æ ¸å¿ƒæ€è·¯çš„è¯æ²¡åŠæ³•å…‹æœ:</p>
<ol>
<li>SEOä¸å‹å¥½
é¦–å…ˆå› ä¸ºå¼€å±€æœåŠ¡å™¨ä¸¢ç»™æµè§ˆå™¨çš„æ˜¯ä¸€å—ç©ºç™½(æœ‰æ ‡è®°)çš„HTMLæ¨¡æ¿å’Œä¸€å¨æ‰“åŒ…å¥½çš„JSä»£ç , æ‰€ä»¥åšSEOæ—¶å€™æ™®é€šçš„çˆ¬è™«æ²¡åŠæ³•å®æŠ“å–åˆ°çœŸå®çš„webå†…å®¹, è™½ç„¶ç°ä»£çˆ¬è™«å·ç§°å·²ç»èƒ½å¤Ÿå¤„ç†CSRé¡µé¢, ä½†æ˜¯å¤„ç†æˆæœ¬è¿‡é«˜ç­‰é—®é¢˜è¿˜æ˜¯è®©CSRçš„SEOç»“æœä¸å°½å¦‚äººæ„.</li>
<li>é¦–å±åŠ è½½é€Ÿåº¦
åŒæ ·å› ä¸ºæµè§ˆå™¨ä¼šåœ¨æ¥å—åˆ°å®Œæ•´çš„ä¸€å¨JSä»£ç ä¹‹åæ‰èƒ½æ‰§è¡Œä»–, å¯¼è‡´äº†é¦–å±åŠ è½½ç»å†äº†:
è§£æHTML(æ¸²æŸ“HTMLæ¨¡æ¿) -> è·å–JS -> æ‰§è¡ŒJS -> JSæ¸²æŸ“é¡µé¢ -> JSå¤„ç†æ•°æ®ç›¸å…³é€»è¾‘ -> é¡µé¢åŠ è½½å®Œæˆ. è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ä¹‹åæ‰èƒ½å®Œæ•´å‘ˆçŒ®ç»™ç”¨æˆ·, é€Ÿåº¦è‡ªç„¶å°±ä¸‹æ¥äº†, æ›´ä¸ç”¨è¯´ç½‘ç»œå› ç´ å’Œå®¢æˆ·ç«¯ç¯å¢ƒå› ç´ å¯¹ä½“éªŒçš„å½±å“. å³ä½¿æœ‰å‰ç«¯ç¼“å­˜çš„å­˜åœ¨, ä½†æ˜¯é¡µé¢æ¸²æŸ“è¿‡ç¨‹ä»ç„¶ä¸ä¼šè½»æ¾.</li>
<li>é‰´æƒç­‰å®‰å…¨æ€§åŠŸèƒ½å®ç°èµ·æ¥è¾ƒå¤æ‚
å…¶æ¬¡, å› ä¸ºæ˜¯æœåŠ¡ç«¯ä¸€è‚¡è„‘æŠŠæ‰“åŒ…å¥½çš„JSä»£ç äº¤ç»™ç”¨æˆ·, æ‰€ä»¥å¦‚æœåœ¨åº”ç”¨ä¸­æœ‰é‰´æƒçš„é€»è¾‘, å°±ä¼šç‰µæ‰¯åˆ°é‰´æƒé€»è¾‘çš„è®¾è®¡. è¿™æ—¶å€™å°±è¦å‰åç«¯åˆä½œæ¥ä¿è¯å®‰å…¨æ€§, å¤æ‚åº¦å¢åŠ .</li>
</ol>
<p>å…¶å®åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹, ä½ éƒ½æ²¡å¿…è¦ä½¿ç”¨SPAçš„æ–¹æ¡ˆ(å¯ä»¥çœ‹çœ‹<a href="https://journal.plausible.io/you-probably-dont-need-a-single-page-app">è¿™ç¯‡æ–‡ç« </a> ). é‚£ä¹ˆæ—¢ç„¶æŸäº›åœºæ™¯ä¸‹ä¸é€‚åˆä½¿ç”¨CSRæ–¹æ¡ˆ, æˆ‘ä»¬ç›´æ¥é€€å›åˆ°ä»¥å‰çš„webå¼€å‘æ–¹å¼å°±å¥½äº†, å¹²å˜›è¦å»è¸©SSRæ–°çš„å‘å‘¢?  é‚£ä¹ˆ<strong>å¯¹æ¯”ä¼ ç»Ÿçš„webåº”ç”¨, ä½¿ç”¨æ¡†æ¶SSRçš„å¥½å¤„</strong>æœ‰å“ªäº›å‘¢:</p>
<ol>
<li>å¯¹æ¯”ä¼ ç»Ÿæ–¹å¼, é¦–å…ˆæœ€å¤§çš„å¥½å¤„å½“ç„¶å°±æ˜¯æŠ€æœ¯æ ˆç”Ÿæ€, Vue, Reactç­‰å‰ç«¯MVCç»™å¼€å‘å¸¦æ¥å¾ˆå¤§ä¾¿åˆ©, ç›¸åº”çš„ç”Ÿæ€ä¹Ÿè“¬å‹ƒå‘å±•, é…å¥—çš„UIå¥—ä»¶, æ¡†æ¶ç»„ä»¶, è®¾è®¡è¯­è¨€, APIè®¾è®¡å¾ˆå¤šç¨‹åº¦ä¸Šå·²ç»æ”¹å˜äº†å¦‚ä»Šçš„å¼€å‘æ–¹å¼. æ¢å¥è¯è¯´, ä½¿ç”¨jQueryçº¯æ‰‹æ’¸çš„äººåŸæ¥è¶Šå°‘äº†.</li>
<li>å…¶æ¬¡æ˜¯åŒæ„å¸¦æ¥çš„ä¾¿åˆ©. ä¸€å¥—ä»£ç ç”±ä¸¤è¾¹çš„æ‰§è¡Œç¯å¢ƒä½¿ç”¨, å¯ä»¥åŒæ—¶æ”¯æŒSSRå’ŒCSRçš„æ¸²æŸ“, å½“SSRå¤±æ•ˆçš„æ—¶å€™è¿˜å¯ä»¥é™çº§ä¸ºCSR, æˆ–è€…å½“æœåŠ¡å™¨å‹åŠ›è¿‡å¤§çš„æ—¶å€™ä¸»åŠ¨é™çº§ä»¥å¢å¼ºé²æ£’æ€§.</li>
<li>å¯¹æŠ€æœ¯äººå‘˜çš„æŠ€æœ¯æ ˆç»Ÿä¸€. SSRè¿˜æ˜¯ä½¿ç”¨çš„å‰ç«¯å·¥ç¨‹å¸ˆå¸¸è§„ç†Ÿæ‚‰çš„æŠ€æœ¯æ ˆ, æ²¡æœ‰è¿‡å¤§çš„æŠ€æœ¯é—¨æ§›, ä¹Ÿæ²¡æœ‰å¤ªå¤šçš„æŠ€æœ¯å€º, æ›´é€‚åˆé¡¹ç›®çš„å¯æŒç»­ç»´æŠ¤å’Œå‰ç«¯å›¢é˜Ÿçš„æŠ€æœ¯å‘å±•.</li>
</ol>
<h3>æ„å»ºé€»è¾‘</h3>
<p>åœ¨Vue-SSRæ„å»ºè¿‡ç¨‹ä¸­, ä¼šå°†ä»£ç æ‰“åŒ…åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†: æœåŠ¡ç«¯bundle; å®¢æˆ·ç«¯bundle.
Node.jsä¼šå¤„ç†æœåŠ¡ç«¯bundleç”¨äºSSR, å®¢æˆ·ç«¯bundleä¼šåœ¨ç”¨æˆ·è¯·æ±‚æ—¶å’Œå·²ç»ç”±SSRæ¸²æŸ“å‡ºçš„é¡µé¢ä¸€èµ·è¿”å›ç»™ç”¨æˆ·, ç„¶ååœ¨æµè§ˆå™¨æ‰§è¡Œâ€æ³¨æ°´â€(<code class="language-text">hydrate</code>), æ¥ç®¡Vueæ¥ä¸‹æ¥çš„ä¸šåŠ¡é€»è¾‘. è¿™é‡Œå°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜, æœåŠ¡ç«¯æ˜¯å¦‚ä½•å°†storeçŠ¶æ€äº¤ç»™å®¢æˆ·ç«¯çš„å‘¢, å› ä¸ºæ•´ä¸ªæ„å»ºæµç¨‹æ˜¯å½¼æ­¤ç‹¬ç«‹çš„, æ•°æ®é¢„å–(åœ¨è¿›å…¥æ¸²æŸ“é¡µé¢ä¹‹å‰è·å–åˆ°é¡µé¢æ‰€éœ€è¦çš„æ•°æ®)ä¹‹åäº¤ç»™äº†store, è€Œæ³¨æ°´è¿‡ç¨‹æ€ä¹ˆæ¥æ”¶storeæ•°æ®? å…¶å®ä¸­é—´æœ‰ä¸€ä¸ªç‰¹æ®Šçš„çŠ¶æ€ä¿å­˜: <code class="language-text">window.__INITIAL_STATE__</code>, è¿™ä¸ªstateä¼šåœ¨æœåŠ¡ç«¯æ¸²æŸ“æ‰§è¡Œ<code class="language-text">context.state = store.state;</code>çš„æ—¶å€™è‡ªåŠ¨å†™å…¥<code class="language-text">window</code>ä¸­, æ‰€ä»¥åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­å°±å°±å¯ä»¥ç›´æ¥é€šè¿‡<code class="language-text">store.replaceState()</code>æ¥æ”¶æœåŠ¡ç«¯é¢„å–çš„æ•°æ®äº†.</p>
<p>æ„å»ºé€»è¾‘ç¤ºæ„å›¾å¾ˆç»å…¸, å¦‚ä¸‹:</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/15d4e944e835243e004ab08e46fa7cd3/99e81/1.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 45.83761562178828%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABeElEQVQoz21SyU7DMBDNl3MHiU/gwIUDB4R6AdELCIrEoiK6sURFbVM1KU2adMviJY+x3aRBYMnyeGb0np/fWHmeo9hqSSmRpFmZk2XN1Iu+opcxrs9iWeoiZQ4hJASnohCI40Q3VUk0gQbcgarMPFogJdBcCt1niS36bObD8ebg2K11wtAbUU4oQPkLbBVEmHwMdBxeX+D9cA+r2RQW8aPe8fE6YYD3iPjpiF7KdOMyztAaBMgYIwWiJFKQ0TTAqGXrOLy7wvjsGGm8IUBibtghei6DdDtIujWonO0u4IaxBuBcgXHctEPUmwHFAnnlH5XGZUZZI9kwNy77OD/5RBCaxsH3Gv4qM4Db1z20Hdw2jcwlSfa+HB0zr4bYOdUkZIogpwSa92O8vbjIkqx0dZMydIY+Mm6clIKkc0Myd2foP3fpW6jP3kfaP9i5XB0LdSrXiz9sD+dgJDmvjEZ1dMJoCc4SSgqd347N//vP2FTmNd8Cm9rOrh9Q07fI3BTbyAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="SSRæ„å»ºé€»è¾‘.png"
        title=""
        src="/static/15d4e944e835243e004ab08e46fa7cd3/fcda8/1.png"
        srcset="/static/15d4e944e835243e004ab08e46fa7cd3/12f09/1.png 148w,
/static/15d4e944e835243e004ab08e46fa7cd3/e4a3f/1.png 295w,
/static/15d4e944e835243e004ab08e46fa7cd3/fcda8/1.png 590w,
/static/15d4e944e835243e004ab08e46fa7cd3/efc66/1.png 885w,
/static/15d4e944e835243e004ab08e46fa7cd3/c83ae/1.png 1180w,
/static/15d4e944e835243e004ab08e46fa7cd3/99e81/1.png 1946w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>æ‰€ä»¥webpackéœ€è¦ä¸¤ä¸ªå…¥å£(æœåŠ¡ç«¯, å®¢æˆ·ç«¯):</p>
<p><strong>entry-client.js</strong>:
å®¢æˆ·ç«¯ entry åªéœ€åˆ›å»ºåº”ç”¨ç¨‹åº, å¹¶ä¸”å°†å…¶æŒ‚è½½åˆ°DOM, ç„¶åå°†StoreçŠ¶æ€åŒæ­¥ç»™å®¢æˆ·ç«¯bundleï¼š</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../main'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span> app<span class="token punctuation">,</span> store<span class="token punctuation">,</span> router <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// åŒæ­¥store</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>__INITIAL_STATE__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  store<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>__INITIAL_STATE__<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

router<span class="token punctuation">.</span><span class="token function">onReady</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
	router<span class="token punctuation">.</span><span class="token function">beforeResolve</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> matched <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">getMatchedComponents</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> prevMatched <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">getMatchedComponents</span><span class="token punctuation">(</span><span class="token keyword">from</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> diffed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> activated <span class="token operator">=</span> matched<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">c<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> diffed <span class="token operator">||</span> <span class="token punctuation">(</span>diffed <span class="token operator">=</span> prevMatched<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!==</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> asyncDataHooks <span class="token operator">=</span> activated<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=></span> c<span class="token punctuation">.</span>asyncData<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=></span> _<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>asyncDataHooks<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>asyncDataHooks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">hook</span> <span class="token operator">=></span> <span class="token function">hook</span><span class="token punctuation">(</span><span class="token punctuation">{</span> store<span class="token punctuation">,</span> route<span class="token operator">:</span> to <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'client entry asyncData function emit'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	app<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p><strong>entry-server.js</strong>:
æœåŠ¡ç«¯å…¥å£éœ€è¦å¤„ç†è·¯ç”±, å¹¶è§¦å‘æ•°æ®é¢„å–é€»è¾‘</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../main'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token parameter">context</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span> app<span class="token punctuation">,</span> router<span class="token punctuation">,</span> store <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

	  router<span class="token punctuation">.</span><span class="token function">onReady</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> matchedComponents <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">getMatchedComponents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// å¯¹æ‰€æœ‰åŒ¹é…çš„è·¯ç”±ç»„ä»¶è°ƒç”¨ `asyncData()`</span>
      Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
        matchedComponents<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">Component</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>Component<span class="token punctuation">.</span>asyncData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> Component<span class="token punctuation">.</span><span class="token function">asyncData</span><span class="token punctuation">(</span><span class="token punctuation">{</span> store<span class="token punctuation">,</span> route<span class="token operator">:</span> router<span class="token punctuation">.</span>currentRoute <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
          context<span class="token punctuation">.</span>state <span class="token operator">=</span> store<span class="token punctuation">.</span>state<span class="token punctuation">;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<h3>å…·ä½“å®ç°</h3>
<!-- > VueSSR + Begg çš„å®ç°å·²ç»é›†æˆè¿›äº†è„šæ‰‹æ¶å·¥å…·[K2](http://gitlab.alibaba-inc.com/qinshuo.lqs/k2)ä¸­.
>
> æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å°è¯•ä¸€ä¸‹, ä¸€é”®æ­å»º, å³å¼€å³ç”¨ğŸ˜ƒ -->
<p>æ˜ç¡®äº†é€‰å‹åŸå› å’Œæ¡†æ¶ç‰¹æ€§, æˆ‘ä»¬å°±è¦å¼€å§‹ç€æ‰‹æ­å»ºä¸€ä¸ªVue-SSRæ¡†æ¶, æ¨èæ–‡æ¡£: å®˜æ–¹å‡ºå“çš„SSRæŒ‡å— <a href="https://ssr.vuejs.org/">https://ssr.vuejs.org/</a> . é‡Œé¢è®²è§£äº†ä½ æ‰€éœ€è¦çŸ¥é“çš„å…¨éƒ¨åè¯è§£é‡Šå’ŒAPIä»‹ç», åŸºæœ¬ä¸éœ€è¦å†å•ç‹¬æŸ¥èµ„æ–™äº†. åŒæ—¶ä»–ç»™å‡ºäº†ä¸€ä¸ªå®˜æ–¹å‡ºå“çš„ <a href="https://github.com/vuejs/vue-hackernews-2.0/">Demo</a>, demoçš„ä½œè€…å°±æ˜¯å°¤é›¨æºª, ä½ æƒ³è¦å‚è€ƒçš„å†…å®¹é‡Œé¢ä¹ŸåŸºæœ¬éƒ½å®ç°äº†ä¸€é, ä¸è¿‡è¿™ä¸ªDemoæ˜¯åŸºäºExpressçš„, æ”¹é€ æˆEggè¿˜éœ€è¦ä¸€äº›å·¥ä½œ. </p>
<p>Vue-SSR + Egg.js, åœ¨ç»“æ„ä¸Šè·Ÿæ™®é€šçš„VueæœåŠ¡ç«¯æ¸²æŸ“ä¹Ÿæ˜¯ä¸€æ ·çš„. é¦–æ¬¡è¯·æ±‚åˆ°è¾¾æ—¶, ç”±Egg.jså¤„ç†, åœ¨æœåŠ¡ç«¯æ‰§è¡Œæ¸²æŸ“å™¨é€»è¾‘å¹¶è¾“å‡ºé™æ€é¡µé¢, ä¸€å…±è¾“å‡ºçš„è¿˜æœ‰å®¢æˆ·ç«¯bundle, ç„¶åå®¢æˆ·ç«¯bundleæ¥ç®¡åº”ç”¨, ç»§ç»­æ¥ä¸‹æ¥çš„ä»»åŠ¡, å˜æˆä¸€ä¸ªâ€æ™®é€šâ€çš„Vueåº”ç”¨. åŒæ—¶Egg.jsè¿˜ä¼šå¤„ç†æ¥è‡ªé¡µé¢çš„å¼‚æ­¥è¯·æ±‚, å¤„ç†æ­£å¸¸æœåŠ¡ç«¯çš„å·¥ä½œ. ä¸‹é¢æ˜¯åº”ç”¨æ•´ä½“ç»“æ„çš„ç¤ºæ„:</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/c3b984632fc7471948f3d2a54f35bcac/92bb4/2.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 51.64473684210527%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAAB50lEQVQoz3WSS2/UMBDH80X4bBy5IfWEOHDlwIWCOCAQx6oSAnFHKj1QXiqPpQIqUPeRbbq7eT82tuP48WfstAsqYiI7M7Hzn5/HE1hrYQE/pJQQNC7Mr1n7j+9McI4kSVAUBf62QBuDPs+gsgxVXSMaj8HPInRxDK3UIGa0U/S+1BrVeo2O3kIIcBLW2kDRXpcwMDTVoy9I9vc8ZfXhPdJ7d5E/eYwmDKE3tPD+8vkzHN+8gXx3Bx3rMPtxhpOvM5RJA2MNCRIhm4yRfjyE7Hvw0znat2/AKWZE3WuiXH6HbgswA6wePUS6dR3ZndtYZyVOf64QhylYTaR0ksBld7ireAVGGZ2Z8+GI2GwEe+sK+N59cKK0UkBkOepFiqago4uh5g7M6XjCvpfoFUn0KQyPaNHv8N9kkwH721DzEdpOQRFxmbf49TnEyWiObFl4IWea6hq4SSsJTol4uIPF66toyxAt0bbrhsqgNjfofnT7RdNhGSaoihqSCIeL0X8Eje79hYjoBcrDa2D5MepGeHJLhaYNw9tRGCJsc0rUwZ4/jDF/ZN82znGi7haLPEaZRa5PNnW53IMvJ7vYfreFo/jAx2maYDqdoqqqQRD/scsNfRF/WrzC06MHmJTffMw5Q039647t7DeZgfm+BW/IywAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="SSRåº”ç”¨æ•´ä½“ç»“æ„.png"
        title=""
        src="/static/c3b984632fc7471948f3d2a54f35bcac/fcda8/2.png"
        srcset="/static/c3b984632fc7471948f3d2a54f35bcac/12f09/2.png 148w,
/static/c3b984632fc7471948f3d2a54f35bcac/e4a3f/2.png 295w,
/static/c3b984632fc7471948f3d2a54f35bcac/fcda8/2.png 590w,
/static/c3b984632fc7471948f3d2a54f35bcac/efc66/2.png 885w,
/static/c3b984632fc7471948f3d2a54f35bcac/c83ae/2.png 1180w,
/static/c3b984632fc7471948f3d2a54f35bcac/92bb4/2.png 1824w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>å…·ä½“æ¥è¯´, SSRçš„æ ¸å¿ƒæ€è·¯å°±æ˜¯ä½¿ç”¨<code class="language-text">vue-server-renderer</code>åˆ›å»ºä¸€ä¸ªæ¸²æŸ“å™¨(renderer), ç„¶åç»™è¿™ä¸ªæ¸²æŸ“å™¨ä¼ å…¥Vueå®ä¾‹, æ¸²æŸ“å™¨ä¼šå¾—åˆ°HTMLé¡µé¢, æœ€åç”±Egg.jså°†HTMLè¿”å›, å®ç°ä»£ç æœ‰äº›ç¹æ‚è¿™é‡Œå°±ä¸ä¸€ä¸€æ”¾å‡ºæ¥äº†, æ ¸å¿ƒæµç¨‹å¯ä»¥ç®€åŒ–æˆ:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// ç¬¬ 1 æ­¥ï¼šåˆ›å»ºä¸€ä¸ª Vue å®ä¾‹</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span> template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div>Hello World&lt;/div></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ç¬¬ 2 æ­¥ï¼šåˆ›å»ºä¸€ä¸ª renderer</span>
<span class="token keyword">const</span> renderer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-server-renderer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// ç¬¬ 3 æ­¥ï¼šå°† Vue å®ä¾‹æ¸²æŸ“ä¸º HTML</span>
<span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token keyword">await</span> renderer<span class="token punctuation">.</span><span class="token function">renderToString</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>

<span class="token comment">// ç¬¬ 4 æ­¥, è¿”å› HTML</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">renderString</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span></code></pre></div>
<p>å…·ä½“çš„å®ç°ä»£ç å¯ä»¥åœ¨k2æ­å»ºçš„SSRæ¡†æ¶ä¸­çš„<code class="language-text">app/controller/template.js</code>æ–‡ä»¶ä¸­æ‰¾åˆ°.</p>
<h3>å¼€å‘ç¯å¢ƒ</h3>
<p>SSR + Egg çš„ç”Ÿäº§å®ç°å¹¶ä¸éš¾, ä½†æ˜¯æ”¯æŒHMRçš„å¼€å‘ç¯å¢ƒæ­å»ºå°±ç¨éº»çƒ¦äº›, ä¸»è¦æ˜¯<code class="language-text">devMiddleware</code>, <code class="language-text">hotMiddleware</code>å’ŒEgg.jsé…åˆä½¿ç”¨. åŸç†æ˜¯ä½¿ç”¨è¿™äº›å¼€å‘ä¸­é—´ä»¶ç›‘å¬å¹¶æ„å»ºVueæ–‡ä»¶åæ”¾åœ¨å†…å­˜ä¸­, å†å“åº”ç”¨æˆ·çš„è¯·æ±‚.</p>
<p>å…·ä½“æ¥è¯´, åœ¨å¼€å‘ç¯å¢ƒä¸‹, dev rendererä¸­ä¼šæ‰§è¡Œdev-serverå¹¶ç›‘å¬Vueä»£ç , å½“Vueä»£ç å‘ç”Ÿå˜åŒ–æ—¶æ›´æ–°æ¸²æŸ“renderer, å¹¶è¿”å›ç»™Egg, Eggä¼šç­‰å¾…dev-serverçš„è¿”å›åå»æ‰§è¡Œè¾“å‡º. å› ä¸ºeggçš„æ˜¯åŸºäºkoa, æ‰€ä»¥dev Middlewareç®€å•å°è£…ä¸€ä¸‹ç›´æ¥æŒ‚è½½eggä¸­çš„appä¸Šå°±å¯ä»¥, å…·ä½“å®ç°ä»£ç å¯ä»¥æŸ¥çœ‹k2æ­å»ºçš„SSRæ¡†æ¶ä¸­çš„<code class="language-text">build/setup-dev-server.js</code>æ–‡ä»¶.</p>
<p>è¿™é‡Œæœ‰ä¸ªå€¼å¾—æ³¨æ„çš„åœ°æ–¹å°±æ˜¯<code class="language-text">hotMiddleware</code>ä¸­é—´é”®åœ¨æ³¨å†Œä¹‹åå°±ä¼šæ¥ç®¡æ‰€æœ‰è¯·æ±‚, è¿™æ—¶å€™æœ¬å¸Œæœ›èµ°åˆ°Eggçš„è¯·æ±‚å°±ä¼šè¢«æŒ‡å‘Vue,  è¿™æ˜¯ä¸å¸Œæœ›çœ‹åˆ°çš„, æ‰€ä»¥éœ€è¦åœ¨<code class="language-text">hotMiddleware</code>ä¸­è¿‡æ»¤ä¸€ä¸‹:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// setup-dev-server.js</span>
<span class="token operator">...</span>
<span class="token keyword">function</span> <span class="token function">hotFn</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// è¿‡æ»¤ HMR</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'webpack_hmr'</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> stream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PassThrough</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> stream<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token function">hotMiddleware</span><span class="token punctuation">(</span>
    ctx<span class="token punctuation">.</span>req<span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token function-variable function">end</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      write<span class="token operator">:</span> stream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function-variable function">writeHead</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> headers</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>headers<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hotMiddleware headers'</span><span class="token punctuation">,</span> state<span class="token punctuation">,</span> headers<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    next
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>hotFn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span></code></pre></div>
<h3>SSRä¼˜åŒ–</h3>
<p>é€šè¿‡æœåŠ¡ç«¯æ¸²æŸ“, æˆ‘ä»¬å°†åº”ç”¨ä»IOå¯†é›†å‹è½¬ä¸ºäº†CPUå¯†é›†å‹, CPUçš„å‹åŠ›ä¼šåœ¨QPSçˆ†å‘æ—¶å‰§å¢, è¿™æ—¶å€™å°±éœ€è¦é’ˆå¯¹SSRè¿›è¡Œä¸€äº›ä¼˜åŒ–, å¸¸è§çš„ä¼˜åŒ–æ–¹å¼æœ‰:</p>
<h4>ç¼“å­˜</h4>
<p>ä¸€èˆ¬åˆ†ä¸ºé¡µé¢çº§åˆ«ç¼“å­˜å’Œç»„ä»¶çº§åˆ«ç¼“å­˜.</p>
<ul>
<li>
<p>é¡µé¢çº§åˆ«ç¼“å­˜: å¯¹äºç›¸åŒçš„é¡µé¢çš„è¯·æ±‚, å…¶å†…å®¹ä¹Ÿç›¸åŒ(ä¸è€ƒè™‘ä¸ªæ€§åŒ–é¡µé¢æƒ…å†µ), æ‰€ä»¥å°†è·¯ç”±ä¸å¯¹åº”é¡µé¢ç¼“å­˜ä¸‹æ¥å¯ä»¥å¾ˆæœ‰æ•ˆå‘½ä¸­ç¼“å­˜, é™ä½æ€§èƒ½å¼€é”€.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// ä½¿ç”¨ LRU </span>
<span class="token keyword">const</span> microCache <span class="token operator">=</span> <span class="token constant">LRU</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  max<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  maxAge<span class="token operator">:</span> <span class="token number">1000</span> <span class="token comment">// é‡è¦æç¤ºï¼šæ¡ç›®åœ¨ 1 ç§’åè¿‡æœŸã€‚</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token operator">...</span>
<span class="token comment">// å‘½ä¸­ç¼“å­˜</span>
<span class="token keyword">const</span> hit <span class="token operator">=</span> microCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>hit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>hit<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token operator">...</span>

<span class="token comment">// ç¼“å­˜ä¸‹æ¥</span>
microCache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">,</span> html<span class="token punctuation">)</span></code></pre></div>
</li>
<li>
<p>ç»„ä»¶çº§åˆ«ç¼“å­˜: ç»„ä»¶ç¼“å­˜åœ¨ç»„ä»¶æ¸²æŸ“è¿‡ç¨‹è¿›è¡Œå‘½ä¸­åˆ¤æ–­, æ‰€ä»¥ä¼šå½±å“ç»„ä»¶æ¸²æŸ“ç»“æœ, æ‰€ä»¥è¦ç¡®ä¿ç»„ä»¶ä¸ä¾èµ–ä¸Šä¸‹æ–‡çŠ¶æ€ä¸”æ— å‰¯ä½œç”¨, æ¢å¥è¯è¯´ç¼“å­˜çš„æ˜¯ä¸ä¼šæ”¹å˜å†…å®¹çš„å±•ç¤ºå‹ç»„ä»¶. å®ç°æ–¹æ³•æ˜¯ä½¿ç”¨<code class="language-text">vue-server-renderer</code>å†…ç½®çš„ç»„ä»¶çº§åˆ«ç¼“å­˜é…ç½®å‚æ•°, åœ¨åˆ›å»º renderer æ—¶ä¼ å…¥. æ›´å¤šå‚æ•°å¯ä»¥å‚è€ƒ <a href="https://ssr.vuejs.org/zh/api/#cache">å…·ä½“ç¼“å­˜å®ç°æ–¹å¼</a> .</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> renderer <span class="token operator">=</span> <span class="token function">createRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  cache<span class="token operator">:</span> <span class="token constant">LRU</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    max<span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
    maxAge<span class="token operator">:</span> <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
</li>
</ul>
<h4>é™çº§æ–¹æ¡ˆ</h4>
<p>æ ¸å¿ƒæ€è·¯å°±æ˜¯å½“CPUä½¿ç”¨ç‡è¿‡é«˜çš„æ—¶å€™å³ä½¿åˆ‡æ¢åˆ°CSRæ¨¡å¼.
å¯ä»¥ç»“åˆEggæä¾›çš„scheduleèƒ½åŠ›, åœ¨å¯åŠ¨æ—¶æ‰§è¡Œä¸€ä¸ªå®šæ—¶ä»»åŠ¡, ç›‘æ§CPUä½¿ç”¨ç‡, å½“å¤§äºé˜ˆå€¼æ—¶åˆ‡æ¢åˆ°CSRæ¨¡å¼. è€ŒEggä¹Ÿæä¾›äº†å•æ ¸scheduleèƒ½åŠ›, è¿™æ ·å¯ä»¥å°†å®šæ—¶ä»»åŠ¡çš„æ€§èƒ½æŸè€—é™åˆ°å¾ˆå°; æˆ–è€…åœ¨æ¸²æŸ“æ‰§è¡Œæ—¶è®¡æ—¶, å¦‚æœè¶…æ—¶åˆ™è‡ªåŠ¨è¿”å›CSR bundle, é™çº§ä¸ºCSRåº”ç”¨, è¿™æ ·è™½ç„¶èƒ½ä¸´æ—¶è§£å†³CPUé«˜å¼€é”€æ— æ³•åŠæ—¶å“åº”çš„é—®é¢˜, ä½†ç”¨æˆ·ä½“éªŒå¹¶æ²¡æœ‰ä»€ä¹ˆå®è´¨æ€§æ”¹è‰¯.</p>
<h3>è¦æ³¨æ„çš„å‘</h3>
<p>Vue-SSRçš„å‘è¿˜æ˜¯ä¸å°‘çš„, ç‰¹åˆ«æ˜¯å’ŒEgg.jsç»“åˆæ—¶, ç»è¿‡äº†ä¸€æ®µæ¯”è¾ƒè›‹ç–¼çš„è¸©å‘é˜¶æ®µ,  ç°åœ¨ç»ˆäºç¨³å®šä¸‹æ¥æ”¯æ’‘ä¸šåŠ¡. è¿™é‡ŒæŠŠå¼€å‘æœŸé—´<strong>é‡åˆ°çš„é—®é¢˜</strong>æ€»ç»“ä¸€ä¸‹:</p>
<ol>
<li>ç”Ÿå‘½å‘¨æœŸä¸åŒ. è¿™ä¸ªé—®é¢˜æœ€ä¸ºæ˜æ˜¾, åœ¨CSRå’ŒSSRä¸­ç”Ÿå‘½å‘¨æœŸé’©å­æ˜¯ä¸åŒçš„. SSRä¸­åªæœ‰<code class="language-text">beforeCreate</code>å’Œ<code class="language-text">created</code>ä¼šè¢«æ‰§è¡Œ. è€Œåœ¨CSRä¸­æ‰€æœ‰å‘¨æœŸéƒ½ä¼šå†æ‰§è¡Œä¸€é. å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯, åœ¨æœåŠ¡ç«¯ä»£ç ä¸­ä¸è¦å†™æœ‰å…¨å±€å‰¯ä½œç”¨çš„ä»£ç , ä¾‹å¦‚å†™äº† <code class="language-text">setInterval</code>è€Œä¸æ¸…é™¤å®ƒ. å› ä¸ºåœ¨SSRå‘¨æœŸæ²¡æœ‰<code class="language-text">beforeDestory</code>é˜¶æ®µ, æ‰€ä»¥ä»¥å¾€CSRä¸­é”€æ¯é¡µé¢å‰æ¸…é™¤å‰¯ä½œç”¨çš„æ–¹æ³•å°±æ²¡æ³•ç»§ç»­ä½¿ç”¨äº†, è€Œæ­¤æ—¶çš„<code class="language-text">setInterval</code>å°±ä¼šè¢«æ°¸è¿œä¸ä¼šæ¸…é™¤äº†!</li>
<li>å› ä¸ºæˆ‘ä»¬é‡‡ç”¨åŒæ„çš„ç›®çš„æ˜¯å†™ä¸€ä»½å°½é‡é€šç”¨çš„ä»£ç , è®©å®ƒè¿è¡Œåœ¨ä¸¤ç«¯. æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹ä¸åŒç«¯çš„è¿è¡Œç¯å¢ƒç‰¹åˆ«ç†Ÿæ‚‰æ‰è¡Œ, Node.jsç«¯æ˜¯æ²¡æœ‰æµè§ˆå™¨å¯¹è±¡çš„, æ‰€ä»¥<code class="language-text">window</code>, <code class="language-text">document</code>, DOMæ“ä½œéƒ½æ²¡æ³•æ‰§è¡Œ. åŒç†, æµè§ˆå™¨ç«¯æ˜¯æ²¡æœ‰<code class="language-text">process</code>å¯¹è±¡çš„. ä»–ä»¬å„è‡ªçš„APIå®ç°ä¹Ÿæœ‰å·®åˆ«, è¿™ç‚¹éœ€è¦ç‰¹åˆ«ç•™æ„. æ¯”è¾ƒéº»çƒ¦çš„å°±æ˜¯ç¬¬ä¸‰æ–¹åº“çš„å¼•å…¥, æœ‰æ—¶å€™ä½ å¹¶ä¸çŸ¥é“å¼•å…¥çš„åº“èƒ½ä¸èƒ½å®Œå…¨è¿è¡Œåœ¨Nodeç«¯/æµè§ˆå™¨ç«¯. å¦‚æœå®ƒåªèƒ½è¿è¡Œåœ¨çº¯æµè§ˆå™¨ç¯å¢ƒ, é‚£å¯ä»¥åœ¨<code class="language-text">created</code>é˜¶æ®µä¹‹åå¼•å…¥å’Œæ‰§è¡Œæ¥é¿å¼€Node.jsä¸‹æ‰§è¡Œ.</li>
<li>
<p>é¿å…å•ä¾‹. åœ¨CSRä¸­, æ¯æ¬¡æˆ‘ä»¬æ‰“å¼€é¡µé¢éƒ½æ˜¯ä»æœåŠ¡ç«¯ä¸‹è½½ä»£ç (æˆ–ç¼“å­˜), ç„¶ååˆ›å»ºä¸€ä¸ªå…¨å±€çš„æ ¹Vueå®ä¾‹. ä½†åœ¨SSRä¸­æƒ…å†µæœ‰æ‰€å˜åŒ–, å› ä¸ºæœåŠ¡ç«¯ä¼šä¸€ç›´è¿è¡Œ, å¦‚æœä¸€ç›´ç”¨åŒä¸€ä¸ªå…¨å±€çš„Vueå®ä¾‹, å°±ä¼šå¯¼è‡´æ¯æ¬¡å®¢æˆ·ç«¯çš„è¯·æ±‚åˆ°æŒ‡å‘äº†åŒä¸€ä¸ªæ ¹Vueå®ä¾‹, å°±æœ‰å¯èƒ½é€ æˆçŠ¶æ€æ±¡æŸ“. æ‰€ä»¥è¿™é‡Œè¦ä½¿ç”¨å·¥å‚å‡½æ•°åœ¨æ¯æ¬¡è¯·æ±‚åˆ°æ¥æ—¶, æ–°å»ºä¸€ä¸ªVueå®ä¾‹, æ‰§è¡Œé€»è¾‘è¿”å›ç»“æœ. åŒæ ·çš„, <code class="language-text">Store</code>å’Œ<code class="language-text">Router</code>ä¹Ÿè¦è¿™æ ·å¤„ç†:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// main.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./store'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./router'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    router<span class="token punctuation">,</span>
    store<span class="token punctuation">,</span>
    render<span class="token operator">:</span> <span class="token operator">/</span>h<span class="token operator">/</span> <span class="token operator">=></span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span> app<span class="token punctuation">,</span> router<span class="token punctuation">,</span> store <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// router.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">'vue-router'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Home <span class="token keyword">from</span> <span class="token string">'./views/Home'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> About <span class="token keyword">from</span> <span class="token string">'./views/About'</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Router<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    mode<span class="token operator">:</span> <span class="token string">'history'</span><span class="token punctuation">,</span>
    routes<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
        component<span class="token operator">:</span> Home<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        path<span class="token operator">:</span> <span class="token string">'/about'</span><span class="token punctuation">,</span>
        component<span class="token operator">:</span> About<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
</li>
<li>
<p>æ•°æ®é¢„å–é—®é¢˜. åœ¨ä¸šåŠ¡ä¸­ç»å¸¸ä¼šé‡åˆ°éœ€è¦æˆ‘ä»¬è¾“å‡ºçš„é¡µé¢æ˜¯å¸¦æœ‰åŠ¨æ€æ•°æ®çš„, ä¹Ÿå°±æ˜¯åœ¨æ¸²æŸ“é¡µé¢çš„æ—¶å€™å…ˆå¼‚æ­¥å–ä¸€æ¬¡æ•°æ®, ç„¶åå°†è¿”å›çš„æ•°æ®æ”¾å…¥é¡µé¢ä¸­, æœ€åè¾“å‡ºç»™ç”¨æˆ·. å…¶å®å¤„ç†è¿™ä¸ªé€»è¾‘çš„åŸç†å¾ˆç®€å•, å°±æ˜¯åœ¨æœåŠ¡ç«¯æ•´ä¸ªè¯·æ±‚å‘¨æœŸä¸­é¢„å–æ•°æ®å†æ³¨å…¥æœ€åé¡µé¢å°±è¡Œ. ä¸ºäº†å°½æ—©çš„å‘å‡ºè¯·æ±‚, å¯ä»¥åœ¨è·¯ç”±æ¨¡å—ä¸­æ‰§è¡Œæ•°æ®é¢„å–é€»è¾‘, åœ¨å®ä¾‹åŒ–ä¹‹å‰å°±æ‰§è¡Œå¼‚æ­¥è¯·æ±‚, ç„¶åæ”¾å…¥<code class="language-text">Vuex</code>, ç„¶åäº¤ç»™Vueé¡µé¢å»æ¸²æŸ“. è¿™å—çš„ä»£ç æ¯”è¾ƒåˆ†æ•£, å¯ä»¥<a href="https://ssr.vuejs.org/zh/guide/data.html#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%95%B0%E6%8D%AE%E9%A2%84%E5%8F%96-server-data-fetching">çœ‹è¿™é‡Œçš„å®ç°</a></p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ä½¿ç”¨<code class="language-text">v-html</code>æ³¨å…¥åŠ¨æ€è·å–çš„HTMLå†…å®¹çš„æ—¶å€™. å¦‚æœHTMLå†…å®¹æœ‰<code class="language-text">&lt;script&gt;</code>æ‰€åŒ…å«çš„JSä»£ç , ä¼šå‘ç°<code class="language-text">script</code>ä¸­çš„äº‹ä»¶ç»‘å®šå¤±æ•ˆ. å…¶å®åœ¨è¿™é‡Œé¡µé¢è¢«æ¸²æŸ“äº†ä¸¤æ¬¡, ç¬¬ä¸€æ¬¡æ˜¯å‘ç”Ÿåœ¨SSRç›´æ¥äº¤ç»™æµè§ˆå™¨çš„æ—¶å€™: æ­¤æ—¶<code class="language-text">&lt;script&gt;</code>å®Œæ•´è¢«æ¸²æŸ“åœ¨æµè§ˆå™¨é‡Œ, å…¶å†…å®¹æ­£å¸¸æ‰§è¡Œ, äº‹ä»¶ç»‘å®šä¹Ÿæ­£å¸¸çš„ç»‘å®šåœ¨äº†å½“æ—¶çš„DOMå…ƒç´ ä¸Š. è€Œç¬¬äºŒæ¬¡æ¸²æŸ“æ—¶, èµ°çš„æ˜¯CSR: åœ¨è¿™æ—¶ç”±äºæ˜¯ä»¥<code class="language-text">v-html</code>çš„æ–¹å¼æ¥æ¸²æŸ“æ›¿æ¢HTML, ä½†æ˜¯<code class="language-text">v-html</code>å®è´¨ä¸Šæ˜¯<code class="language-text">innerHTML</code>æ“ä½œ, è¿™æ ·	<code class="language-text">&lt;script&gt;</code>è™½ç„¶ä¼šè¢«æ›¿æ¢ä¸Šå», ä½†æ˜¯å…¶ä¸­çš„å†…å®¹ä¸ä¼šæ‰§è¡Œ(<code class="language-text">innerHTML</code>ä¸ºå®‰å…¨æ€§è€ƒè™‘è€Œè®¾è®¡). æ‰€ä»¥ç»è¿‡è¿™æ ·ä¸¤æ¬¡æ¸²æŸ“ä¹‹å, æ­¤æ—¶çš„DOMå…ƒç´ æ˜¯ç¬¬äºŒæ¬¡æ¸²æŸ“æ—¶å¾—åˆ°çš„, è€Œæ­£å¸¸æ‰§è¡Œè¿‡çš„JSçš„äº‹ä»¶ç»‘å®šæ˜¯ç»‘åœ¨åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“å‡ºæ¥çš„DOMå…ƒç´ ä¸Š, è¿™æ ·å°±å‡ºç°äº†è™½ç„¶DOMå­˜åœ¨. ä½†æ˜¯æ— æ³•è§¦å‘è¯¥DOMä¸Šçš„äº‹ä»¶çš„æƒ…å†µ.</p>
<p>è§£å†³æ–¹æ³•:
å°†è·å–åˆ°çš„HTMLå†…å®¹è¿›è¡ŒåŒ¹é…, å‰”å‡º<code class="language-text">&lt;script&gt;</code>å†…å®¹, æ— è®ºç¬¬ä¸€æ¬¡æˆ–ç¬¬äºŒæ¬¡æ¸²æŸ“, åªå°†<HTML>å†…å®¹äº¤ç»™<code class="language-text">v-html</code>é¡µé¢, ç„¶åå•ç‹¬åœ¨ç”Ÿå‘½å‘¨æœŸ<code class="language-text">updated</code>(é¡µé¢å·²å°†HTMLå†…å®¹æ¸²æŸ“å®Œæˆ)ä¸­å°†<code class="language-text">&lt;script&gt;</code>åˆ›å»ºå‡ºæ¥, æ·»åŠ åˆ°é¡µé¢é‡Œè‡ªåŠ¨æ‰§è¡Œ, å®ç°ç»‘å®š.
å¹¶åœ¨ä¸‹ä¸€æ¬¡é¡µé¢é‡æ¸²æŸ“(å¯èƒ½æ˜¯é¡µé¢è·³è½¬æ¥åˆ°)æ—¶åˆ¤æ–­<code class="language-text">&lt;script&gt;</code>æ˜¯å¦å­˜åœ¨, å¦‚æœçœŸåˆ™å…ˆåˆ å»å†æ·»åŠ , è¿™æ ·é¿å…æ·»åŠ å¤šä½™çš„<code class="language-text">&lt;script&gt;</code>å—.</p>
<p><strong>è€Œé¡µé¢ä¸ºä»€ä¹ˆä¼šæ¸²æŸ“ä¸¤æ¬¡å‘¢?</strong></p>
<p>è¿™æ˜¯ç”±äºVue SSRåœ¨åˆå§‹é¡µé¢æ¸²æŸ“å®Œæˆåä¼šæœ‰ä¸€æ¬¡<code class="language-text">hydration</code>è¿‡ç¨‹, åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šç…§å¸¸æ‰§è¡Œæµç¨‹<code class="language-text">mounted</code>ç­‰ç”Ÿå‘½å‘¨æœŸ. æ­¤æ—¶ä¼šæœ‰ä¸€ä¸ªè‡ªåŠ¨åˆ¤å®š, åˆ¤å®šæ˜¯å¦æ­¤æ—¶çš„ç»„ä»¶æ¸²æŸ“å‡ºçš„å†…å®¹ä¸SSRæ¸²æŸ“å¾—åˆ°çš„å†…å®¹ä¸€è‡´, å¦‚æœå‡ºç°ä¸ä¸€è‡´å°±ä¼šå•ç‹¬æ‰§è¡Œä¸€æ¬¡é¢å¤–çš„CSR, ä»¥è¾¾åˆ°é¡µé¢è¢«èƒ½æ­£ç¡®åœ°æ¸²æŸ“. è€Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†<code class="language-text">v-html</code>, è¿™ä¸ªè¿‡ç¨‹åªæœ‰åœ¨CSRæ—¶æ‰ä¼šè¢«æ‰§è¡Œ, æ‰€ä»¥å¯¼è‡´äº†ä¸¤æ¬¡æ¸²æŸ“å‡ºæ¥çš„å†…å®¹ä¸ä¸€è‡´, è§¦å‘äº†Vue SSRçš„â€è¡¥å¿æ¸²æŸ“æœºåˆ¶â€, è¿›è€Œæ‰§è¡Œäº†ç¬¬äºŒæ¬¡æ¸²æŸ“.

  <a
    class="gatsby-resp-image-link"
    href="/static/13c8b72d11b89ed2f3a099661be397a6/d9b5d/3.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 10.620915032679738%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsSAAALEgHS3X78AAAAeklEQVQI1y2Myw6CUAxE+f8/A+RyXwILBWKUxBi9axbtsUQXk85M21PtOSPOoz6i44TGZLlH8xnpg/Wmyfpkd12PWBbzDCMlRF5tS/GeZ91Q1oWK+4bUJ9QdzwZrOqR1aEgGHX4+GvzYx4w+NnS9ofOCXk2XGflP3h++3EiRsVTeG1MAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="image.png"
        title=""
        src="/static/13c8b72d11b89ed2f3a099661be397a6/fcda8/3.png"
        srcset="/static/13c8b72d11b89ed2f3a099661be397a6/12f09/3.png 148w,
/static/13c8b72d11b89ed2f3a099661be397a6/e4a3f/3.png 295w,
/static/13c8b72d11b89ed2f3a099661be397a6/fcda8/3.png 590w,
/static/13c8b72d11b89ed2f3a099661be397a6/efc66/3.png 885w,
/static/13c8b72d11b89ed2f3a099661be397a6/c83ae/3.png 1180w,
/static/13c8b72d11b89ed2f3a099661be397a6/d9b5d/3.png 1224w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
    </span>
  </span>
  
  </a>
    </p>
</li>
<li>
<p>Cookieä¼ é€’. ç”¨æˆ·çš„è¯·æ±‚ä¼šå…ˆåœ¨æœåŠ¡ç«¯è¢«å¤„ç†, æ­¤æ—¶ä¼šå¸¦å®¢æˆ·ç«¯çš„cookie, ä½†å¦‚æœåœ¨æœåŠ¡ç«¯ä¸­Egg.jså‘å‡ºå¼‚æ­¥è¯·æ±‚, è¿™ä¸ªå¼‚æ­¥è¯·æ±‚ä¸­å¹¶ä¸å¸¦å®¢æˆ·ç«¯çš„cookie, æ‰€ä»¥å¦‚æœå¼‚æ­¥è¯·æ±‚éœ€è¦å¸¦æºå¸¦ç”¨æˆ·ä¿¡æ¯çš„cookie, æ­¤æ—¶éœ€è¦å°†ä¸Šä¸‹æ–‡ä¸­çš„cookieåŠ å…¥Eggçš„å¼‚æ­¥è¯·æ±‚headersä¸­. åŒæ—¶è¿”å›ç»™å®¢æˆ·ç«¯æ—¶å¦‚æœæ¶‰åŠåˆ°æœ‰å…³cookieçš„æ“ä½œä¹Ÿè¦åŒæ­¥å¤„ç†ä¸€ä¸‹, ä¾‹å¦‚ç”¨æˆ·æ³¨é”€: </p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">curl</span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  dataType<span class="token operator">:</span> <span class="token string">'json'</span><span class="token punctuation">,</span>
  headers<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä¼ é€’ cookie</span>
    cookie<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>header<span class="token punctuation">.</span>cookie<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å¤„ç†å®¢æˆ·ç«¯ cookie</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'passport_login'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    domain<span class="token operator">:</span> <span class="token string">'.XXX.com'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
</li>
</ol>
<h3>æ€»ç»“</h3>
<p>åœ¨å®ç°ä¸€ä¸ªå±•ç¤ºå‹webåº”ç”¨, æˆ–è€…å¯¹é¦–å±æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„åœºæ™¯(ä¾‹å¦‚å®˜ç½‘, æŠ€æœ¯æ–‡æ¡£). SSRéƒ½æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ•ˆä¸”å€¼å¾—æŠ•å…¥çš„æŠ€æœ¯æ–¹æ¡ˆ, ä¸€æ–¹é¢äº«å—äº†æ¡†æ¶å¸¦æ¥çš„ä¾¿åˆ©å’Œç”Ÿæ€ç¦åˆ©, ä¸€æ–¹é¢ä¹Ÿå…¼é¡¾äº†æ€§èƒ½å’Œå¯æ‰©å±•æ€§, å¯¹å›¢é˜Ÿçš„æ¨ªå‘æ¢ç´¢å’ŒæŠ€æœ¯æ ˆç»Ÿä¸€ä¹Ÿå¾ˆæœ‰å¥½å¤„. å¾—ç›ŠäºVue(æˆ–React)å’ŒEgg.jsç”Ÿæ€çš„ä¼˜åŠ¿, ä¸°å¯Œçš„ç¬¬ä¸‰æ–¹åº“å’Œç¹è£ç”Ÿæ€æ”¯æŒ, è®©å¼€å‘è€…æœ‰æ›´å¤šçš„é€‰æ‹©å’Œä¼˜åŒ–ç©ºé—´. åŒæ—¶å¼€å‘æ•ˆç‡ä¹Ÿæ›´é€‚åˆç°ä»£webåº”ç”¨çš„å¼€å‘èŠ‚å¥, ä¸éœ€è¦å¾ˆé«˜çš„æŠ€æœ¯é—¨æ§›,  å°±å¯ä»¥ä¸Šæ‰‹å¼€å‘å¹¶ä¸”æ”¯æ’‘å¤§éƒ¨åˆ†çš„ä¸šåŠ¡åœºæ™¯. åŒæ—¶Egg.jsæ¡†æ¶çš„æˆç†Ÿä¹Ÿè®©æœåŠ¡ç«¯çš„èƒ½åŠ›æ›´ä¸ºå¼ºå¤§, å¯¹äºå®‰å…¨æ€§å’Œç¨³å®šæ€§çš„è®¾è®¡è®©æˆ‘ä»¬åœ¨å¤„ç†å¤æ‚åœºæ™¯ä¸­æ›´åŠ å¾—å¿ƒåº”æ‰‹.</p>
<p>å½“ç„¶SSRä¸­çš„å‘ä¹Ÿä¸å°‘, ä¸»è¦æ˜¯æœåŠ¡ç«¯ç¯å¢ƒä¸‹çš„APIè§„åˆ™çš„ä¸åŒå’Œä¸€äº›æ•°æ®å’Œé€»è¾‘å¤„ç†çš„çº¦å®š(ä¾‹å¦‚ç”Ÿå‘½å‘¨æœŸ, ç¯å¢ƒå˜é‡, æ•°æ®é¢„å–), ä½†åªè¦æ³¨æ„è§„é¿è¿™äº›é—®é¢˜, åœ¨SSRçš„å¼€å‘ä¸­è¿˜æ˜¯æ¯”è¾ƒé¡ºæ»‘çš„. ä»¥ç›®å‰çš„APIè®¾è®¡æ¥è¯´, SPAçš„ä»£ç æ— æ³•ç›´æ¥æ”¾åˆ°æœåŠ¡ç«¯å°±èƒ½è·‘(é™¤éå®ç°CSRåº”ç”¨æ—¶å°±è€ƒè™‘äº†SSR), å…¶ä¸­æƒ³æ”¹é€ çš„è¯æˆæœ¬å¯èƒ½è¿˜ä¸å°. ä½†æ˜¯ä¸€ä¸ªæ–°åº”ç”¨æƒ³è¦è®¾è®¡ä¸ºSSRæ–¹æ¡ˆ, åŸºæœ¬ä¸Šå¼€å‘ä¸ç»´æŠ¤æˆæœ¬å’Œä¸€ä¸ªSPAåº”ç”¨å·®ä¸å¤š, æ‰€ä»¥åœ¨ä¸šåŠ¡å¼€å‘ä¸­æ˜¯ä¸€ä¸ªè¾ƒä¸ºå¯é çš„æŠ€æœ¯æ–¹æ¡ˆ.</p>
<!-- ç›®å‰æˆ‘ä»¬å®ç°çš„[k2](http://gitlab.alibaba-inc.com/qinshuo.lqs/k2)è„šæ‰‹æ¶å·²ç»é›†æˆäº† Begg + Vue SSR è§£å†³æ–¹æ¡ˆ, ä¸€é”®éƒ¨ç½², å³å¼€å³ç”¨, æ¬¢è¿å¤§å®¶å°è¯•. --></div><hr style="margin-bottom:1.75rem"/><div style="display:flex;margin-bottom:4.375rem"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px;margin-right:0.875rem;margin-bottom:0;min-width:50px;border-radius:100%"><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAEDBAL/xAAXAQADAQAAAAAAAAAAAAAAAAABAwQA/9oADAMBAAIQAxAAAAHJdl2USXBslHQGQBv/xAAbEAACAgMBAAAAAAAAAAAAAAABAgAREBIhIv/aAAgBAQABBQJ39rtiurLEAhHFUV//xAAZEQACAwEAAAAAAAAAAAAAAAAAAQIREjH/2gAIAQMBAT8BeclC6Sbs/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAEQESH/2gAIAQIBAT8B24Yj/8QAFxAAAwEAAAAAAAAAAAAAAAAAABEwMf/aAAgBAQAGPwIew//EABoQAQACAwEAAAAAAAAAAAAAAAEAESExQRD/2gAIAQEAAT8hW4cl5ahKjZ4yswK5BDZAg235P//aAAwDAQACAAMAAAAQNAjC/8QAGBEAAwEBAAAAAAAAAAAAAAAAAAERIUH/2gAIAQMBAT8QTlWUM4Lun//EABgRAQEBAQEAAAAAAAAAAAAAAAEAESEx/9oACAECAQE/EFPq2HIGX//EABsQAQACAwEBAAAAAAAAAAAAAAEAESExQWGB/9oACAEBAAE/ELKnFsqURwKr2GEZbsLZiJAGpiDfYkyXLcIQ4xlktuf/2Q==" alt="Qinshuo(Allen) Li" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms;border-radius:50%"/><noscript><picture><source srcset="/static/0257130576977213eca55ce954451317/99438/portrait-pic.jpg 1x,
/static/0257130576977213eca55ce954451317/aba1d/portrait-pic.jpg 1.5x,
/static/0257130576977213eca55ce954451317/b315d/portrait-pic.jpg 2x" /><img loading="lazy" width="50" height="50" srcset="/static/0257130576977213eca55ce954451317/99438/portrait-pic.jpg 1x,
/static/0257130576977213eca55ce954451317/aba1d/portrait-pic.jpg 1.5x,
/static/0257130576977213eca55ce954451317/b315d/portrait-pic.jpg 2x" src="/static/0257130576977213eca55ce954451317/99438/portrait-pic.jpg" alt="Qinshuo(Allen) Li" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p>Qinshuo(Allen) Li<br/><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/liqinshuo">Twitter</a> â€¢ <a target="_blank" rel="noopener noreferrer" href="https://github.com/lqs469">Github</a> â€¢ <a target="_blank" rel="noopener noreferrer" href="https://instagram.com/lqs469">Ins</a> â€¢ <a target="_blank" rel="noopener noreferrer" href="https://weibo.com/lqs469">Weibo</a> â€¢ <a target="_blank" rel="noopener noreferrer" href="https://www.zhihu.com/people/li-qin-shuo">Zhihu</a></p></div><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/Gitlab API æŒ‡åŒ—/Gitlab API æŒ‡åŒ—/">â† <!-- -->Gitlab API æŒ‡åŒ—</a></li><li><a rel="next" href="/GraphQLä¸RESTç›¸æ¯”çš„ä¼˜åŠ¿å’ŒçŸ­æ¿/">GraphQL ä¸ REST ç›¸æ¯”çš„ä¼˜åŠ¿å’ŒçŸ­æ¿<!-- --> â†’</a></li></ul></main></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/Vue.jsæœåŠ¡ç«¯æ¸²æŸ“(SSR)ä¸å®Œå…¨æŒ‡åŒ—/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-7fb453d4fc8f6ed33d87.js"],"component---node-modules-gatsby-plugin-offline-2-2-10-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-2-2-10-gatsby-plugin-offline-app-shell-js-4c7de9ad9006dfa3519f.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-68ad52aa3118cbdd2315.js"],"component---src-pages-404-js":["/component---src-pages-404-js-2fa4a28e28809ee863c9.js"],"component---src-pages-about-js":["/component---src-pages-about-js-1dd6a3ebdea7d6680752.js"],"component---src-pages-index-js":["/component---src-pages-index-js-c0cfabaf2c5cb668aeab.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-js-68ad52aa3118cbdd2315.js" async=""></script><script src="/commons-abb2cf2657c6a62230f0.js" async=""></script><script src="/styles-7defa62713d15c7890c9.js" async=""></script><script src="/app-7fb453d4fc8f6ed33d87.js" async=""></script><script src="/webpack-runtime-e014b771165152003fc7.js" async=""></script><div style="display:none"><script>
              console.log('Halo ğŸ˜‰');
              var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
              document.write(unescape("%3Cspan id='cnzz_stat_icon_1264607064'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1264607064' type='text/javascript'%3E%3C/script%3E"));
              </script></div></body></html>